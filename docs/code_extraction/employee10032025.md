### ðŸ“„ hrms_project\employees\admin.py
```from django.contrib import admin
from .models import (
    Department, Division, Location, Employee, EmployeeDependent,
    EmergencyContact, EmployeeDocument, EmployeeAsset, EmployeeEducation,
    EmployeeOffence, LifeEvent, EmployeeBankAccount, CostProfitCenter,
    DependentDocument, OffenseRule
)

@admin.register(Department)
class DepartmentAdmin(admin.ModelAdmin):
    list_display = ('name', 'name_ar', 'code', 'parent')
    search_fields = ('name', 'name_ar', 'code')
    list_filter = ('parent',)

@admin.register(Division)
class DivisionAdmin(admin.ModelAdmin):
    list_display = ('name', 'name_ar', 'code', 'department')
    search_fields = ('name', 'name_ar', 'code')
    list_filter = ('department',)

@admin.register(Location)
class LocationAdmin(admin.ModelAdmin):
    list_display = ('name', 'code')
    search_fields = ('name', 'code', 'address')

@admin.register(CostProfitCenter)
class CostProfitCenterAdmin(admin.ModelAdmin):
    list_display = ('code', 'name', 'is_active')
    search_fields = ('code', 'name')
    list_filter = ('is_active',)

@admin.register(Employee)
class EmployeeAdmin(admin.ModelAdmin):
    list_display = ('employee_number', 'get_full_name', 'designation', 'department', 'is_active')
    search_fields = ('employee_number', 'first_name', 'last_name', 'email')
    list_filter = ('is_active', 'department', 'division', 'employee_category', 'in_probation')
    
    fieldsets = (
        ('Personal Information', {
            'fields': (
                ('employee_number', 'profile_picture'),
                ('first_name', 'middle_name', 'last_name'),
                ('first_name_ar', 'middle_name_ar', 'last_name_ar'),
                ('date_of_birth', 'gender'),
                ('nationality', 'religion'),
                ('marital_status', 'education_category'),
                ('cpr_number', 'email'),
                'in_probation'
            )
        }),
        ('Employment Information', {
            'fields': (
                ('designation', 'department'),
                ('division', 'location'),
                ('contract_type', 'joined_date'),
                ('cost_center', 'profit_center'),
                'employee_category',
                'is_active'
            )
        })
    )

    def get_full_name(self, obj):
        return obj.get_full_name()
    get_full_name.short_description = 'Full Name'

@admin.register(EmployeeBankAccount)
class EmployeeBankAccountAdmin(admin.ModelAdmin):
    list_display = ('employee', 'bank', 'account_number', 'iban')
    search_fields = ('employee__employee_number', 'bank', 'account_number', 'iban')
    list_filter = ('bank',)

@admin.register(EmployeeDocument)
class EmployeeDocumentAdmin(admin.ModelAdmin):
    list_display = ('employee', 'document_type', 'document_number', 'issue_date', 'expiry_date')
    search_fields = ('employee__employee_number', 'document_type', 'document_number')
    list_filter = ('document_type', 'issue_date', 'expiry_date')

@admin.register(EmployeeDependent)
class EmployeeDependentAdmin(admin.ModelAdmin):
    list_display = ('employee', 'name', 'relation', 'date_of_birth', 'valid_passage')
    search_fields = ('employee__employee_number', 'name', 'passport_number', 'cpr_number')
    list_filter = ('relation', 'valid_passage')

@admin.register(DependentDocument)
class DependentDocumentAdmin(admin.ModelAdmin):
    list_display = ['name', 'document_type', 'document_number', 'issue_date', 'expiry_date', 'status']
    list_filter = ['document_type', 'status', 'nationality']
    search_fields = ['name', 'document_number']
    date_hierarchy = 'created_at'

@admin.register(EmergencyContact)
class EmergencyContactAdmin(admin.ModelAdmin):
    list_display = ('employee', 'name', 'relationship', 'phone_number')
    search_fields = ('employee__employee_number', 'name', 'phone_number')

@admin.register(EmployeeAsset)
class EmployeeAssetAdmin(admin.ModelAdmin):
    list_display = ('employee', 'asset_name', 'asset_number', 'issue_date', 'return_date')
    search_fields = ('employee__employee_number', 'asset_name', 'asset_number')
    list_filter = ('issue_date', 'return_date')

@admin.register(EmployeeEducation)
class EmployeeEducationAdmin(admin.ModelAdmin):
    list_display = ('employee', 'institution', 'degree', 'graduation_year')
    search_fields = ('employee__employee_number', 'institution', 'degree')
    list_filter = ('graduation_year',)

@admin.register(OffenseRule)
class OffenseRuleAdmin(admin.ModelAdmin):
    list_display = ('rule_id', 'group', 'name', 'first_penalty', 'second_penalty', 'third_penalty', 'fourth_penalty', 'is_active')
    list_filter = ('group', 'is_active')
    search_fields = ('rule_id', 'name', 'description')
    ordering = ('group', 'rule_id')
    fieldsets = (
        (None, {
            'fields': ('rule_id', 'group', 'name', 'description')
        }),
        ('Penalties', {
            'fields': ('first_penalty', 'second_penalty', 'third_penalty', 'fourth_penalty')
        }),
        ('Additional Information', {
            'fields': ('remarks', 'is_active')
        })
    )

@admin.register(EmployeeOffence)
class EmployeeOffenceAdmin(admin.ModelAdmin):
    list_display = ('employee', 'rule', 'offense_date', 'offense_count', 'applied_penalty', 'is_acknowledged')
    list_filter = ('offense_date', 'rule__group', 'is_acknowledged')
    search_fields = ('employee__first_name', 'employee__last_name', 'rule__name', 'details')
    raw_id_fields = ('employee', 'rule')
    readonly_fields = ('offense_count', 'original_penalty', 'created_by', 'modified_by', 'created_at', 'updated_at')
    fieldsets = (
        (None, {
            'fields': ('employee', 'rule', 'offense_date', 'offense_count')
        }),
        ('Penalty Information', {
            'fields': ('original_penalty', 'applied_penalty', 'details')
        }),
        ('Documents', {
            'fields': ('warning_letter', 'acknowledgment', 'is_acknowledged', 'acknowledged_at')
        }),
        ('Audit Trail', {
            'fields': ('created_by', 'modified_by', 'created_at', 'updated_at'),
            'classes': ('collapse',)
        })
    )

    def save_model(self, request, obj, form, change):
        if not change:  # New object
            obj.created_by = request.user
        obj.modified_by = request.user
        super().save_model(request, obj, form, change)

@admin.register(LifeEvent)
class LifeEventAdmin(admin.ModelAdmin):
    list_display = ('employee', 'event_type', 'date')
    search_fields = ('employee__employee_number',)
    list_filter = ('event_type', 'date')

```

### ðŸ“„ hrms_project\employees\api_views.py
```from rest_framework import viewsets, status
from rest_framework.decorators import action, permission_classes, api_view
from rest_framework.response import Response
from rest_framework.permissions import IsAuthenticated
from django.db import models
from django.db.models import Count, Q, F, Value
from django.db.models.functions import Cast, Greatest
from django.contrib.postgres.search import TrigramSimilarity
from django.shortcuts import get_object_or_404
from django.utils import timezone
from django.views.decorators.http import require_http_methods
from django.http import JsonResponse, HttpResponse
from django.conf import settings
from django.template.loader import render_to_string
from .models import EmployeeAsset, Employee, AssetType, OffenseRule, EmployeeOffence, OffenseDocument
from .serializers import EmployeeAssetSerializer, AssetTypeSerializer, BulkEmployeeAssetSerializer, OffenseRuleSerializer, EmployeeOffenceSerializer, OffenseDocumentSerializer
from reportlab.pdfgen import canvas
from decimal import Decimal
from io import BytesIO
import json
import os
import logging

logger = logging.getLogger(__name__)

class BaseAPIViewSet(viewsets.ModelViewSet):
    permission_classes = [IsAuthenticated]

    def get_queryset(self):
        return self.queryset.filter(employee__company=self.request.user.employee.company)

class AssetTypeViewSet(BaseAPIViewSet):
    serializer_class = AssetTypeSerializer
    queryset = AssetType.objects.all()

    def get_queryset(self):
        """Return all asset types as they are shared across the company"""
        return self.queryset

class EmployeeAssetViewSet(BaseAPIViewSet):
    serializer_class = EmployeeAssetSerializer
    queryset = EmployeeAsset.objects.all()

    def get_queryset(self):
        """Filter assets by employee if specified"""
        queryset = super().get_queryset()
        employee_id = self.request.query_params.get('employee_id')
        if employee_id:
            queryset = queryset.filter(employee_id=employee_id)
        return queryset

    def perform_create(self, serializer):
        """Create a new asset"""
        employee_id = self.request.data.get('employee')
        if not employee_id and hasattr(self.request.user, 'employee'):
            employee = self.request.user.employee
        else:
            employee = get_object_or_404(Employee, id=employee_id)
            
        # Get the asset type
        asset_type_id = self.request.data.get('asset_type')
        asset_type = get_object_or_404(AssetType, id=asset_type_id)
        
        # Use the asset type name as the asset name if not provided
        asset_name = self.request.data.get('asset_name') or asset_type.name
        
        serializer.save(
            employee=employee,
            asset_type=asset_type,
            asset_name=asset_name
        )

    @action(detail=False, methods=['post'])
    def return_assets(self, request):
        """Handle returning multiple assets at once"""
        asset_ids = request.data.get('asset_ids', [])
        return_date = request.data.get('return_date')
        return_condition = request.data.get('return_condition')

        if not asset_ids or not return_date or not return_condition:
            return Response(
                {'error': 'Missing required fields'},
                status=status.HTTP_400_BAD_REQUEST
            )

        try:
            # Ensure user can only return assets they have access to
            assets = self.get_queryset().filter(
                id__in=asset_ids,
                return_date__isnull=True
            )
            
            if not assets.exists():
                return Response(
                    {'error': 'No valid assets found to return'},
                    status=status.HTTP_404_NOT_FOUND
                )

            assets.update(
                return_date=return_date,
                return_condition=return_condition,
                updated_at=timezone.now()
            )
            return Response({'status': 'success'})
        except Exception as e:
            return Response(
                {'error': str(e)},
                status=status.HTTP_500_INTERNAL_SERVER_ERROR
            )

@api_view(['POST'])
def add_employee_asset(request, employee_id):
    """Add one or more assets to an employee"""
    try:
        employee = get_object_or_404(Employee, id=employee_id)
        data = request.data.copy()
        
        # Check if we're dealing with multiple assets
        if isinstance(data, list) or (isinstance(data, dict) and 'asset_type' in data and isinstance(data['asset_type'], list)):
            # Convert data to the format expected by BulkEmployeeAssetSerializer
            assets_data = []
            if isinstance(data, list):
                assets_data = data
            else:
                # Handle multiple assets of the same type
                asset_types = data.get('asset_type', [])
                base_data = {
                    'employee': employee_id,
                    'asset_name': data.get('asset_name'),
                    'asset_number': data.get('asset_number'),
                    'condition': data.get('condition', 'New'),
                    'value': data.get('value', '0.00'),
                    'notes': data.get('notes', ''),
                    'issue_date': data.get('issue_date', timezone.now().date())
                }
                
                for asset_type_id in asset_types:
                    asset_data = base_data.copy()
                    asset_data['asset_type_id'] = asset_type_id
                    assets_data.append(asset_data)
            
            # Add employee ID to each asset
            for asset in assets_data:
                asset['employee'] = employee_id
            
            serializer = BulkEmployeeAssetSerializer(data={'assets': assets_data})
            if serializer.is_valid():
                assets = serializer.save()
                return Response(
                    EmployeeAssetSerializer(assets, many=True).data,
                    status=status.HTTP_201_CREATED
                )
            return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)
        
        # Single asset
        data['employee'] = employee_id
        serializer = EmployeeAssetSerializer(data=data)
        if serializer.is_valid():
            asset = serializer.save()
            return Response(serializer.data, status=status.HTTP_201_CREATED)
        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)
        
    except Exception as e:
        return Response({'error': str(e)}, status=status.HTTP_400_BAD_REQUEST)

@api_view(['PUT', 'PATCH'])
def edit_employee_asset(request, employee_id, asset_id):
    """Edit an employee's asset"""
    try:
        asset = get_object_or_404(EmployeeAsset, id=asset_id, employee_id=employee_id)
        data = request.data.copy()
        
        serializer = EmployeeAssetSerializer(asset, data=data, partial=True)
        if serializer.is_valid():
            serializer.save()
            return Response(serializer.data)
        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)
        
    except Exception as e:
        return Response({'error': str(e)}, status=status.HTTP_400_BAD_REQUEST)

@api_view(['DELETE'])
def delete_employee_asset(request, employee_id, asset_id):
    """Delete an employee's asset"""
    asset = get_object_or_404(EmployeeAsset, id=asset_id, employee_id=employee_id)
    asset.delete()
    return Response(status=status.HTTP_204_NO_CONTENT)

@api_view(['GET'])
def get_employee_asset(request, employee_id, asset_id):
    """Get details of an employee's asset"""
    try:
        asset = get_object_or_404(EmployeeAsset, id=asset_id, employee_id=employee_id)
        serializer = EmployeeAssetSerializer(asset)
        return Response(serializer.data)
    except Exception as e:
        return Response({'error': str(e)}, status=status.HTTP_400_BAD_REQUEST)

@api_view(['POST'])
def return_employee_asset(request, employee_id, asset_id):
    """Mark an asset as returned"""
    try:
        asset = get_object_or_404(EmployeeAsset, id=asset_id, employee_id=employee_id)
        
        # Get return date and condition from request
        data = request.data.copy()
        return_date = data.get('return_date')
        return_condition = data.get('return_condition')
        return_notes = data.get('return_notes')
        
        if not return_date:
            return Response({'error': 'Return date is required'}, status=status.HTTP_400_BAD_REQUEST)
            
        if not return_condition:
            return Response({'error': 'Return condition is required'}, status=status.HTTP_400_BAD_REQUEST)
            
        # Update asset
        serializer = EmployeeAssetSerializer(asset, data={
            'return_date': return_date,
            'return_condition': return_condition,
            'return_notes': return_notes
        }, partial=True)
        
        if serializer.is_valid():
            serializer.save()
            return Response(serializer.data)
        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)
        
    except Exception as e:
        return Response({'error': str(e)}, status=status.HTTP_400_BAD_REQUEST)

@require_http_methods(['GET', 'POST'])
def employee_offenses(request, employee_id):
    """Get all offenses or create a new one for an employee"""
    try:
        employee = get_object_or_404(Employee, id=employee_id)
        
        if request.method == 'GET':
            offenses = employee.employee_offence_records.all()
            serializer = EmployeeOffenceSerializer(offenses, many=True)
            return Response(serializer.data)
            
        elif request.method == 'POST':
            serializer = EmployeeOffenceSerializer(data=request.data)
            if serializer.is_valid():
                serializer.save(
                    employee=employee,
                    created_by=request.user,
                    modified_by=request.user
                )
                return Response(serializer.data, status=status.HTTP_201_CREATED)
            return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)
            
    except Exception as e:
        return Response({'error': str(e)}, status=status.HTTP_500_INTERNAL_SERVER_ERROR)

@require_http_methods(['GET', 'DELETE'])
def employee_offense_detail(request, employee_id, offense_id):
    """Get or delete an employee's offense"""
    try:
        offense = get_object_or_404(EmployeeOffence, id=offense_id, employee_id=employee_id)
        
        if request.method == 'GET':
            serializer = EmployeeOffenceSerializer(offense)
            return Response(serializer.data)
            
        elif request.method == 'DELETE':
            offense.delete()
            return Response(status=status.HTTP_204_NO_CONTENT)
            
    except Exception as e:
        return Response({'error': str(e)}, status=status.HTTP_500_INTERNAL_SERVER_ERROR)

@require_http_methods(['POST'])
def cancel_offense(request, employee_id, offense_id):
    """Cancel an employee's offense"""
    try:
        offense = get_object_or_404(EmployeeOffence, id=offense_id, employee_id=employee_id)
        if offense.is_cancelled:
            return Response({'error': 'Offense is already cancelled'}, status=status.HTTP_400_BAD_REQUEST)
            
        offense.is_cancelled = True
        offense.modified_by = request.user
        offense.save()
        
        serializer = EmployeeOffenceSerializer(offense)
        return Response(serializer.data)
        
    except Exception as e:
        return Response({'error': str(e)}, status=status.HTTP_500_INTERNAL_SERVER_ERROR)

@require_http_methods(['POST'])
def add_offense_document(request, employee_id, offense_id):
    """Add a document to an offense"""
    try:
        offense = get_object_or_404(EmployeeOffence, id=offense_id, employee_id=employee_id)
        serializer = OffenseDocumentSerializer(data=request.data)
        
        if serializer.is_valid():
            serializer.save(offense=offense)
            return Response(serializer.data, status=status.HTTP_201_CREATED)
        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)
        
    except Exception as e:
        return Response({'error': str(e)}, status=status.HTTP_500_INTERNAL_SERVER_ERROR)

@api_view(['GET'])
def get_employee_offense_count(request, employee_id):
    """Get the count of active offenses for an employee and rule"""
    try:
        rule_id = request.GET.get('rule')
        year = request.GET.get('year')
        
        if not rule_id or not year:
            return Response({'error': 'Rule and year are required'}, status=status.HTTP_400_BAD_REQUEST)
        
        # Get all active offenses for this rule, ordered by date
        offenses = EmployeeOffence.objects.filter(
            employee_id=employee_id,
            rule_id=rule_id,
            offense_date__year=year,
            is_active=True
        ).order_by('offense_date')
        
        # Count how many times this rule has been violated
        offense_count = offenses.count()
        
        # Get the rule details
        rule = OffenseRule.objects.get(id=rule_id)
        
        # Determine which penalty to apply based on count
        penalty = None
        if offense_count == 0:
            penalty = rule.first_penalty
        elif offense_count == 1:
            penalty = rule.second_penalty
        elif offense_count == 2:
            penalty = rule.third_penalty
        elif offense_count >= 3:
            penalty = rule.fourth_penalty
        
        return Response({
            'count': offense_count,
            'suggested_penalty': penalty,
            'offenses': [{
                'date': o.offense_date,
                'penalty': o.applied_penalty
            } for o in offenses]
        })
        
    except OffenseRule.DoesNotExist:
        return Response({'error': 'Rule not found'}, status=status.HTTP_404_NOT_FOUND)
    except Exception as e:
        return Response({'error': str(e)}, status=status.HTTP_500_INTERNAL_SERVER_ERROR)

class OffenseRuleViewSet(viewsets.ModelViewSet):
    serializer_class = OffenseRuleSerializer
    queryset = OffenseRule.objects.all()
    permission_classes = [IsAuthenticated]

    def get_queryset(self):
        logger.debug("Fetching offense rules...")
        queryset = OffenseRule.objects.filter(is_active=True)
        group = self.request.query_params.get('group', None)
        search = self.request.query_params.get('search', None)

        if group:
            logger.debug(f"Filtering by group: {group}")
            queryset = queryset.filter(group=group)
        
        if search:
            logger.debug(f"Searching with trigram similarity for: {search}")
            from django.contrib.postgres.search import TrigramSimilarity
            from django.db.models import Q, F, Value
            from django.db.models.functions import Cast, Greatest
            
            print(search)
            search_value = Value(search, output_field=models.TextField())
            
            queryset = queryset.annotate(
                rule_id_similarity=TrigramSimilarity('rule_id', search_value),
                name_similarity=TrigramSimilarity('name', search_value),
                desc_similarity=TrigramSimilarity('description', search_value)
            ).annotate(
                similarity=Greatest(
                    'rule_id_similarity',
                    'name_similarity',
                    'desc_similarity'
                )
            ).filter(
                Q(similarity__gt=0.1) |  # Fuzzy match
                Q(rule_id__iexact=search) |  # Exact matches first
                Q(name__icontains=search) |  # Then contains
                Q(description__icontains=search)
            ).order_by('-similarity', 'rule_id')  # Sort by similarity then rule ID
            
            logger.debug(f"Search SQL: {str(queryset.query)}")
            
            print(queryset.query)
            logger.debug(f"Found {queryset.count()} results")
            logger.debug("Search complete")
        
        rules = queryset.order_by('rule_id') if not search else queryset
        logger.debug(f"Found {rules.count()} rules")
        return rules

    def list(self, request, *args, **kwargs):
        logger.debug("Listing offense rules...")
        queryset = self.get_queryset()
        serializer = self.get_serializer(queryset, many=True)
        logger.debug("Serialization complete")
        return Response(serializer.data)

class EmployeeOffenseViewSet(viewsets.ModelViewSet):
    serializer_class = EmployeeOffenceSerializer
    permission_classes = [IsAuthenticated]

    def get_queryset(self):
        return EmployeeOffence.objects.all()

    def create(self, request, *args, **kwargs):
        data = request.data.copy()
        
        # Ensure employee is set
        if not data.get('employee'):
            data['employee'] = request.user.employee.id
            
        serializer = self.get_serializer(data=data)
        serializer.is_valid(raise_exception=True)
        self.perform_create(serializer)
        headers = self.get_success_headers(serializer.data)
        return Response(serializer.data, status=status.HTTP_201_CREATED, headers=headers)

    def perform_create(self, serializer):
        serializer.save(
            created_by=self.request.user,
            modified_by=self.request.user
        )

@api_view(['POST'])
@permission_classes([IsAuthenticated])
def update_offense_status(request, pk):
    try:
        offense = EmployeeOffence.objects.get(pk=pk)
        status = request.data.get('status')
        
        if status == 'signed':
            offense.is_acknowledged = True
            offense.signed_date = timezone.now()
        elif status == 'refused':
            offense.is_acknowledged = False
            offense.refused_date = timezone.now()
            offense.refused_reason = request.data.get('reason', '')
        elif status == 'sent':
            offense.sent_date = timezone.now()
        
        offense.save()
        return Response({'status': 'success'})
    except EmployeeOffence.DoesNotExist:
        return Response({'error': 'Offense not found'}, status=404)

@api_view(['POST'])
@permission_classes([IsAuthenticated])
def record_offense_payment(request, pk):
    try:
        offense = EmployeeOffence.objects.get(pk=pk)
        amount = Decimal(request.data.get('amount', 0))
        
        if not offense.monetary_amount or not offense.is_active:
            return Response({'error': 'Invalid offense for payment'}, status=400)
        
        if amount <= 0:
            return Response({'error': 'Invalid payment amount'}, status=400)
        
        # Record the payment
        offense.remaining_amount = max(0, offense.remaining_amount - amount)
        
        # If fully paid, mark as inactive
        if offense.remaining_amount == 0:
            offense.is_active = False
            offense.completed_date = timezone.now()
        
        offense.save()
        
        # Create payment record
        #OffensePayment.objects.create(
        #    offense=offense,
        #    amount=amount,
        #    payment_date=timezone.now()
        #)
        
        return Response({
            'status': 'success',
            'remaining_amount': offense.remaining_amount,
            'is_active': offense.is_active
        })
    except EmployeeOffence.DoesNotExist:
        return Response({'error': 'Offense not found'}, status=404)

@api_view(['GET'])
@permission_classes([IsAuthenticated])
def get_employee_offense_count(request, employee_id):
    try:
        rule_id = request.GET.get('rule')
        year = int(request.GET.get('year', timezone.now().year))
        
        if not rule_id:
            return Response({'error': 'Rule ID is required'}, status=400)
        
        # Get active offenses for this employee and rule in the specified year
        offenses = EmployeeOffence.objects.filter(
            employee_id=employee_id,
            rule_id=rule_id,
            offense_date__year=year,
            is_active=True
        ).order_by('offense_date')
        
        count = offenses.count()
        
        # Get the suggested penalty based on count
        rule = OffenseRule.objects.get(pk=rule_id)
        suggested_penalty = rule.get_penalty_for_count(count + 1)
        
        return Response({
            'count': count,
            'suggested_penalty': suggested_penalty,
            'offenses': [{
                'date': offense.offense_date,
                'penalty': offense.get_applied_penalty_display()
            } for offense in offenses]
        })
    except (OffenseRule.DoesNotExist, ValueError):
        return Response({'error': 'Invalid rule or year'}, status=400)

@api_view(['GET'])
@permission_classes([IsAuthenticated])
def print_offense(request, pk):
    try:
        offense = EmployeeOffence.objects.get(pk=pk)
        
        # Generate PDF using your template
        # This is just a placeholder - implement your actual PDF generation here
        response = HttpResponse(content_type='application/pdf')
        response['Content-Disposition'] = f'inline; filename="offense_{offense.id}.pdf"'
        
        # Create PDF
        buffer = BytesIO()
        p = canvas.Canvas(buffer)
        
        # Add content to PDF
        p.drawString(100, 800, f"Offense Notice - {offense.rule.name}")
        p.drawString(100, 780, f"Employee: {offense.employee.full_name}")
        p.drawString(100, 760, f"Date: {offense.offense_date.strftime('%d/%m/%Y')}")
        p.drawString(100, 740, f"Penalty: {offense.get_applied_penalty_display()}")
        
        if offense.monetary_amount:
            p.drawString(100, 720, f"Amount: {offense.monetary_amount} BHD")
            if offense.is_active:
                p.drawString(100, 700, f"Remaining: {offense.remaining_amount} BHD")
        
        p.showPage()
        p.save()
        
        # Get the value of the buffer and write it to the response
        pdf = buffer.getvalue()
        buffer.close()
        response.write(pdf)
        
        return response
    except EmployeeOffence.DoesNotExist:
        return Response({'error': 'Offense not found'}, status=404)

```

### ðŸ“„ hrms_project\employees\apps.py
```from django.apps import AppConfig


class EmployeesConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'employees'

```

### ðŸ“„ hrms_project\employees\forms.py
```from django import forms
from django.db import transaction
from crispy_forms.helper import FormHelper
from crispy_forms.layout import Layout, Submit, Row, Column, Div, HTML, Field, Fieldset
from crispy_forms.bootstrap import Tab, TabHolder
from .models import (
    Employee, Department, Division, EmployeeDependent, 
    EmergencyContact, EmployeeDocument, EmployeeBankAccount,
    CostProfitCenter, DependentDocument,
    EmployeeAsset, EmployeeEducation, EmployeeOffence, LifeEvent,
    SalaryDetail, SalaryRevision, SalaryCertificate
)

class EmployeeForm(forms.ModelForm):
    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        self.helper = FormHelper()
        self.helper.form_method = 'post'
        self.helper.form_class = 'form-horizontal'
        self.helper.label_class = 'col-lg-3'
        self.helper.field_class = 'col-lg-9'
        
        # Make some fields optional
        optional_fields = ['middle_name', 'middle_name_ar', 'religion',
                         'education_category', 'profile_picture']
        
        for field in optional_fields:
            self.fields[field].required = False

        # Add Bootstrap classes to all fields
        for field_name, field in self.fields.items():
            if isinstance(field.widget, forms.CheckboxInput):
                field.widget.attrs.update({
                    'class': 'form-check-input'
                })
            elif isinstance(field.widget, forms.FileInput):
                field.widget.attrs.update({
                    'class': 'form-control-file'
                })
            else:
                field.widget.attrs.update({
                    'class': 'form-control',
                    'placeholder': field.label
                })

        # Load related fields efficiently
        self.fields['department'].queryset = Department.objects.all()
        self.fields['division'].queryset = Division.objects.all().select_related('department')
        self.fields['cost_center'].queryset = CostProfitCenter.objects.filter(is_active=True)
        self.fields['profit_center'].queryset = CostProfitCenter.objects.filter(is_active=True)

        # Define form layout
        self.helper.layout = Layout(
            TabHolder(
                Tab('Employee Information',
                    Fieldset('Basic Information',
                        Row(
                            Column('employee_number', css_class='form-group col-md-6'),
                            Column('profile_picture', css_class='form-group col-md-6'),
                            css_class='form-row'
                        ),
                    ),
                    Fieldset('Personal Information (English)',
                        Row(
                            Column('first_name', css_class='form-group col-md-6'),
                            Column('middle_name', css_class='form-group col-md-6'),
                            css_class='form-row'
                        ),
                        Row(
                            Column('last_name', css_class='form-group col-md-6'),
                            css_class='form-row'
                        ),
                    ),
                    Fieldset('Personal Information (Arabic)',
                        Row(
                            Column('first_name_ar', css_class='form-group col-md-6'),
                            Column('middle_name_ar', css_class='form-group col-md-6'),
                            css_class='form-row'
                        ),
                        Row(
                            Column('last_name_ar', css_class='form-group col-md-6'),
                            css_class='form-row'
                        ),
                    ),
                    Fieldset('Demographics',
                        Row(
                            Column('date_of_birth', css_class='form-group col-md-6'),
                            Column('gender', css_class='form-group col-md-6'),
                            css_class='form-row'
                        ),
                        Row(
                            Column('marital_status', css_class='form-group col-md-6'),
                            Column('nationality', css_class='form-group col-md-6'),
                            css_class='form-row'
                        ),
                        Row(
                            Column('religion', css_class='form-group col-md-6'),
                            Column('education_category', css_class='form-group col-md-6'),
                            css_class='form-row'
                        ),
                    ),
                    Fieldset('Contact & Identification',
                        Row(
                            
                            Column('primary_phone', css_class='form-group col-md-6'),
                            Column('secondary_phone', css_class='form-group col-md-6'),

                            css_class='form-row'
                        ),
                        Row(
                            Column('email', css_class='form-group col-md-6'),
                            Column('cpr_number', css_class='form-group col-md-6'),
                            css_class='form-row'
                        ),
                    ),
                ),
                Tab('Employment Information',
                    Fieldset('Position Details',
                        Row(
                            Column('designation', css_class='form-group col-md-6'),
                            Column('employee_category', css_class='form-group col-md-6'),
                            css_class='form-row'
                        ),
                    ),
                    Fieldset('Department & Location',
                        Row(
                            Column('division', css_class='form-group col-md-6'),
                            Column('department', css_class='form-group col-md-6'),
                            css_class='form-row'
                        ),
                        Row(
                            Column('location', css_class='form-group col-md-6'),
                            css_class='form-row'
                        ),
                    ),
                    Fieldset('Contract Information',
                        Row(
                            Column('contract_type', css_class='form-group col-md-6'),
                            Column('joined_date', css_class='form-group col-md-6'),
                            css_class='form-row'
                        ),
                        Row(
                            Column('in_probation', css_class='form-group col-md-6'),
                            css_class='form-row'
                        ),
                    ),
                    Fieldset('Financial Centers',
                        Row(
                            Column('cost_center', css_class='form-group col-md-6'),
                            Column('profit_center', css_class='form-group col-md-6'),
                            css_class='form-row'
                        ),
                    ),
                ),
            ),
            Div(
                Row(
                    Column(Field('is_active'), css_class='form-group col-6'),
                    Column(
                        HTML("""
                            <div class="text-end">
                                <a href="{% url 'employees:employee_list' %}" class="btn btn-secondary">Cancel</a>
                                <button type="submit" class="btn btn-primary">Save</button>
                            </div>
                        """),
                        css_class='form-group col-6'
                    ),
                    css_class='form-row'
                ),
                css_class='card-footer'
            )
        )

    class Meta:
        model = Employee
        fields = [
            # General Information
            'employee_number', 'profile_picture', 'first_name', 'middle_name', 'last_name',
            'first_name_ar', 'middle_name_ar', 'last_name_ar', 'date_of_birth',
            'gender', 'marital_status', 'nationality', 'religion', 'education_category',
            'cpr_number', 'email', 'primary_phone', 'secondary_phone', 'in_probation',
            # Employment Information
            'designation', 'division', 'department', 'location', 'contract_type',
            'joined_date', 'cost_center', 'profit_center', 'employee_category',
            # System Fields
            'is_active'
        ]
        widgets = {
            'date_of_birth': forms.DateInput(attrs={'type': 'date'}),
            'joined_date': forms.DateInput(attrs={'type': 'date'}),
        }

class EmployeeBankAccountForm(forms.ModelForm):
    class Meta:
        model = EmployeeBankAccount
        fields = ['bank', 'account_number', 'iban', 'transfer_amount', 'is_primary']
        widgets = {
            'bank': forms.TextInput(attrs={'class': 'form-control'}),
            'account_number': forms.TextInput(attrs={'class': 'form-control'}),
            'iban': forms.TextInput(attrs={'class': 'form-control'}),
            'transfer_amount': forms.NumberInput(attrs={'class': 'form-control'}),
            'is_primary': forms.CheckboxInput(attrs={'class': 'form-check-input'}),
        }

    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        self.helper = FormHelper()
        self.helper.form_method = 'post'
        self.helper.form_class = 'form-horizontal'
        self.helper.label_class = 'col-lg-3'
        self.helper.field_class = 'col-lg-9'
        self.helper.layout = Layout(
            Row(
                Column('bank', css_class='form-group col-md-6 mb-0'),
                Column('account_number', css_class='form-group col-md-6 mb-0'),
                css_class='form-row'
            ),
            Row(
                Column('iban', css_class='form-group col-md-6 mb-0'),
                Column('transfer_amount', css_class='form-group col-md-6 mb-0'),
                css_class='form-row'
            ),
            Row(
                Column('is_primary', css_class='form-group col-12 mb-0'),
                css_class='form-row'
            ),
            Submit('submit', 'Save Bank Account', css_class='btn-primary')
        )

EmployeeBankAccountFormSet = forms.inlineformset_factory(
    Employee,
    EmployeeBankAccount,
    form=EmployeeBankAccountForm,
    extra=1,
    can_delete=True,
    min_num=0,
    validate_min=False,
)

class EmployeeDependentForm(forms.ModelForm):
    class Meta:
        model = EmployeeDependent
        fields = [
            'name', 'relation', 'date_of_birth', 'passport_number',
            'passport_expiry', 'cpr_number', 'cpr_expiry', 'valid_passage'
        ]
        widgets = {
            'date_of_birth': forms.DateInput(attrs={'type': 'date', 'class': 'form-control'}),
            'passport_expiry': forms.DateInput(attrs={'type': 'date', 'class': 'form-control'}),
            'cpr_expiry': forms.DateInput(attrs={'type': 'date', 'class': 'form-control'}),
        }

    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        self.helper = FormHelper()
        self.helper.form_method = 'post'
        self.helper.form_class = 'form-horizontal'
        self.helper.label_class = 'col-lg-3'
        self.helper.field_class = 'col-lg-9'
        
        # Add Bootstrap classes to fields
        for field_name, field in self.fields.items():
            if isinstance(field.widget, forms.CheckboxInput):
                field.widget.attrs['class'] = 'form-check-input'
            else:
                field.widget.attrs['class'] = 'form-control'

        self.helper.layout = Layout(
            Row(
                Column('name', css_class='form-group col-md-6 mb-0'),
                Column('relation', css_class='form-group col-md-6 mb-0'),
                css_class='form-row'
            ),
            Row(
                Column('date_of_birth', css_class='form-group col-md-6 mb-0'),
                Column('valid_passage', css_class='form-group col-md-6 mb-0'),
                css_class='form-row'
            ),
            Row(
                Column('passport_number', css_class='form-group col-md-6 mb-0'),
                Column('passport_expiry', css_class='form-group col-md-6 mb-0'),
                css_class='form-row'
            ),
            Row(
                Column('cpr_number', css_class='form-group col-md-6 mb-0'),
                Column('cpr_expiry', css_class='form-group col-md-6 mb-0'),
                css_class='form-row'
            ),
            Submit('submit', 'Save Dependent', css_class='btn-primary')
        )

class DependentDocumentForm(forms.ModelForm):
    class Meta:
        model = DependentDocument
        fields = ['document_type', 'document_number', 'name', 'issue_date', 'expiry_date', 'nationality', 'document_file']
        widgets = {
            'issue_date': forms.DateInput(attrs={'type': 'date'}),
            'expiry_date': forms.DateInput(attrs={'type': 'date'}),
        }

    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        self.fields['document_number'].required = False
        self.fields['issue_date'].required = False
        self.fields['expiry_date'].required = False
        self.fields['nationality'].required = False
        self.fields['document_file'].required = False
        self.helper = FormHelper()
        self.helper.form_method = 'post'
        self.helper.form_class = 'form-horizontal'
        self.helper.label_class = 'col-lg-3'
        self.helper.field_class = 'col-lg-9'

        # Add Bootstrap classes to fields
        for field_name, field in self.fields.items():
            if isinstance(field.widget, forms.FileInput):
                field.widget.attrs['class'] = 'form-control-file'
            else:
                field.widget.attrs['class'] = 'form-control'

        self.helper.layout = Layout(
            Row(
                Column('document_type', css_class='form-group col-md-6 mb-0'),
                Column('document_number', css_class='form-group col-md-6 mb-0'),
                css_class='form-row'
            ),
            Row(
                Column('name', css_class='form-group col-md-6 mb-0'),
                Column('nationality', css_class='form-group col-md-6 mb-0'),
                css_class='form-row'
            ),
            Row(
                Column('issue_date', css_class='form-group col-md-6 mb-0'),
                Column('expiry_date', css_class='form-group col-md-6 mb-0'),
                css_class='form-row'
            ),
            Row(
                Column('document_file', css_class='form-group col-12 mb-0'),
                css_class='form-row'
            ),
            Submit('submit', 'Upload Document', css_class='btn-primary')
        )

class EmergencyContactForm(forms.ModelForm):
    class Meta:
        model = EmergencyContact
        fields = ['name', 'relationship', 'phone_number', 'alternative_phone', 'address']

class EmployeeDocumentForm(forms.ModelForm):
    class Meta:
        model = EmployeeDocument
        fields = [
            'document_type', 'document_number', 'profession_title',
            'issue_date', 'issue_place', 'expiry_date', 'other_info',
            'document_file'
        ]
        widgets = {
            'issue_date': forms.DateInput(attrs={'type': 'date', 'class': 'form-control'}),
            'expiry_date': forms.DateInput(attrs={'type': 'date', 'class': 'form-control'}),
            'other_info': forms.Textarea(attrs={'rows': 3, 'class': 'form-control'}),
        }

    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        self.helper = FormHelper()
        self.helper.form_method = 'post'
        self.helper.form_class = 'form-horizontal'
        self.helper.label_class = 'col-lg-3'
        self.helper.field_class = 'col-lg-9'
        self.helper.layout = Layout(
            Row(
                Column('document_type', css_class='form-group col-md-6 mb-0'),
                Column('document_number', css_class='form-group col-md-6 mb-0'),
                css_class='form-row'
            ),
            Row(
                Column('profession_title', css_class='form-group col-md-12 mb-0'),
                css_class='form-row'
            ),
            Row(
                Column('issue_date', css_class='form-group col-md-6 mb-0'),
                Column('issue_place', css_class='form-group col-md-6 mb-0'),
                css_class='form-row'
            ),
            Row(
                Column('expiry_date', css_class='form-group col-md-12 mb-0'),
                css_class='form-row'
            ),
            Row(
                Column('other_info', css_class='form-group col-12 mb-0'),
                css_class='form-row'
            ),
            Row(
                Column('document_file', css_class='form-group col-12 mb-0'),
                css_class='form-row'
            ),
            Submit('submit', 'Save Document', css_class='btn-primary')
        )

    def clean(self):
        cleaned_data = super().clean()
        issue_date = cleaned_data.get('issue_date')
        expiry_date = cleaned_data.get('expiry_date')

        if issue_date and expiry_date and expiry_date < issue_date:
            raise forms.ValidationError({
                'expiry_date': 'Expiry date cannot be earlier than issue date.'
            })

        return cleaned_data





class SalaryDetailForm(forms.ModelForm):
    class Meta:
        model = SalaryDetail
        fields = [
            'basic_salary',
            'housing_allowance',
            'transportation_allowance',
            'other_allowances',
            'currency',
            'effective_from',
            'notes'
        ]
        widgets = {
            'effective_from': forms.DateInput(attrs={'type': 'date'}),
            'notes': forms.Textarea(attrs={'rows': 3}),
        }

    def clean(self):
        cleaned_data = super().clean()
        other_allowances = cleaned_data.get('other_allowances')
        
        # Validate other_allowances format
        if other_allowances:
            if not isinstance(other_allowances, dict):
                raise forms.ValidationError({
                    'other_allowances': 'Other allowances must be a valid JSON object'
                })
            
            # Validate each allowance value is numeric
            for key, value in other_allowances.items():
                try:
                    float(value)
                except (ValueError, TypeError):
                    raise forms.ValidationError({
                        'other_allowances': f'Value for {key} must be a number'
                    })
        
        return cleaned_data

class SalaryCertificateForm(forms.ModelForm):
    class Meta:
        model = SalaryCertificate
        fields = [
            'purpose',
            'expiry_date'
        ]
        widgets = {
            'purpose': forms.TextInput(attrs={'placeholder': 'e.g., Bank Loan, Visa Application'}),
            'expiry_date': forms.DateInput(attrs={'type': 'date'}),
        }

class SalaryRevisionForm(forms.ModelForm):
    class Meta:
        model = SalaryRevision
        fields = [
            'revision_type',
            'revision_date',
            'reason',
            'reference_number'
        ]
        widgets = {
            'revision_date': forms.DateInput(attrs={'type': 'date'}),
            'reason': forms.Textarea(attrs={'rows': 3}),
            'reference_number': forms.TextInput(attrs={'placeholder': 'Optional reference number'}),
        }

    def clean(self):
        cleaned_data = super().clean()
        revision_date = cleaned_data.get('revision_date')
        
        if revision_date:
            # Ensure revision date is not in the future
            if revision_date > timezone.now().date():
                raise forms.ValidationError({
                    'revision_date': 'Revision date cannot be in the future'
                })
        
        return cleaned_data

```

### ðŸ“„ hrms_project\employees\management\__init__.py
```

```

### ðŸ“„ hrms_project\employees\management\commands\__init__.py
```

```

### ðŸ“„ hrms_project\employees\management\commands\reset_offenses.py
```from django.core.management.base import BaseCommand
from django.utils import timezone
from employees.models import EmployeeOffence


class Command(BaseCommand):
    help = 'Deactivate all offenses from previous years'

    def handle(self, *args, **kwargs):
        current_year = timezone.now().year
        count = EmployeeOffence.objects.filter(
            offense_date__year__lt=current_year,
            is_active=True
        ).count()
        
        if count > 0:
            EmployeeOffence.deactivate_previous_year_offenses()
            self.stdout.write(
                self.style.SUCCESS(f'Successfully deactivated {count} offenses from previous years')
            )
        else:
            self.stdout.write(
                self.style.SUCCESS('No previous year offenses to deactivate')
            )

```

### ðŸ“„ hrms_project\employees\migrations\0001_initial.py
```# Generated by Django 4.2.9 on 2025-01-12 04:36

from django.conf import settings
import django.core.validators
from django.db import migrations, models
import django.db.models.deletion
import django.utils.timezone


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='AssetType',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100, unique=True)),
                ('description', models.TextField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
            ],
            options={
                'verbose_name': 'Asset Type',
                'verbose_name_plural': 'Asset Types',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='Bank',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100)),
                ('swift_code', models.CharField(max_length=20)),
            ],
        ),
        migrations.CreateModel(
            name='CostProfitCenter',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100)),
                ('code', models.CharField(max_length=20, unique=True)),
                ('description', models.TextField(blank=True, null=True)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Cost/Profit Center',
                'verbose_name_plural': 'Cost/Profit Centers',
                'ordering': ['code'],
            },
        ),
        migrations.CreateModel(
            name='Department',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100)),
                ('name_ar', models.CharField(blank=True, max_length=100, null=True, verbose_name='Name (Arabic)')),
                ('code', models.CharField(default='DEPT', max_length=20, unique=True)),
                ('manager', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('parent', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='employees.department')),
            ],
        ),
        migrations.CreateModel(
            name='Division',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100)),
                ('name_ar', models.CharField(max_length=100, verbose_name='Name (Arabic)')),
                ('code', models.CharField(max_length=20, unique=True)),
                ('department', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='employees.department')),
            ],
        ),
        migrations.CreateModel(
            name='Employee',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('employee_number', models.CharField(default='EMP0001', max_length=20, unique=True)),
                ('profile_picture', models.ImageField(blank=True, null=True, upload_to='employee_pictures/')),
                ('first_name', models.CharField(default='First', max_length=50)),
                ('middle_name', models.CharField(blank=True, max_length=50, null=True)),
                ('last_name', models.CharField(default='Last', max_length=50)),
                ('first_name_ar', models.CharField(blank=True, max_length=50, null=True, verbose_name='First Name (Arabic)')),
                ('middle_name_ar', models.CharField(blank=True, max_length=50, null=True, verbose_name='Middle Name (Arabic)')),
                ('last_name_ar', models.CharField(blank=True, max_length=50, null=True, verbose_name='Last Name (Arabic)')),
                ('date_of_birth', models.DateField(blank=True, null=True)),
                ('gender', models.CharField(blank=True, choices=[('M', 'Male'), ('F', 'Female')], max_length=1, null=True)),
                ('marital_status', models.CharField(blank=True, choices=[('S', 'Single'), ('M', 'Married'), ('D', 'Divorced'), ('W', 'Widowed')], max_length=20, null=True)),
                ('nationality', models.CharField(blank=True, choices=[('ALGERIAN', 'Algerian'), ('AMERICAN', 'American'), ('ARGENTINA', 'Argentina'), ('AUSTRALIAN', 'Australian'), ('BAHRAINI', 'Bahraini'), ('BANGLADESHI', 'Bangladeshi'), ('BELGIAN', 'Belgian'), ('BRAZILIAN', 'Brazilian'), ('BRITISH', 'British'), ('BULGARIAN', 'Bulgarian'), ('CAMEROONIAN', 'Cameroonian'), ('CANADIAN', 'Canadian'), ('CHILEAN', 'Chilean'), ('CHINESE', 'Chinese'), ('COLOMBIAN', 'Colombian'), ('CROATIAN', 'Croatian'), ('CUBAN', 'Cuban'), ('CYPRIOT', 'Cypriot'), ('CZECH', 'Czech'), ('DANISH', 'Danish'), ('DJIBOUTIAN', 'Djiboutian'), ('EGYPTIAN', 'Egyptian'), ('FILIPINO', 'Filipino'), ('FRENCH', 'French'), ('GERMAN', 'German'), ('GHANAIAN', 'Ghanaian'), ('GREEK', 'Greek'), ('DUTCH', 'Dutch'), ('HONG_KONGER', 'Hong Konger'), ('INDIAN', 'Indian'), ('INDONESIAN', 'Indonesian'), ('IRANIAN', 'Iranian'), ('IRAQI', 'Iraqi'), ('IRISH', 'Irish'), ('ITALIAN', 'Italian'), ('JAMAICAN', 'Jamaican'), ('JAPANESE', 'Japanese'), ('JORDANIAN', 'Jordanian'), ('KENYAN', 'Kenyan'), ('KUWAITI', 'Kuwaiti'), ('LEBANESE', 'Lebanese'), ('MALAWIAN', 'Malawian'), ('MALAYSIAN', 'Malaysian'), ('MEXICAN', 'Mexican'), ('MOROCCAN', 'Moroccan'), ('NEPALI', 'Nepali'), ('DUTCH', 'Dutch'), ('NEW_ZEALANDER', 'New Zealander'), ('NIGERIAN', 'Nigerian'), ('NORWEGIAN', 'Norwegian'), ('OMANI', 'Omani'), ('PAKISTANI', 'Pakistani'), ('POLISH', 'Polish'), ('PORTUGUESE', 'Portuguese'), ('RUSSIAN', 'Russian'), ('SAUDI', 'Saudi'), ('SCOTTISH', 'Scottish'), ('SERBIAN', 'Serbian'), ('SEYCHELLOIS', 'Seychellois'), ('SINGAPOREAN', 'Singaporean'), ('SOUTH_AFRICAN', 'South African'), ('SPANISH', 'Spanish'), ('SRI_LANKAN', 'Sri Lankan'), ('SUDANESE', 'Sudanese'), ('SWEDISH', 'Swedish'), ('SWISS', 'Swiss'), ('SYRIAN', 'Syrian'), ('TAIWANESE', 'Taiwanese'), ('TANZANIAN', 'Tanzanian'), ('THAI', 'Thai'), ('TUNISIAN', 'Tunisian'), ('TURKISH', 'Turkish'), ('EMIRATI', 'Emirati'), ('UGANDAN', 'Ugandan'), ('UKRAINIAN', 'Ukrainian'), ('VENEZUELAN', 'Venezuelan'), ('VIETNAMESE', 'Vietnamese'), ('YEMENI', 'Yemeni'), ('ZIMBABWEAN', 'Zimbabwean'), ('OTHER', 'Other')], max_length=50, null=True, verbose_name='Nationality')),
                ('religion', models.CharField(blank=True, max_length=50, null=True)),
                ('education_category', models.CharField(blank=True, max_length=50, null=True)),
                ('cpr_number', models.CharField(blank=True, max_length=20, null=True, unique=True)),
                ('email', models.EmailField(blank=True, max_length=254, null=True)),
                ('primary_phone', models.CharField(blank=True, max_length=20, null=True, verbose_name='Primary Number')),
                ('secondary_phone', models.CharField(blank=True, max_length=20, null=True, verbose_name='Secondary Number')),
                ('address', models.TextField(blank=True, null=True)),
                ('in_probation', models.BooleanField(default=True)),
                ('designation', models.CharField(blank=True, max_length=100, null=True)),
                ('contract_type', models.CharField(blank=True, choices=[('FT', 'Full Time'), ('PT', 'Part Time'), ('CT', 'Contract'), ('INT', 'Intern')], max_length=20, null=True)),
                ('joined_date', models.DateField(blank=True, null=True)),
                ('employee_category', models.CharField(blank=True, choices=[('GEN', 'General'), ('SUP', 'Supervisor'), ('MGR', 'Manager'), ('EXE', 'Executive')], max_length=20, null=True)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('cost_center', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='cost_center_employees', to='employees.costprofitcenter')),
                ('department', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='employees.department')),
                ('division', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='employees.division')),
            ],
            options={
                'verbose_name': 'Employee',
                'verbose_name_plural': 'Employees',
                'ordering': ['employee_number'],
            },
        ),
        migrations.CreateModel(
            name='EmployeeOffence',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('offense_date', models.DateField()),
                ('applied_penalty', models.CharField(choices=[('ORAL', 'Oral Warning'), ('WRITTEN', 'Written Warning'), ('D005', '0.05 Day Deduction'), ('D010', '0.10 Day Deduction'), ('D015', '0.15 Day Deduction'), ('D025', '0.25 Day Deduction'), ('D030', '0.30 Day Deduction'), ('D050', '0.50 Day Deduction'), ('D075', '0.75 Day Deduction'), ('D100', '1 Day Deduction'), ('D200', '2 Days Deduction'), ('D300', '3 Days Deduction'), ('D500', '5 Days Deduction'), ('DISMISS', 'Dismissal')], max_length=10)),
                ('original_penalty', models.CharField(choices=[('ORAL', 'Oral Warning'), ('WRITTEN', 'Written Warning'), ('D005', '0.05 Day Deduction'), ('D010', '0.10 Day Deduction'), ('D015', '0.15 Day Deduction'), ('D025', '0.25 Day Deduction'), ('D030', '0.30 Day Deduction'), ('D050', '0.50 Day Deduction'), ('D075', '0.75 Day Deduction'), ('D100', '1 Day Deduction'), ('D200', '2 Days Deduction'), ('D300', '3 Days Deduction'), ('D500', '5 Days Deduction'), ('DISMISS', 'Dismissal')], max_length=10)),
                ('offense_count', models.PositiveIntegerField(default=1)),
                ('details', models.TextField()),
                ('warning_letter', models.FileField(blank=True, null=True, upload_to='offense_documents/')),
                ('acknowledgment', models.FileField(blank=True, null=True, upload_to='offense_documents/')),
                ('is_acknowledged', models.BooleanField(default=False)),
                ('acknowledged_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_offence_records', to=settings.AUTH_USER_MODEL)),
                ('employee', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='employee_offence_records', to='employees.employee')),
                ('modified_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='modified_offence_records', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Employee Offense',
                'verbose_name_plural': 'Employee Offenses',
                'ordering': ['-offense_date', '-created_at'],
            },
        ),
        migrations.CreateModel(
            name='Location',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100)),
                ('address', models.TextField()),
                ('code', models.CharField(max_length=20, unique=True)),
            ],
        ),
        migrations.CreateModel(
            name='OffenseRule',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('rule_id', models.CharField(max_length=20, unique=True)),
                ('group', models.CharField(choices=[('ATTENDANCE', 'Attendance'), ('BEHAVIOR', 'Behavior'), ('PERFORMANCE', 'Performance'), ('SAFETY', 'Safety'), ('PROPERTY', 'Property'), ('OTHER', 'Other')], max_length=20)),
                ('name', models.CharField(max_length=200)),
                ('description', models.TextField()),
                ('first_penalty', models.CharField(choices=[('ORAL', 'Oral Warning'), ('WRITTEN', 'Written Warning'), ('D005', '0.05 Day Deduction'), ('D010', '0.10 Day Deduction'), ('D015', '0.15 Day Deduction'), ('D025', '0.25 Day Deduction'), ('D030', '0.30 Day Deduction'), ('D050', '0.50 Day Deduction'), ('D075', '0.75 Day Deduction'), ('D100', '1 Day Deduction'), ('D200', '2 Days Deduction'), ('D300', '3 Days Deduction'), ('D500', '5 Days Deduction'), ('DISMISS', 'Dismissal')], max_length=10)),
                ('second_penalty', models.CharField(choices=[('ORAL', 'Oral Warning'), ('WRITTEN', 'Written Warning'), ('D005', '0.05 Day Deduction'), ('D010', '0.10 Day Deduction'), ('D015', '0.15 Day Deduction'), ('D025', '0.25 Day Deduction'), ('D030', '0.30 Day Deduction'), ('D050', '0.50 Day Deduction'), ('D075', '0.75 Day Deduction'), ('D100', '1 Day Deduction'), ('D200', '2 Days Deduction'), ('D300', '3 Days Deduction'), ('D500', '5 Days Deduction'), ('DISMISS', 'Dismissal')], max_length=10)),
                ('third_penalty', models.CharField(choices=[('ORAL', 'Oral Warning'), ('WRITTEN', 'Written Warning'), ('D005', '0.05 Day Deduction'), ('D010', '0.10 Day Deduction'), ('D015', '0.15 Day Deduction'), ('D025', '0.25 Day Deduction'), ('D030', '0.30 Day Deduction'), ('D050', '0.50 Day Deduction'), ('D075', '0.75 Day Deduction'), ('D100', '1 Day Deduction'), ('D200', '2 Days Deduction'), ('D300', '3 Days Deduction'), ('D500', '5 Days Deduction'), ('DISMISS', 'Dismissal')], max_length=10)),
                ('fourth_penalty', models.CharField(choices=[('ORAL', 'Oral Warning'), ('WRITTEN', 'Written Warning'), ('D005', '0.05 Day Deduction'), ('D010', '0.10 Day Deduction'), ('D015', '0.15 Day Deduction'), ('D025', '0.25 Day Deduction'), ('D030', '0.30 Day Deduction'), ('D050', '0.50 Day Deduction'), ('D075', '0.75 Day Deduction'), ('D100', '1 Day Deduction'), ('D200', '2 Days Deduction'), ('D300', '3 Days Deduction'), ('D500', '5 Days Deduction'), ('DISMISS', 'Dismissal')], max_length=10)),
                ('remarks', models.TextField(blank=True, null=True)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Offense Rule',
                'verbose_name_plural': 'Offense Rules',
                'ordering': ['group', 'rule_id'],
            },
        ),
        migrations.CreateModel(
            name='OffenseDocument',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('document', models.FileField(upload_to='offense_documents/')),
                ('document_type', models.CharField(max_length=50)),
                ('notes', models.TextField(blank=True, null=True)),
                ('uploaded_at', models.DateTimeField(auto_now_add=True)),
                ('offense', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='documents', to='employees.employeeoffence')),
            ],
            options={
                'ordering': ['-uploaded_at'],
            },
        ),
        migrations.CreateModel(
            name='LifeEvent',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('event_type', models.CharField(choices=[('MAR', 'Marriage'), ('CHD', 'Child Birth'), ('DEA', 'Death in Family'), ('OTH', 'Other')], max_length=3)),
                ('date', models.DateField()),
                ('description', models.TextField()),
                ('documents', models.FileField(blank=True, upload_to='life_event_documents/')),
                ('employee', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='life_events', to='employees.employee')),
            ],
        ),
        migrations.AddField(
            model_name='employeeoffence',
            name='rule',
            field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='employees.offenserule'),
        ),
        migrations.CreateModel(
            name='EmployeeEducation',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('institution', models.CharField(default='Unknown Institution', max_length=100)),
                ('major', models.CharField(default='General', max_length=100)),
                ('degree', models.CharField(default='Unknown Degree', max_length=50)),
                ('graduation_year', models.IntegerField(default=2000)),
                ('gpa', models.DecimalField(blank=True, decimal_places=2, max_digits=3, null=True)),
                ('description', models.TextField(blank=True)),
                ('employee', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='education', to='employees.employee')),
            ],
        ),
        migrations.CreateModel(
            name='EmployeeDocument',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('document_type', models.CharField(choices=[('PASSPORT', 'Passport'), ('RESIDENT', 'Resident Permit'), ('CPR', 'C.P.R'), ('GATE', 'Gate Pass'), ('CONTRACT', 'Contract'), ('CV', 'CV'), ('DRIVING', 'Driving License')], max_length=10)),
                ('document_number', models.CharField(max_length=50)),
                ('profession_title', models.CharField(blank=True, max_length=100, null=True, verbose_name='Profession / Title')),
                ('issue_date', models.DateField(blank=True, null=True)),
                ('issue_place', models.CharField(blank=True, max_length=100, null=True)),
                ('expiry_date', models.DateField(blank=True, null=True)),
                ('other_info', models.TextField(blank=True, null=True)),
                ('document_file', models.FileField(blank=True, null=True, upload_to='employee_documents/%Y/%m/', validators=[django.core.validators.FileExtensionValidator(allowed_extensions=['pdf', 'jpg', 'jpeg', 'png', 'doc', 'docx'])])),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('employee', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='documents', to='employees.employee')),
            ],
            options={
                'verbose_name': 'Employee Document',
                'verbose_name_plural': 'Employee Documents',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='EmployeeDependent',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100)),
                ('relation', models.CharField(choices=[('spouse', 'Spouse'), ('child', 'Child'), ('parent', 'Parent'), ('sibling', 'Sibling'), ('other', 'Other')], max_length=20)),
                ('date_of_birth', models.DateField()),
                ('passport_number', models.CharField(blank=True, max_length=50, null=True)),
                ('passport_expiry', models.DateField(blank=True, null=True)),
                ('cpr_number', models.CharField(blank=True, max_length=20, null=True)),
                ('cpr_expiry', models.DateField(blank=True, null=True)),
                ('valid_passage', models.BooleanField(default=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('employee', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='dependents', to='employees.employee')),
            ],
            options={
                'verbose_name': 'Employee Dependent',
                'verbose_name_plural': 'Employee Dependents',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='EmployeeBankAccount',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('bank', models.CharField(max_length=100)),
                ('account_number', models.CharField(max_length=50)),
                ('iban', models.CharField(max_length=50, verbose_name='IBAN No')),
                ('transfer_amount', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True, verbose_name='Amount to be Transferred')),
                ('is_primary', models.BooleanField(default=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('employee', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='bank_accounts', to='employees.employee')),
            ],
            options={
                'verbose_name': 'Employee Bank Account',
                'verbose_name_plural': 'Employee Bank Accounts',
                'ordering': ['-is_primary', '-created_at'],
            },
        ),
        migrations.CreateModel(
            name='EmployeeAsset',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('asset_name', models.CharField(max_length=100)),
                ('asset_number', models.CharField(blank=True, max_length=50, null=True)),
                ('issue_date', models.DateField(default=django.utils.timezone.now)),
                ('return_date', models.DateField(blank=True, null=True)),
                ('condition', models.TextField(default='New')),
                ('return_condition', models.TextField(blank=True, null=True)),
                ('value', models.DecimalField(decimal_places=2, default=0.0, max_digits=10)),
                ('notes', models.TextField(blank=True, null=True)),
                ('return_notes', models.TextField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('asset_type', models.ForeignKey(null=True, on_delete=django.db.models.deletion.PROTECT, related_name='assets', to='employees.assettype')),
                ('employee', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='assets', to='employees.employee')),
            ],
            options={
                'verbose_name': 'Employee Asset',
                'verbose_name_plural': 'Employee Assets',
                'ordering': ['-created_at'],
            },
        ),
        migrations.AddField(
            model_name='employee',
            name='location',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='employees.location'),
        ),
        migrations.AddField(
            model_name='employee',
            name='profit_center',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='profit_center_employees', to='employees.costprofitcenter'),
        ),
        migrations.CreateModel(
            name='EmergencyContact',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100)),
                ('relationship', models.CharField(max_length=50)),
                ('phone_number', models.CharField(max_length=20)),
                ('alternative_phone', models.CharField(blank=True, max_length=20)),
                ('address', models.TextField(blank=True)),
                ('employee', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='emergency_contacts', to='employees.employee')),
            ],
        ),
        migrations.CreateModel(
            name='DependentDocument',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('document_type', models.CharField(choices=[('PASSPORT', 'Passport'), ('CPR', 'CPR'), ('BIRTH_CERTIFICATE', 'Birth Certificate'), ('MARRIAGE_CERTIFICATE', 'Marriage Certificate'), ('OTHER', 'Other')], max_length=50)),
                ('document_number', models.CharField(blank=True, max_length=50, null=True)),
                ('name', models.CharField(max_length=255)),
                ('issue_date', models.DateField(blank=True, null=True)),
                ('expiry_date', models.DateField(blank=True, null=True)),
                ('nationality', models.CharField(blank=True, choices=[('ALGERIAN', 'Algerian'), ('AMERICAN', 'American'), ('ARGENTINA', 'Argentina'), ('AUSTRALIAN', 'Australian'), ('BAHRAINI', 'Bahraini'), ('BANGLADESHI', 'Bangladeshi'), ('BELGIAN', 'Belgian'), ('BRAZILIAN', 'Brazilian'), ('BRITISH', 'British'), ('BULGARIAN', 'Bulgarian'), ('CAMEROONIAN', 'Cameroonian'), ('CANADIAN', 'Canadian'), ('CHILEAN', 'Chilean'), ('CHINESE', 'Chinese'), ('COLOMBIAN', 'Colombian'), ('CROATIAN', 'Croatian'), ('CUBAN', 'Cuban'), ('CYPRIOT', 'Cypriot'), ('CZECH', 'Czech'), ('DANISH', 'Danish'), ('DJIBOUTIAN', 'Djiboutian'), ('EGYPTIAN', 'Egyptian'), ('FILIPINO', 'Filipino'), ('FRENCH', 'French'), ('GERMAN', 'German'), ('GHANAIAN', 'Ghanaian'), ('GREEK', 'Greek'), ('DUTCH', 'Dutch'), ('HONG_KONGER', 'Hong Konger'), ('INDIAN', 'Indian'), ('INDONESIAN', 'Indonesian'), ('IRANIAN', 'Iranian'), ('IRAQI', 'Iraqi'), ('IRISH', 'Irish'), ('ITALIAN', 'Italian'), ('JAMAICAN', 'Jamaican'), ('JAPANESE', 'Japanese'), ('JORDANIAN', 'Jordanian'), ('KENYAN', 'Kenyan'), ('KUWAITI', 'Kuwaiti'), ('LEBANESE', 'Lebanese'), ('MALAWIAN', 'Malawian'), ('MALAYSIAN', 'Malaysian'), ('MEXICAN', 'Mexican'), ('MOROCCAN', 'Moroccan'), ('NEPALI', 'Nepali'), ('DUTCH', 'Dutch'), ('NEW_ZEALANDER', 'New Zealander'), ('NIGERIAN', 'Nigerian'), ('NORWEGIAN', 'Norwegian'), ('OMANI', 'Omani'), ('PAKISTANI', 'Pakistani'), ('POLISH', 'Polish'), ('PORTUGUESE', 'Portuguese'), ('RUSSIAN', 'Russian'), ('SAUDI', 'Saudi'), ('SCOTTISH', 'Scottish'), ('SERBIAN', 'Serbian'), ('SEYCHELLOIS', 'Seychellois'), ('SINGAPOREAN', 'Singaporean'), ('SOUTH_AFRICAN', 'South African'), ('SPANISH', 'Spanish'), ('SRI_LANKAN', 'Sri Lankan'), ('SUDANESE', 'Sudanese'), ('SWEDISH', 'Swedish'), ('SWISS', 'Swiss'), ('SYRIAN', 'Syrian'), ('TAIWANESE', 'Taiwanese'), ('TANZANIAN', 'Tanzanian'), ('THAI', 'Thai'), ('TUNISIAN', 'Tunisian'), ('TURKISH', 'Turkish'), ('EMIRATI', 'Emirati'), ('UGANDAN', 'Ugandan'), ('UKRAINIAN', 'Ukrainian'), ('VENEZUELAN', 'Venezuelan'), ('VIETNAMESE', 'Vietnamese'), ('YEMENI', 'Yemeni'), ('ZIMBABWEAN', 'Zimbabwean'), ('OTHER', 'Other')], max_length=50, null=True)),
                ('document_file', models.FileField(blank=True, null=True, upload_to='dependent_documents/')),
                ('status', models.CharField(default='active', max_length=20)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('dependent', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='documents', to='employees.employeedependent')),
            ],
        ),
    ]

```

### ðŸ“„ hrms_project\employees\migrations\0002_add_is_active_to_offense.py
```# Generated by Django 4.2.9 on 2025-01-12 05:12

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('employees', '0001_initial'),
    ]

    operations = [
        migrations.AddField(
            model_name='employeeoffence',
            name='is_active',
            field=models.BooleanField(default=True),
        ),
    ]

```

### ðŸ“„ hrms_project\employees\migrations\0003_add_initial_offense_rules.py
```from django.db import migrations

def convert_penalty_to_code(penalty):
    penalty_map = {
        'Oral Warning': 'ORAL',
        'Written Warning': 'WRITTEN',
        '0.05': 'D005',
        '0.10': 'D010',
        '0.15': 'D015',
        '0.25': 'D025',
        '0.50': 'D050',
        '0.75': 'D075',
        '1': 'D100',
        '2': 'D200',
        '3': 'D300',
        '5': 'D500',
        'Dismissal': 'DISMISSAL',
    }
    return penalty_map.get(penalty, penalty)

def add_initial_offense_rules(apps, schema_editor):
    OffenseRule = apps.get_model('employees', 'OffenseRule')

    rules = [
        {
            'rule_id': '1.1',
            'group': 'ATTENDANCE_TIME',
            'name': 'Tardiness - Up to 15 Min (No Disruption)',
            'description': "Reporting late up to 15 minutes beyond the attendance time without permission or a valid excuse, where the delay doesn't hamper other workers.",
            'first_penalty': convert_penalty_to_code('Oral Warning'),
            'second_penalty': convert_penalty_to_code('Written Warning'),
            'third_penalty': convert_penalty_to_code('0.05'),
            'fourth_penalty': convert_penalty_to_code('0.10'),
            'remarks': '',
        },
        {
            'rule_id': '1.2',
            'group': 'ATTENDANCE_TIME',
            'name': 'Tardiness - Up to 15 Min (With Disruption)',
            'description': "Reporting late up to 15 minutes beyond the attendance time without permission or a valid excuse, resulting in the disruption of other workers.",
            'first_penalty': convert_penalty_to_code('Oral Warning'),
            'second_penalty': convert_penalty_to_code('Written Warning'),
            'third_penalty': convert_penalty_to_code('0.25'),
            'fourth_penalty': convert_penalty_to_code('0.50'),
            'remarks': '',
        },
        {
            'rule_id': '1.3',
            'group': 'ATTENDANCE_TIME',
            'name': 'Tardiness - 15 to 30 Min (No Disruption)',
            'description': "Reporting late more than 15 minutes but up to 30 minutes beyond the attendance time without permission or valid excuse, where the delay doesn't hamper other workers.",
            'first_penalty': convert_penalty_to_code('Written Warning'),
            'second_penalty': convert_penalty_to_code('0.15'),
            'third_penalty': convert_penalty_to_code('0.25'),
            'fourth_penalty': convert_penalty_to_code('0.50'),
            'remarks': '',
        },
        {
            'rule_id': '1.4',
            'group': 'ATTENDANCE_TIME',
            'name': 'Tardiness - 15 to 30 Min (With Disruption)',
            'description': "Reporting late more than 15 minutes but up to 30 minutes beyond the attendance time without permission or valid excuse, resulting in the disruption of other workers.",
            'first_penalty': convert_penalty_to_code('Written Warning'),
            'second_penalty': convert_penalty_to_code('0.50'),
            'third_penalty': convert_penalty_to_code('0.75'),
            'fourth_penalty': convert_penalty_to_code('1'),
            'remarks': '',
        },
        {
            'rule_id': '1.5',
            'group': 'ATTENDANCE_TIME',
            'name': 'Tardiness - 30 to 60 Min (No Disruption)',
            'description': "Reporting late more than 15 minutes and up to 60 minutes beyond the attendance time without permission or a valid excuse, where the delay doesn't disrupt other workers.",
            'first_penalty': convert_penalty_to_code('0.25'),
            'second_penalty': convert_penalty_to_code('0.50'),
            'third_penalty': convert_penalty_to_code('0.75'),
            'fourth_penalty': convert_penalty_to_code('1'),
            'remarks': '',
        },
        {
            'rule_id': '1.6',
            'group': 'ATTENDANCE_TIME',
            'name': 'Tardiness - 30 to 60 Min (With Disruption)',
            'description': "Reporting late more than 15 minutes and up to 60 minutes beyond the attendance time without permission or a valid excuse, where the delay disrupts other workers.",
            'first_penalty': convert_penalty_to_code('0.30'),
            'second_penalty': convert_penalty_to_code('0.50'),
            'third_penalty': convert_penalty_to_code('0.75'),
            'fourth_penalty': convert_penalty_to_code('2'),
            'remarks': '',
        },
        {
            'rule_id': '1.7',
            'group': 'ATTENDANCE_TIME',
            'name': 'Tardiness - Over 60 Min',
            'description': "Reporting late more than one hour beyond the attendance time without permission or a valid excuse, where the delay does not result in hampering other workers.",
            'first_penalty': convert_penalty_to_code('Written Warning'),
            'second_penalty': convert_penalty_to_code('1'),
            'third_penalty': convert_penalty_to_code('2'),
            'fourth_penalty': convert_penalty_to_code('3'),
            'remarks': 'In addition to deducting delay hours.',
        },
        {
            'rule_id': '1.8',
            'group': 'ATTENDANCE_TIME',
            'name': 'Early Departure - Up to 15 Min',
            'description': "Leaving work early, no more than 15 minutes prior to the set hour without permission or a valid excuse.",
            'first_penalty': convert_penalty_to_code('Written Warning'),
            'second_penalty': convert_penalty_to_code('0.10'),
            'third_penalty': convert_penalty_to_code('0.25'),
            'fourth_penalty': convert_penalty_to_code('1'),
            'remarks': '',
        },
        {
            'rule_id': '1.9',
            'group': 'ATTENDANCE_TIME',
            'name': 'Early Departure - Over 15 Min',
            'description': "Leaving work early, more than 15 minutes prior to the leaving hour without permission or a valid excuse.",
            'first_penalty': convert_penalty_to_code('Written Warning'),
            'second_penalty': convert_penalty_to_code('0.10'),
            'third_penalty': convert_penalty_to_code('0.25'),
            'fourth_penalty': convert_penalty_to_code('1'),
            'remarks': 'In addition to deducting delay hours.',
        },
        {
            'rule_id': '1.10',
            'group': 'ATTENDANCE_TIME',
            'name': 'Unauthorized Overstay',
            'description': "Staying at work or returning to work after the working hours without a reasonable excuse.",
            'first_penalty': convert_penalty_to_code('Written Warning'),
            'second_penalty': convert_penalty_to_code('0.10'),
            'third_penalty': convert_penalty_to_code('0.25'),
            'fourth_penalty': convert_penalty_to_code('1'),
            'remarks': '',
        },
        {
            'rule_id': '2.1',
            'group': 'WORK_ORG',
            'name': 'Unauthorized Exit Use',
            'description': "Getting out from any exit other than those designated for this purpose.",
            'first_penalty': convert_penalty_to_code('Oral Warning'),
            'second_penalty': convert_penalty_to_code('Written Warning'),
            'third_penalty': convert_penalty_to_code('0.15'),
            'fourth_penalty': convert_penalty_to_code('0.25'),
            'remarks': '',
        },
        {
            'rule_id': '2.2',
            'group': 'WORK_ORG',
            'name': 'Unauthorized Visitors',
            'description': "Receiving visitors other than organizationâ€™s workers at the workplace without permission from management.",
            'first_penalty': convert_penalty_to_code('Oral Warning'),
            'second_penalty': convert_penalty_to_code('Written Warning'),
            'third_penalty': convert_penalty_to_code('0.15'),
            'fourth_penalty': convert_penalty_to_code('0.25'),
            'remarks': '',
        },
        {
            'rule_id': '2.3',
            'group': 'WORK_ORG',
            'name': 'Unauthorized Eating',
            'description': "Eating in any place or at any time other than those set for this purpose.",
            'first_penalty': convert_penalty_to_code('Oral Warning'),
            'second_penalty': convert_penalty_to_code('Written Warning'),
            'third_penalty': convert_penalty_to_code('0.15'),
            'fourth_penalty': convert_penalty_to_code('0.25'),
            'remarks': '',
        },
        {
            'rule_id': '2.4',
            'group': 'WORK_ORG',
            'name': 'Sleeping on Duty',
            'description': "Falling asleep during the working hours.",
            'first_penalty': convert_penalty_to_code('Oral Warning'),
            'second_penalty': convert_penalty_to_code('Written Warning'),
            'third_penalty': convert_penalty_to_code('0.25'),
            'fourth_penalty': convert_penalty_to_code('0.50'),
            'remarks': '',
        },
        {
            'rule_id': '2.5',
            'group': 'WORK_ORG',
            'name': 'Unauthorized Phone Use',
            'description': "Using organization's telephone for private purposes without permission.",
            'first_penalty': convert_penalty_to_code('Oral Warning'),
            'second_penalty': convert_penalty_to_code('Written Warning'),
            'third_penalty': convert_penalty_to_code('0.25'),
            'fourth_penalty': convert_penalty_to_code('0.50'),
            'remarks': '',
        },
        {
            'rule_id': '2.6',
            'group': 'WORK_ORG',
            'name': 'Loitering',
            'description': "Loitering or being caught anywhere other than set places during working hours.",
            'first_penalty': convert_penalty_to_code('0.10'),
            'second_penalty': convert_penalty_to_code('0.25'),
            'third_penalty': convert_penalty_to_code('0.50'),
            'fourth_penalty': convert_penalty_to_code('1'),
            'remarks': '',
        },
        {
            'rule_id': '2.7',
            'group': 'WORK_ORG',
            'name': 'Attendance Sheet Manipulation',
            'description': "Manipulation of the attendance sheet.",
            'first_penalty': convert_penalty_to_code('0.25'),
            'second_penalty': convert_penalty_to_code('0.50'),
            'third_penalty': convert_penalty_to_code('1'),
            'fourth_penalty': convert_penalty_to_code('2'),
            'remarks': '',
        },
        {
            'rule_id': '2.8',
            'group': 'WORK_ORG',
            'name': 'Disobeying Workflow Orders',
            'description': "Disobeying regular orders related to the workflow.",
            'first_penalty': convert_penalty_to_code('0.25'),
            'second_penalty': convert_penalty_to_code('0.50'),
            'third_penalty': convert_penalty_to_code('1'),
            'fourth_penalty': convert_penalty_to_code('2'),
            'remarks': '',
        },
        {
            'rule_id': '2.9',
            'group': 'WORK_ORG',
            'name': 'Failure to Follow Instructions',
            'description': "Failure to perform instructions related to workflow, provided those instructions are posted in a visible place.",
            'first_penalty': convert_penalty_to_code('0.25'),
            'second_penalty': convert_penalty_to_code('0.50'),
            'third_penalty': convert_penalty_to_code('1'),
            'fourth_penalty': convert_penalty_to_code('2'),
            'remarks': '',
        },
        {
            'rule_id': '2.10',
            'group': 'WORK_ORG',
            'name': 'Sleeping on Duty (Critical Role)',
            'description': "Falling asleep in a position or role that requires being permanently awake.",
            'first_penalty': convert_penalty_to_code('0.50'),
            'second_penalty': convert_penalty_to_code('1'),
            'third_penalty': convert_penalty_to_code('2'),
            'fourth_penalty': convert_penalty_to_code('3'),
            'remarks': '',
        },
        {
            'rule_id': '2.11',
            'group': 'WORK_ORG',
            'name': 'Incitement Against Instructions',
            'description': "Incitement against special instructions and orders.",
            'first_penalty': convert_penalty_to_code('2'),
            'second_penalty': convert_penalty_to_code('3'),
            'third_penalty': convert_penalty_to_code('5'),
            'fourth_penalty': convert_penalty_to_code('Dismissal'),
            'remarks': '',
        },
        {
            'rule_id': '2.12',
            'group': 'WORK_ORG',
            'name': 'Negligence Causing Harm',
            'description': "Neglect or negligence in work that causes harm to workers' health or safety, or damage to materials and tools.",
            'first_penalty': convert_penalty_to_code('2'),
            'second_penalty': convert_penalty_to_code('3'),
            'third_penalty': convert_penalty_to_code('5'),
            'fourth_penalty': convert_penalty_to_code('Dismissal'),
            'remarks': '',
        },
        {
            'rule_id': '2.13',
            'group': 'WORK_ORG',
            'name': 'Prohibited Substance Use',
            'description': "Smoking where it is forbidden to maintain workers' health, or drinking alcohol in the workplace.",
            'first_penalty': convert_penalty_to_code('2'),
            'second_penalty': convert_penalty_to_code('3'),
            'third_penalty': convert_penalty_to_code('5'),
            'fourth_penalty': convert_penalty_to_code('Dismissal'),
            'remarks': 'Worker may be dismissed if the violation results in gross damage',
        },
        {
            'rule_id': '3.1',
            'group': 'BEHAVIOR',
            'name': 'Unauthorized Fundraising',
            'description': "Raising funds or money without permission.",
            'first_penalty': convert_penalty_to_code('Oral Warning'),
            'second_penalty': convert_penalty_to_code('0.10'),
            'third_penalty': convert_penalty_to_code('0.25'),
            'fourth_penalty': convert_penalty_to_code('0.50'),
            'remarks': '',
        },
        {
            'rule_id': '3.2',
            'group': 'BEHAVIOR',
            'name': 'Unauthorized Posting',
            'description': "Posting on walls either by writing or taping ads.",
            'first_penalty': convert_penalty_to_code('Oral Warning'),
            'second_penalty': convert_penalty_to_code('Written Warning'),
            'third_penalty': convert_penalty_to_code('0.25'),
            'fourth_penalty': convert_penalty_to_code('0.50'),
            'remarks': '',
        },
        {
            'rule_id': '3.3',
            'group': 'BEHAVIOR',
            'name': 'Wasteful Material Consumption',
            'description': "Wasteful consumption of raw materials without permission.",
            'first_penalty': convert_penalty_to_code('Written Warning'),
            'second_penalty': convert_penalty_to_code('0.50'),
            'third_penalty': convert_penalty_to_code('1'),
            'fourth_penalty': convert_penalty_to_code('2'),
            'remarks': '',
        },
        {
            'rule_id': '3.4',
            'group': 'BEHAVIOR',
            'name': 'Misrepresentation Causing Dispute',
            'description': "Misrepresentation regarding seniors or peers in a way that results in suspending work or arising disputes internally within the Company.",
            'first_penalty': convert_penalty_to_code('0.25'),
            'second_penalty': convert_penalty_to_code('0.50'),
            'third_penalty': convert_penalty_to_code('1'),
            'fourth_penalty': convert_penalty_to_code('2'),
            'remarks': '',
        },
        {
            'rule_id': '3.5',
            'group': 'BEHAVIOR',
            'name': 'Refusal of Search',
            'description': "Refusal of search while leaving work.",
            'first_penalty': convert_penalty_to_code('0.25'),
            'second_penalty': convert_penalty_to_code('0.50'),
            'third_penalty': convert_penalty_to_code('1'),
            'fourth_penalty': convert_penalty_to_code('2'),
            'remarks': '',
        },
        {
            'rule_id': '3.6',
            'group': 'BEHAVIOR',
            'name': 'Violation of Health Instructions',
            'description': "Violation of health instructions while being at work.",
            'first_penalty': convert_penalty_to_code('0.50'),
            'second_penalty': convert_penalty_to_code('1'),
            'third_penalty': convert_penalty_to_code('2'),
            'fourth_penalty': convert_penalty_to_code('5'),
            'remarks': '',
        },
        {
            'rule_id': '3.7',
            'group': 'BEHAVIOR',
            'name': 'Unauthorized Use of Materials',
            'description': "Using objects, materials, and tools for private purposes.",
            'first_penalty': convert_penalty_to_code('1'),
            'second_penalty': convert_penalty_to_code('2'),
            'third_penalty': convert_penalty_to_code('3'),
            'fourth_penalty': convert_penalty_to_code('5'),
            'remarks': '',
        },
        {
            'rule_id': '3.8',
            'group': 'BEHAVIOR',
            'name': 'Quarrels and Rioting',
            'description': "Quarrelling with peers or creating quarrels while being at work, or rioting.",
            'first_penalty': convert_penalty_to_code('1'),
            'second_penalty': convert_penalty_to_code('2'),
            'third_penalty': convert_penalty_to_code('3'),
            'fourth_penalty': convert_penalty_to_code('5'),
            'remarks': '',
        },
        {
            'rule_id': '3.9',
            'group': 'BEHAVIOR',
            'name': 'Malingering',
            'description': "Malingering or the unapproved and undocumented use of sick leave. (Sick leaves need to be provided from government hospitals or clinics, or a private clinic or hospital approved by the company insurance provider, contingent on the use of medical insurance).",
            'first_penalty': convert_penalty_to_code('1'),
            'second_penalty': convert_penalty_to_code('2'),
            'third_penalty': convert_penalty_to_code('3'),
            'fourth_penalty': convert_penalty_to_code('5'),
            'remarks': '',
        },
        {
            'rule_id': '3.10',
            'group': 'BEHAVIOR',
            'name': 'Refusal of Medical Exam',
            'description': "Refusal of medical examination when requested by the organization's physician.",
            'first_penalty': convert_penalty_to_code('1'),
            'second_penalty': convert_penalty_to_code('2'),
            'third_penalty': convert_penalty_to_code('3'),
            'fourth_penalty': convert_penalty_to_code('5'),
            'remarks': '',
        },
        {
            'rule_id': '3.11',
            'group': 'BEHAVIOR',
            'name': 'Failure to Deliver Collected Money',
            'description': "Non-delivery of collected money into the organization account on time without a reasonable excuse.",
            'first_penalty': convert_penalty_to_code('2'),
            'second_penalty': convert_penalty_to_code('3'),
            'third_penalty': convert_penalty_to_code('5'),
            'fourth_penalty': convert_penalty_to_code('Dismissal'),
            'remarks': '',
        },
        {
            'rule_id': '3.12',
            'group': 'BEHAVIOR',
            'name': 'Violation of In-House Instructions',
            'description': "Violation of in-house instructions on work.",
            'first_penalty': convert_penalty_to_code('2'),
            'second_penalty': convert_penalty_to_code('3'),
            'third_penalty': convert_penalty_to_code('5'),
            'fourth_penalty': convert_penalty_to_code('Dismissal'),
            'remarks': '',
        },
        {
            'rule_id': '3.13',
            'group': 'BEHAVIOR',
            'name': 'Dress Code Violation',
            'description': "Not following the dress code required by the organization.",
            'first_penalty': convert_penalty_to_code('Oral Warning'),
            'second_penalty': convert_penalty_to_code('Written Warning'),
            'third_penalty': convert_penalty_to_code('0.10'),
            'fourth_penalty': convert_penalty_to_code('0.25'),
            'remarks': '',
        },
        {
            'rule_id': '3.14',
            'group': 'BEHAVIOR',
            'name': 'Failure to Complete Training',
            'description': "Failure to complete the training and development course.",
            'first_penalty': convert_penalty_to_code('Written Warning'),
            'second_penalty': convert_penalty_to_code('0.10'),
            'third_penalty': convert_penalty_to_code('0.25'),
            'fourth_penalty': convert_penalty_to_code('0.50'),
            'remarks': '',
        },
        {
            'rule_id': '3.15',
            'group': 'BEHAVIOR',
            'name': 'Refusal to Attend Overtimes',
            'description': "Refusal to attend overtimes.",
            'first_penalty': convert_penalty_to_code('Oral Warning'),
            'second_penalty': convert_penalty_to_code('Written Warning'),
            'third_penalty': convert_penalty_to_code('0.25'),
            'fourth_penalty': convert_penalty_to_code('0.50'),
            'remarks': '',
        },
        {
            'rule_id': '3.16',
            'group': 'BEHAVIOR',
            'name': 'Unauthorized Transactions',
            'description': "Entering into purchase/sale transactions or the promotion of goods at the workplace.",
            'first_penalty': convert_penalty_to_code('Written Warning'),
            'second_penalty': convert_penalty_to_code('0.10'),
            'third_penalty': convert_penalty_to_code('0.25'),
            'fourth_penalty': convert_penalty_to_code('0.50'),
            'remarks': '',
        },
        {
            'rule_id': '3.17',
            'group': 'BEHAVIOR',
            'name': 'Leaving Info Unattended',
            'description': "Leaving essential or confidential information unattended at the office or desk.",
            'first_penalty': convert_penalty_to_code('Oral Warning'),
            'second_penalty': convert_penalty_to_code('Written Warning'),
            'third_penalty': convert_penalty_to_code('0.25'),
            'fourth_penalty': convert_penalty_to_code('0.50'),
            'remarks': '',
        },
        {
            'rule_id': '3.18',
            'group': 'BEHAVIOR',
            'name': 'Leaving Info on Shared Device',
            'description': "Leaving essential or confidential information on the printer, photocopier, or fax machine.",
            'first_penalty': convert_penalty_to_code('Oral Warning'),
            'second_penalty': convert_penalty_to_code('Written Warning'),
            'third_penalty': convert_penalty_to_code('0.25'),
            'fourth_penalty': convert_penalty_to_code('0.50'),
            'remarks': '',
        },
        {
            'rule_id': '3.19',
            'group': 'BEHAVIOR',
            'name': 'Damage to Data Backups',
            'description': "Damaging data backups without permission from the organizationâ€™s management.",
            'first_penalty': convert_penalty_to_code('Written Warning'),
            'second_penalty': convert_penalty_to_code('0.10'),
            'third_penalty': convert_penalty_to_code('0.25'),
            'fourth_penalty': convert_penalty_to_code('0.50'),
            'remarks': '',
        },
        {
            'rule_id': '3.20',
            'group': 'BEHAVIOR',
            'name': 'Failure to Report Theft',
            'description': "Failure to report any theft of a computer or related accessories.",
            'first_penalty': convert_penalty_to_code('Written Warning'),
            'second_penalty': convert_penalty_to_code('0.10'),
            'third_penalty': convert_penalty_to_code('0.25'),
            'fourth_penalty': convert_penalty_to_code('0.50'),
            'remarks': '',
        },
        {
            'rule_id': '3.21',
            'group': 'BEHAVIOR',
            'name': 'Failure to Log Off Computer',
            'description': "Failure to log out and shut the computer down while being out of the office, unless otherwise required.",
            'first_penalty': convert_penalty_to_code('Oral Warning'),
            'second_penalty': convert_penalty_to_code('Written Warning'),
            'third_penalty': convert_penalty_to_code('0.25'),
            'fourth_penalty': convert_penalty_to_code('0.50'),
            'remarks': '',
        },
        {
            'rule_id': '3.22',
            'group': 'BEHAVIOR',
            'name': 'Misuse of Email',
            'description': "Misuse of email.",
            'first_penalty': convert_penalty_to_code('Oral Warning'),
            'second_penalty': convert_penalty_to_code('Written Warning'),
            'third_penalty': convert_penalty_to_code('0.25'),
            'fourth_penalty': convert_penalty_to_code('0.50'),
            'remarks': '',
        },
        {
            'rule_id': '3.23',
            'group': 'BEHAVIOR',
            'name': 'Trespassing/Assaulting Officials',
            'description': "Trespassing on or assaulting officials in any way.",
            'first_penalty': convert_penalty_to_code('Written Warning'),
            'second_penalty': convert_penalty_to_code('0.10'),
            'third_penalty': convert_penalty_to_code('0.25'),
            'fourth_penalty': convert_penalty_to_code('0.50'),
            'remarks': '',
        },
        {
            'rule_id': '3.24',
            'group': 'BEHAVIOR',
            'name': 'Tampering with Messages',
            'description': "Hiding, destroying, opening, or causing to be hidden, destroyed, or opened by third parties any message delivered to the mail (wired and wireless messages).",
            'first_penalty': convert_penalty_to_code('Written Warning'),
            'second_penalty': convert_penalty_to_code('0.10'),
            'third_penalty': convert_penalty_to_code('0.25'),
            'fourth_penalty': convert_penalty_to_code('0.50'),
            'remarks': '',
        },
        {
            'rule_id': '3.25',
            'group': 'BEHAVIOR',
            'name': 'Negligence with Data Backups',
            'description': "Negligence to keep a backup away from the computer or in a safe place.",
            'first_penalty': convert_penalty_to_code('Oral Warning'),
            'second_penalty': convert_penalty_to_code('Written Warning'),
            'third_penalty': convert_penalty_to_code('0.10'),
            'fourth_penalty': convert_penalty_to_code('0.25'),
            'remarks': '',
        },
        {
            'rule_id': '3.26',
            'group': 'BEHAVIOR',
            'name': 'Failure to Shut Down PC',
            'description': "Failure to shut down personal computers at the end of official working hours.",
            'first_penalty': convert_penalty_to_code('Oral Warning'),
            'second_penalty': convert_penalty_to_code('Written Warning'),
            'third_penalty': convert_penalty_to_code('0.10'),
            'fourth_penalty': convert_penalty_to_code('0.25'),
            'remarks': '',
        },
    ]

    for rule_data in rules:
        OffenseRule.objects.create(**rule_data)

def remove_initial_offense_rules(apps, schema_editor):
    OffenseRule = apps.get_model('employees', 'OffenseRule')
    rule_ids_to_remove = [
        '1.1', '1.2', '1.3', '1.4', '1.5', '1.6', '1.7', '1.8', '1.9', '1.10',
        '2.1', '2.2', '2.3', '2.4', '2.5', '2.6', '2.7', '2.8', '2.9', '2.10', '2.11', '2.12', '2.13',
        '3.1', '3.2', '3.3', '3.4', '3.5', '3.6', '3.7', '3.8', '3.9', '3.10', '3.11', '3.12', '3.13', '3.14', '3.15', '3.16', '3.17', '3.18', '3.19', '3.20', '3.21', '3.22', '3.23', '3.24', '3.25', '3.26',
    ]
    OffenseRule.objects.filter(rule_id__in=rule_ids_to_remove).delete()

class Migration(migrations.Migration):
    dependencies = [
        ('employees', '0002_add_is_active_to_offense'),
    ]

    operations = [
        migrations.RunPython(add_initial_offense_rules, remove_initial_offense_rules),
    ]
```

### ðŸ“„ hrms_project\employees\migrations\0004_update_offense_groups.py
```# Generated by Django 4.2.9 on 2025-01-12 05:30

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('employees', '0003_add_initial_offense_rules'),
    ]

    operations = [
        migrations.AlterField(
            model_name='offenserule',
            name='group',
            field=models.CharField(choices=[('ATTENDANCE_TIME', 'Violations Concerning Attendance Time'), ('WORK_ORG', 'Violations Concerning Work Organization'), ('BEHAVIOR', 'Violations Concerning Employee Behavior'), ('SAFETY', 'Violations Concerning Safety'), ('PROPERTY', 'Violations Concerning Company Property'), ('OTHER', 'Other Violations')], max_length=20),
        ),
    ]

```

### ðŸ“„ hrms_project\employees\migrations\0005_remove_employeeoffence_acknowledgment_and_more.py
```# Generated by Django 4.2.9 on 2025-01-12 07:00

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('employees', '0004_update_offense_groups'),
    ]

    operations = [
        migrations.RemoveField(
            model_name='employeeoffence',
            name='acknowledgment',
        ),
        migrations.RemoveField(
            model_name='employeeoffence',
            name='warning_letter',
        ),
        migrations.AddField(
            model_name='employeeoffence',
            name='completed_date',
            field=models.DateTimeField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='employeeoffence',
            name='monetary_amount',
            field=models.DecimalField(blank=True, decimal_places=3, max_digits=10, null=True),
        ),
        migrations.AddField(
            model_name='employeeoffence',
            name='monthly_deduction',
            field=models.DecimalField(blank=True, decimal_places=3, max_digits=10, null=True),
        ),
        migrations.AddField(
            model_name='employeeoffence',
            name='refused_date',
            field=models.DateTimeField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='employeeoffence',
            name='refused_reason',
            field=models.TextField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='employeeoffence',
            name='remaining_amount',
            field=models.DecimalField(blank=True, decimal_places=3, max_digits=10, null=True),
        ),
        migrations.AddField(
            model_name='employeeoffence',
            name='sent_date',
            field=models.DateTimeField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='employeeoffence',
            name='signed_date',
            field=models.DateTimeField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='employeeoffence',
            name='applied_penalty',
            field=models.CharField(choices=[('ORAL', 'Oral Warning'), ('WRITTEN', 'Written Warning'), ('D005', '0.05 Day Deduction'), ('D010', '0.10 Day Deduction'), ('D015', '0.15 Day Deduction'), ('D025', '0.25 Day Deduction'), ('D030', '0.30 Day Deduction'), ('D050', '0.50 Day Deduction'), ('D075', '0.75 Day Deduction'), ('D100', '1 Day Deduction'), ('D200', '2 Days Deduction'), ('D300', '3 Days Deduction'), ('D500', '5 Days Deduction'), ('MONETARY', 'Monetary Penalty'), ('DISMISS', 'Dismissal')], max_length=10),
        ),
        migrations.AlterField(
            model_name='employeeoffence',
            name='original_penalty',
            field=models.CharField(choices=[('ORAL', 'Oral Warning'), ('WRITTEN', 'Written Warning'), ('D005', '0.05 Day Deduction'), ('D010', '0.10 Day Deduction'), ('D015', '0.15 Day Deduction'), ('D025', '0.25 Day Deduction'), ('D030', '0.30 Day Deduction'), ('D050', '0.50 Day Deduction'), ('D075', '0.75 Day Deduction'), ('D100', '1 Day Deduction'), ('D200', '2 Days Deduction'), ('D300', '3 Days Deduction'), ('D500', '5 Days Deduction'), ('MONETARY', 'Monetary Penalty'), ('DISMISS', 'Dismissal')], max_length=10),
        ),
        migrations.AlterField(
            model_name='offenserule',
            name='first_penalty',
            field=models.CharField(choices=[('ORAL', 'Oral Warning'), ('WRITTEN', 'Written Warning'), ('D005', '0.05 Day Deduction'), ('D010', '0.10 Day Deduction'), ('D015', '0.15 Day Deduction'), ('D025', '0.25 Day Deduction'), ('D030', '0.30 Day Deduction'), ('D050', '0.50 Day Deduction'), ('D075', '0.75 Day Deduction'), ('D100', '1 Day Deduction'), ('D200', '2 Days Deduction'), ('D300', '3 Days Deduction'), ('D500', '5 Days Deduction'), ('MONETARY', 'Monetary Penalty'), ('DISMISS', 'Dismissal')], max_length=10),
        ),
        migrations.AlterField(
            model_name='offenserule',
            name='fourth_penalty',
            field=models.CharField(choices=[('ORAL', 'Oral Warning'), ('WRITTEN', 'Written Warning'), ('D005', '0.05 Day Deduction'), ('D010', '0.10 Day Deduction'), ('D015', '0.15 Day Deduction'), ('D025', '0.25 Day Deduction'), ('D030', '0.30 Day Deduction'), ('D050', '0.50 Day Deduction'), ('D075', '0.75 Day Deduction'), ('D100', '1 Day Deduction'), ('D200', '2 Days Deduction'), ('D300', '3 Days Deduction'), ('D500', '5 Days Deduction'), ('MONETARY', 'Monetary Penalty'), ('DISMISS', 'Dismissal')], max_length=10),
        ),
        migrations.AlterField(
            model_name='offenserule',
            name='second_penalty',
            field=models.CharField(choices=[('ORAL', 'Oral Warning'), ('WRITTEN', 'Written Warning'), ('D005', '0.05 Day Deduction'), ('D010', '0.10 Day Deduction'), ('D015', '0.15 Day Deduction'), ('D025', '0.25 Day Deduction'), ('D030', '0.30 Day Deduction'), ('D050', '0.50 Day Deduction'), ('D075', '0.75 Day Deduction'), ('D100', '1 Day Deduction'), ('D200', '2 Days Deduction'), ('D300', '3 Days Deduction'), ('D500', '5 Days Deduction'), ('MONETARY', 'Monetary Penalty'), ('DISMISS', 'Dismissal')], max_length=10),
        ),
        migrations.AlterField(
            model_name='offenserule',
            name='third_penalty',
            field=models.CharField(choices=[('ORAL', 'Oral Warning'), ('WRITTEN', 'Written Warning'), ('D005', '0.05 Day Deduction'), ('D010', '0.10 Day Deduction'), ('D015', '0.15 Day Deduction'), ('D025', '0.25 Day Deduction'), ('D030', '0.30 Day Deduction'), ('D050', '0.50 Day Deduction'), ('D075', '0.75 Day Deduction'), ('D100', '1 Day Deduction'), ('D200', '2 Days Deduction'), ('D300', '3 Days Deduction'), ('D500', '5 Days Deduction'), ('MONETARY', 'Monetary Penalty'), ('DISMISS', 'Dismissal')], max_length=10),
        ),
    ]

```

### ðŸ“„ hrms_project\employees\migrations\0006_add_salary_models.py
```from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion
import django.utils.timezone


class Migration(migrations.Migration):

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('employees', '0005_remove_employeeoffence_acknowledgment_and_more'),
    ]

    operations = [
        migrations.CreateModel(
            name='SalaryDetail',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('basic_salary', models.DecimalField(decimal_places=3, max_digits=10)),
                ('housing_allowance', models.DecimalField(decimal_places=3, default=0, max_digits=10)),
                ('transportation_allowance', models.DecimalField(decimal_places=3, default=0, max_digits=10)),
                ('other_allowances', models.JSONField(default=dict, help_text='Store other allowances as key-value pairs')),
                ('total_salary', models.DecimalField(decimal_places=3, max_digits=10)),
                ('currency', models.CharField(default='BHD', max_length=3)),
                ('effective_from', models.DateField()),
                ('effective_to', models.DateField(blank=True, null=True)),
                ('is_active', models.BooleanField(default=True)),
                ('notes', models.TextField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_salary_details', to=settings.AUTH_USER_MODEL)),
                ('employee', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='salary_details', to='employees.employee')),
            ],
            options={
                'verbose_name': 'Salary Detail',
                'verbose_name_plural': 'Salary Details',
                'ordering': ['-effective_from'],
            },
        ),
        migrations.CreateModel(
            name='SalaryCertificate',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('certificate_number', models.CharField(max_length=50, unique=True)),
                ('issued_date', models.DateField()),
                ('purpose', models.CharField(max_length=200)),
                ('is_valid', models.BooleanField(default=True)),
                ('expiry_date', models.DateField(blank=True, null=True)),
                ('additional_notes', models.TextField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('employee', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='salary_certificates', to='employees.employee')),
                ('issued_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('salary_detail', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='employees.salarydetail')),
            ],
            options={
                'verbose_name': 'Salary Certificate',
                'verbose_name_plural': 'Salary Certificates',
                'ordering': ['-issued_date'],
            },
        ),
        migrations.CreateModel(
            name='SalaryRevision',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('revision_type', models.CharField(choices=[('INC', 'Increment'), ('PRO', 'Promotion'), ('ADJ', 'Adjustment'), ('DEM', 'Demotion'), ('PEN', 'Penalty'), ('OTH', 'Other')], max_length=3)),
                ('revision_date', models.DateField()),
                ('reason', models.TextField()),
                ('reference_number', models.CharField(blank=True, max_length=50, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('approved_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('employee', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='salary_revisions', to='employees.employee')),
                ('new_salary', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='revisions_to', to='employees.salarydetail')),
                ('previous_salary', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='revisions_from', to='employees.salarydetail')),
            ],
            options={
                'verbose_name': 'Salary Revision',
                'verbose_name_plural': 'Salary Revisions',
                'ordering': ['-revision_date'],
            },
        ),
    ]
```

### ðŸ“„ hrms_project\employees\migrations\0008_enable_trigram.py
```from django.contrib.postgres.operations import TrigramExtension
from django.db import migrations

class Migration(migrations.Migration):
    dependencies = [
        ('employees', '0006_add_salary_models'),
    ]

    operations = [
        TrigramExtension(),
    ]

```

### ðŸ“„ hrms_project\employees\migrations\0009_alter_employeeoffence_details_and_more.py
```# Generated by Django 4.2.9 on 2025-01-25 12:48

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('employees', '0008_enable_trigram'),
    ]

    operations = [
        migrations.AlterField(
            model_name='employeeoffence',
            name='details',
            field=models.TextField(blank=True),
        ),
        migrations.AlterField(
            model_name='employeeoffence',
            name='original_penalty',
            field=models.CharField(blank=True, choices=[('ORAL', 'Oral Warning'), ('WRITTEN', 'Written Warning'), ('D005', '0.05 Day Deduction'), ('D010', '0.10 Day Deduction'), ('D015', '0.15 Day Deduction'), ('D025', '0.25 Day Deduction'), ('D030', '0.30 Day Deduction'), ('D050', '0.50 Day Deduction'), ('D075', '0.75 Day Deduction'), ('D100', '1 Day Deduction'), ('D200', '2 Days Deduction'), ('D300', '3 Days Deduction'), ('D500', '5 Days Deduction'), ('MONETARY', 'Monetary Penalty'), ('DISMISS', 'Dismissal')], max_length=10, null=True),
        ),
    ]

```

### ðŸ“„ hrms_project\employees\migrations\0010_employee_user.py
```# Generated by Django 4.2.9 on 2025-02-04 08:28

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('employees', '0009_alter_employeeoffence_details_and_more'),
    ]

    operations = [
        migrations.AddField(
            model_name='employee',
            name='user',
            field=models.OneToOneField(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='employee', to=settings.AUTH_USER_MODEL),
        ),
    ]

```

### ðŸ“„ hrms_project\employees\migrations\__init__.py
```
```

### ðŸ“„ hrms_project\employees\models.py
```from django.db import models
from django.conf import settings
from django.core.validators import MinValueValidator
from django.core.exceptions import ValidationError
from django.utils import timezone
from django.core.files.uploadedfile import UploadedFile
from django.core.validators import FileExtensionValidator
import os

class Department(models.Model):
    name = models.CharField(max_length=100)
    name_ar = models.CharField(max_length=100, verbose_name="Name (Arabic)", blank=True, null=True)
    code = models.CharField(max_length=20, default='DEPT', unique=True)
    parent = models.ForeignKey('self', on_delete=models.SET_NULL, null=True, blank=True)
    manager = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.SET_NULL, null=True, blank=True)
    
    def __str__(self):
        return self.name

class Division(models.Model):
    name = models.CharField(max_length=100)
    name_ar = models.CharField(max_length=100, verbose_name="Name (Arabic)")
    code = models.CharField(max_length=20, unique=True)
    department = models.ForeignKey(Department, on_delete=models.CASCADE)

    def __str__(self):
        return self.name

class Location(models.Model):
    name = models.CharField(max_length=100)
    address = models.TextField()
    code = models.CharField(max_length=20, unique=True)

    def __str__(self):
        return self.name

class Bank(models.Model):
    name = models.CharField(max_length=100)
    swift_code = models.CharField(max_length=20)

    def __str__(self):
        return self.name

class CostProfitCenter(models.Model):
    name = models.CharField(max_length=100)
    code = models.CharField(max_length=20, unique=True)
    description = models.TextField(blank=True, null=True)
    is_active = models.BooleanField(default=True)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    def __str__(self):
        return f"{self.code} - {self.name}"

    class Meta:
        verbose_name = 'Cost/Profit Center'
        verbose_name_plural = 'Cost/Profit Centers'
        ordering = ['code']

class Employee(models.Model):
    # Choice Fields
    GENDER_CHOICES = [
        ('M', 'Male'),
        ('F', 'Female'),
    ]
    MARITAL_STATUS_CHOICES = [
        ('S', 'Single'),
        ('M', 'Married'),
        ('D', 'Divorced'),
        ('W', 'Widowed'),
    ]
    CONTRACT_TYPE_CHOICES = [
        ('FT', 'Full Time'),
        ('PT', 'Part Time'),
        ('CT', 'Contract'),
        ('INT', 'Intern'),
    ]
    EMPLOYEE_CATEGORY_CHOICES = [
        ('GEN', 'General'),
        ('SUP', 'Supervisor'),
        ('MGR', 'Manager'),
        ('EXE', 'Executive'),
    ]
    NATIONALITY_CHOICES = [
        ('ALGERIAN', 'Algerian'),
        ('AMERICAN', 'American'),
        ('ARGENTINA', 'Argentina'),
        ('AUSTRALIAN', 'Australian'),
        ('BAHRAINI', 'Bahraini'),
        ('BANGLADESHI', 'Bangladeshi'),
        ('BELGIAN', 'Belgian'),
        ('BRAZILIAN', 'Brazilian'),
        ('BRITISH', 'British'),
        ('BULGARIAN', 'Bulgarian'),
        ('CAMEROONIAN', 'Cameroonian'),
        ('CANADIAN', 'Canadian'),
        ('CHILEAN', 'Chilean'),
        ('CHINESE', 'Chinese'),
        ('COLOMBIAN', 'Colombian'),
        ('CROATIAN', 'Croatian'),
        ('CUBAN', 'Cuban'),
        ('CYPRIOT', 'Cypriot'),
        ('CZECH', 'Czech'),
        ('DANISH', 'Danish'),
        ('DJIBOUTIAN', 'Djiboutian'),
        ('EGYPTIAN', 'Egyptian'),
        ('FILIPINO', 'Filipino'),
        ('FRENCH', 'French'),
        ('GERMAN', 'German'),
        ('GHANAIAN', 'Ghanaian'),
        ('GREEK', 'Greek'),
        ('DUTCH', 'Dutch'),
        ('HONG_KONGER', 'Hong Konger'),
        ('INDIAN', 'Indian'),
        ('INDONESIAN', 'Indonesian'),
        ('IRANIAN', 'Iranian'),
        ('IRAQI', 'Iraqi'),
        ('IRISH', 'Irish'),
        ('ITALIAN', 'Italian'),
        ('JAMAICAN', 'Jamaican'),
        ('JAPANESE', 'Japanese'),
        ('JORDANIAN', 'Jordanian'),
        ('KENYAN', 'Kenyan'),
        ('KUWAITI', 'Kuwaiti'),
        ('LEBANESE', 'Lebanese'),
        ('MALAWIAN', 'Malawian'),
        ('MALAYSIAN', 'Malaysian'),
        ('MEXICAN', 'Mexican'),
        ('MOROCCAN', 'Moroccan'),
        ('NEPALI', 'Nepali'),
        ('DUTCH', 'Dutch'),
        ('NEW_ZEALANDER', 'New Zealander'),
        ('NIGERIAN', 'Nigerian'),
        ('NORWEGIAN', 'Norwegian'),
        ('OMANI', 'Omani'),
        ('PAKISTANI', 'Pakistani'),
        ('POLISH', 'Polish'),
        ('PORTUGUESE', 'Portuguese'),
        ('RUSSIAN', 'Russian'),
        ('SAUDI', 'Saudi'),
        ('SCOTTISH', 'Scottish'),
        ('SERBIAN', 'Serbian'),
        ('SEYCHELLOIS', 'Seychellois'),
        ('SINGAPOREAN', 'Singaporean'),
        ('SOUTH_AFRICAN', 'South African'),
        ('SPANISH', 'Spanish'),
        ('SRI_LANKAN', 'Sri Lankan'),
        ('SUDANESE', 'Sudanese'),
        ('SWEDISH', 'Swedish'),
        ('SWISS', 'Swiss'),
        ('SYRIAN', 'Syrian'),
        ('TAIWANESE', 'Taiwanese'),
        ('TANZANIAN', 'Tanzanian'),
        ('THAI', 'Thai'),
        ('TUNISIAN', 'Tunisian'),
        ('TURKISH', 'Turkish'),
        ('EMIRATI', 'Emirati'),
        ('UGANDAN', 'Ugandan'),
        ('UKRAINIAN', 'Ukrainian'),
        ('VENEZUELAN', 'Venezuelan'),
        ('VIETNAMESE', 'Vietnamese'),
        ('YEMENI', 'Yemeni'),
        ('ZIMBABWEAN', 'Zimbabwean'),
        ('OTHER', 'Other'),
    ]

    # General Information
    user = models.OneToOneField(
        settings.AUTH_USER_MODEL,
        on_delete=models.CASCADE,
        related_name='employee',
        null=True,
        blank=True
    )
    employee_number = models.CharField(max_length=20, unique=True, default='EMP0001')
    profile_picture = models.ImageField(upload_to='employee_pictures/', blank=True, null=True)
    first_name = models.CharField(max_length=50, default='First')
    middle_name = models.CharField(max_length=50, blank=True, null=True)
    last_name = models.CharField(max_length=50, default='Last')
    first_name_ar = models.CharField(max_length=50, verbose_name="First Name (Arabic)", blank=True, null=True)
    middle_name_ar = models.CharField(max_length=50, verbose_name="Middle Name (Arabic)", blank=True, null=True)
    last_name_ar = models.CharField(max_length=50, verbose_name="Last Name (Arabic)", blank=True, null=True)
    date_of_birth = models.DateField(blank=True, null=True)
    gender = models.CharField(max_length=1, choices=GENDER_CHOICES, blank=True, null=True)
    marital_status = models.CharField(max_length=20, choices=MARITAL_STATUS_CHOICES, blank=True, null=True)
    nationality = models.CharField(
        max_length=50,
        choices=NATIONALITY_CHOICES,
        blank=True,
        null=True,
        verbose_name='Nationality'
    )
    religion = models.CharField(max_length=50, blank=True, null=True)
    education_category = models.CharField(max_length=50, blank=True, null=True)
    cpr_number = models.CharField(max_length=20, unique=True, blank=True, null=True)
    email = models.EmailField(max_length=254, blank=True, null=True)
    primary_phone = models.CharField(max_length=20, blank=True, null=True, verbose_name='Primary Number')
    secondary_phone = models.CharField(max_length=20, blank=True, null=True, verbose_name='Secondary Number')
    address = models.TextField(blank=True, null=True)
    in_probation = models.BooleanField(default=True)

    # Employment Information
    designation = models.CharField(max_length=100, blank=True, null=True)
    division = models.ForeignKey(Division, on_delete=models.SET_NULL, null=True, blank=True)
    department = models.ForeignKey(Department, on_delete=models.SET_NULL, null=True, blank=True)
    location = models.ForeignKey(Location, on_delete=models.SET_NULL, null=True, blank=True)
    contract_type = models.CharField(max_length=20, choices=CONTRACT_TYPE_CHOICES, blank=True, null=True)
    joined_date = models.DateField(blank=True, null=True)
    cost_center = models.ForeignKey(CostProfitCenter, on_delete=models.SET_NULL, null=True, blank=True, related_name='cost_center_employees')
    profit_center = models.ForeignKey(CostProfitCenter, on_delete=models.SET_NULL, null=True, blank=True, related_name='profit_center_employees')
    employee_category = models.CharField(max_length=20, choices=EMPLOYEE_CATEGORY_CHOICES, blank=True, null=True)

    # System Fields
    is_active = models.BooleanField(default=True)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    class Meta:
        verbose_name = 'Employee'
        verbose_name_plural = 'Employees'
        ordering = ['employee_number']

    def __str__(self):
        return f"{self.first_name} {self.last_name} ({self.employee_number})"

    def get_full_name(self):
        middle = f" {self.middle_name}" if self.middle_name else ""
        return f"{self.first_name}{middle} {self.last_name}"

    def get_full_name_ar(self):
        middle = f" {self.middle_name_ar}" if self.middle_name_ar else ""
        return f"{self.first_name_ar}{middle} {self.last_name_ar}"

class EmployeeBankAccount(models.Model):
    employee = models.ForeignKey('Employee', on_delete=models.CASCADE, related_name='bank_accounts')
    bank = models.CharField(max_length=100)
    account_number = models.CharField(max_length=50)
    iban = models.CharField(max_length=50, verbose_name="IBAN No")
    transfer_amount = models.DecimalField(
        max_digits=10, 
        decimal_places=2, 
        verbose_name="Amount to be Transferred",
        null=True,
        blank=True
    )
    is_primary = models.BooleanField(default=False)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    class Meta:
        ordering = ['-is_primary', '-created_at']
        verbose_name = "Employee Bank Account"
        verbose_name_plural = "Employee Bank Accounts"

    def __str__(self):
        return f"{self.employee.get_full_name()} - {self.bank} ({self.account_number})"

    def save(self, *args, **kwargs):
        # If this account is being set as primary, unset primary for other accounts
        if self.is_primary:
            EmployeeBankAccount.objects.filter(
                employee=self.employee, 
                is_primary=True
            ).exclude(pk=self.pk).update(is_primary=False)
        super().save(*args, **kwargs)

class EmployeeDependent(models.Model):
    RELATIONSHIP_CHOICES = [
        ('spouse', 'Spouse'),
        ('child', 'Child'),
        ('parent', 'Parent'),
        ('sibling', 'Sibling'),
        ('other', 'Other'),
    ]
    
    employee = models.ForeignKey(Employee, on_delete=models.CASCADE, related_name='dependents')
    name = models.CharField(max_length=100)
    relation = models.CharField(max_length=20, choices=RELATIONSHIP_CHOICES)
    date_of_birth = models.DateField()
    passport_number = models.CharField(max_length=50, blank=True, null=True)
    passport_expiry = models.DateField(blank=True, null=True)
    cpr_number = models.CharField(max_length=20, blank=True, null=True)
    cpr_expiry = models.DateField(blank=True, null=True)
    valid_passage = models.BooleanField(default=False)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    class Meta:
        verbose_name = "Employee Dependent"
        verbose_name_plural = "Employee Dependents"
        ordering = ['name']

    def __str__(self):
        return f"{self.name} ({self.get_relation_display()})"

class DependentDocument(models.Model):
    DOCUMENT_TYPES = [
        ('PASSPORT', 'Passport'),
        ('CPR', 'CPR'),
        ('BIRTH_CERTIFICATE', 'Birth Certificate'),
        ('MARRIAGE_CERTIFICATE', 'Marriage Certificate'),
        ('OTHER', 'Other'),
    ]

    dependent = models.ForeignKey(EmployeeDependent, on_delete=models.CASCADE, related_name='documents')
    document_type = models.CharField(max_length=50, choices=DOCUMENT_TYPES)
    document_number = models.CharField(max_length=50, blank=True, null=True)
    name = models.CharField(max_length=255)
    issue_date = models.DateField(blank=True, null=True)
    expiry_date = models.DateField(blank=True, null=True)
    nationality = models.CharField(max_length=50, choices=Employee.NATIONALITY_CHOICES, blank=True, null=True)
    document_file = models.FileField(upload_to='dependent_documents/', blank=True, null=True)
    status = models.CharField(max_length=20, default='active')
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    def __str__(self):
        return f"{self.dependent.name} - {self.get_document_type_display()}"

class EmergencyContact(models.Model):
    employee = models.ForeignKey(Employee, on_delete=models.CASCADE, related_name='emergency_contacts')
    name = models.CharField(max_length=100)
    relationship = models.CharField(max_length=50)
    phone_number = models.CharField(max_length=20)
    alternative_phone = models.CharField(max_length=20, blank=True)
    address = models.TextField(blank=True)

    def __str__(self):
        return f"{self.name} ({self.relationship})"

class EmployeeDocument(models.Model):
    DOCUMENT_TYPES = [
        ('PASSPORT', 'Passport'),
        ('RESIDENT', 'Resident Permit'),
        ('CPR', 'C.P.R'),
        ('GATE', 'Gate Pass'),
        ('CONTRACT', 'Contract'),
        ('CV', 'CV'),
        ('DRIVING', 'Driving License'),
    ]
    
    employee = models.ForeignKey(Employee, on_delete=models.CASCADE, related_name='documents')
    document_type = models.CharField(max_length=10, choices=DOCUMENT_TYPES)
    document_number = models.CharField(max_length=50)
    profession_title = models.CharField(max_length=100, blank=True, null=True, verbose_name="Profession / Title")
    issue_date = models.DateField(null=True, blank=True)
    issue_place = models.CharField(max_length=100, null=True, blank=True)
    expiry_date = models.DateField(null=True, blank=True)
    other_info = models.TextField(blank=True, null=True)
    document_file = models.FileField(
        upload_to='employee_documents/%Y/%m/',
        validators=[
            FileExtensionValidator(
                allowed_extensions=['pdf', 'jpg', 'jpeg', 'png', 'doc', 'docx']
            )
        ],
        null=True,
        blank=True
    )
    created_at = models.DateTimeField(default=timezone.now)
    updated_at = models.DateTimeField(auto_now=True)

    class Meta:
        ordering = ['-created_at']
        verbose_name = "Employee Document"
        verbose_name_plural = "Employee Documents"

    def __str__(self):
        return f"{self.employee.get_full_name()} - {self.get_document_type_display()}"

    def clean(self):
        if self.expiry_date and self.issue_date:
            if self.expiry_date < self.issue_date:
                raise ValidationError({
                    'expiry_date': 'Expiry date cannot be earlier than issue date.'
                })

    def save(self, *args, **kwargs):
        if not self.pk:  # Only set created_at for new instances
            self.created_at = timezone.now()
            
        if self.document_file:
            # Get file extension
            _, ext = os.path.splitext(self.document_file.name)
            
            # Create new filename
            new_filename = f"{self.employee.employee_number}_{self.employee.get_full_name().replace(' ', '_')}_{self.get_document_type_display()}_{self.document_number}{ext}"
            
            # Set the new filename
            self.document_file.name = os.path.join(
                'employee_documents',
                timezone.now().strftime('%Y'),
                timezone.now().strftime('%m'),
                new_filename
            )
            
        self.full_clean()
        super().save(*args, **kwargs)

    @property
    def is_expired(self):
        return self.expiry_date < timezone.now().date() if self.expiry_date else False

    @property
    def file_extension(self):
        name, extension = os.path.splitext(self.document_file.name)
        return extension.lower()

    @property
    def is_image(self):
        return self.file_extension in ['.jpg', '.jpeg', '.png']

class AssetType(models.Model):
    name = models.CharField(max_length=100, unique=True)
    description = models.TextField(blank=True, null=True)
    created_at = models.DateTimeField(default=timezone.now)

    def __str__(self):
        return self.name

    class Meta:
        ordering = ['name']
        verbose_name = "Asset Type"
        verbose_name_plural = "Asset Types"

class EmployeeAsset(models.Model):
    employee = models.ForeignKey(Employee, on_delete=models.CASCADE, related_name='assets')
    asset_type = models.ForeignKey(AssetType, on_delete=models.PROTECT, related_name='assets', null=True)
    asset_name = models.CharField(max_length=100)
    asset_number = models.CharField(max_length=50, blank=True, null=True)
    issue_date = models.DateField(default=timezone.now)
    return_date = models.DateField(null=True, blank=True)
    condition = models.TextField(default='New')
    return_condition = models.TextField(null=True, blank=True)
    value = models.DecimalField(max_digits=10, decimal_places=2, default=0.00)
    notes = models.TextField(blank=True, null=True)
    return_notes = models.TextField(blank=True, null=True)
    created_at = models.DateTimeField(default=timezone.now)
    updated_at = models.DateTimeField(auto_now=True)

    def __str__(self):
        if self.asset_number:
            return f"{self.asset_name} - {self.asset_number}"
        return self.asset_name

    class Meta:
        ordering = ['-created_at']
        verbose_name = "Employee Asset"
        verbose_name_plural = "Employee Assets"

class EmployeeEducation(models.Model):
    employee = models.ForeignKey(Employee, on_delete=models.CASCADE, related_name='education')
    institution = models.CharField(max_length=100, default='Unknown Institution')
    major = models.CharField(max_length=100, default='General')
    degree = models.CharField(max_length=50, default='Unknown Degree')
    graduation_year = models.IntegerField(default=2000)
    gpa = models.DecimalField(max_digits=3, decimal_places=2, blank=True, null=True)
    description = models.TextField(blank=True)

    def __str__(self):
        return f"{self.degree} from {self.institution}"

class OffenseRule(models.Model):
    PENALTY_CHOICES = [
        ('ORAL', 'Oral Warning'),
        ('WRITTEN', 'Written Warning'),
        ('D005', '0.05 Day Deduction'),
        ('D010', '0.10 Day Deduction'),
        ('D015', '0.15 Day Deduction'),
        ('D025', '0.25 Day Deduction'),
        ('D030', '0.30 Day Deduction'),
        ('D050', '0.50 Day Deduction'),
        ('D075', '0.75 Day Deduction'),
        ('D100', '1 Day Deduction'),
        ('D200', '2 Days Deduction'),
        ('D300', '3 Days Deduction'),
        ('D500', '5 Days Deduction'),
        ('MONETARY', 'Monetary Penalty'),
        ('DISMISS', 'Dismissal'),
    ]
    GROUP_CHOICES = [
        ('ATTENDANCE_TIME', 'Violations Concerning Attendance Time'),
        ('WORK_ORG', 'Violations Concerning Work Organization'),
        ('BEHAVIOR', 'Violations Concerning Employee Behavior'),
        ('SAFETY', 'Violations Concerning Safety'),
        ('PROPERTY', 'Violations Concerning Company Property'),
        ('OTHER', 'Other Violations'),
    ]

    rule_id = models.CharField(max_length=20, unique=True)
    group = models.CharField(max_length=20, choices=GROUP_CHOICES)
    name = models.CharField(max_length=200)
    description = models.TextField()
    first_penalty = models.CharField(max_length=10, choices=PENALTY_CHOICES)
    second_penalty = models.CharField(max_length=10, choices=PENALTY_CHOICES)
    third_penalty = models.CharField(max_length=10, choices=PENALTY_CHOICES)
    fourth_penalty = models.CharField(max_length=10, choices=PENALTY_CHOICES)
    remarks = models.TextField(blank=True, null=True)
    is_active = models.BooleanField(default=True)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    class Meta:
        ordering = ['group', 'rule_id']
        verbose_name = 'Offense Rule'
        verbose_name_plural = 'Offense Rules'

    def __str__(self):
        return f"{self.rule_id} - {self.name}"

    def get_penalty_for_count(self, count):
        if count == 1:
            return self.first_penalty
        elif count == 2:
            return self.second_penalty
        elif count == 3:
            return self.third_penalty
        elif count >= 4:
            return self.fourth_penalty
        return None

    def get_penalty_display(self, penalty_code):
        return dict(self.PENALTY_CHOICES).get(penalty_code, penalty_code)


class EmployeeOffence(models.Model):
    employee = models.ForeignKey('Employee', on_delete=models.CASCADE, related_name='employee_offence_records')
    rule = models.ForeignKey(OffenseRule, on_delete=models.PROTECT)
    offense_date = models.DateField()
    applied_penalty = models.CharField(max_length=10, choices=OffenseRule.PENALTY_CHOICES)
    original_penalty = models.CharField(max_length=10, choices=OffenseRule.PENALTY_CHOICES, null=True, blank=True)
    offense_count = models.PositiveIntegerField(default=1)
    details = models.TextField(blank=True)
    
    # Monetary penalty fields
    monetary_amount = models.DecimalField(max_digits=10, decimal_places=3, null=True, blank=True)
    remaining_amount = models.DecimalField(max_digits=10, decimal_places=3, null=True, blank=True)
    monthly_deduction = models.DecimalField(max_digits=10, decimal_places=3, null=True, blank=True)
    
    # Status tracking
    is_acknowledged = models.BooleanField(default=False)
    acknowledged_at = models.DateTimeField(null=True, blank=True)
    signed_date = models.DateTimeField(null=True, blank=True)
    refused_date = models.DateTimeField(null=True, blank=True)
    refused_reason = models.TextField(blank=True, null=True)
    sent_date = models.DateTimeField(null=True, blank=True)
    completed_date = models.DateTimeField(null=True, blank=True)
    is_active = models.BooleanField(default=True)
    
    # Audit fields
    created_by = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.SET_NULL, null=True, related_name='created_offence_records')
    modified_by = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.SET_NULL, null=True, related_name='modified_offence_records')
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    class Meta:
        ordering = ['-offense_date', '-created_at']
        verbose_name = 'Employee Offense'
        verbose_name_plural = 'Employee Offenses'

    def __str__(self):
        return f"{self.employee} - {self.rule.name} ({self.offense_date})"

    def save(self, *args, **kwargs):
        # If this is a new offense, set the offense count
        if not self.pk:
            self.offense_count = self.get_offense_count()
            
            # If this is a monetary penalty, set the remaining amount
            if self.applied_penalty == 'MONETARY' and self.monetary_amount:
                self.remaining_amount = self.monetary_amount

        super().save(*args, **kwargs)

    def get_offense_count(self):
        """Get the count of active offenses for this rule and employee"""
        return EmployeeOffence.objects.filter(
            employee=self.employee,
            rule=self.rule,
            offense_date__year=self.offense_date.year,
            is_active=True
        ).count() + 1

    def get_original_penalty_display(self):
        return dict(OffenseRule.PENALTY_CHOICES).get(self.original_penalty, '')

    def get_applied_penalty_display(self):
        penalty = dict(OffenseRule.PENALTY_CHOICES).get(self.applied_penalty, '')
        if self.applied_penalty == 'MONETARY' and self.monetary_amount:
            penalty += f" ({self.monetary_amount} BHD)"
        return penalty

    @classmethod
    def deactivate_previous_year_offenses(cls):
        """Deactivate all offenses from previous years"""
        current_year = timezone.now().year
        cls.objects.filter(
            offense_date__year__lt=current_year,
            is_active=True
        ).update(is_active=False)

class OffenseDocument(models.Model):
    offense = models.ForeignKey(EmployeeOffence, on_delete=models.CASCADE, related_name='documents')
    document = models.FileField(upload_to='offense_documents/')
    document_type = models.CharField(max_length=50)
    notes = models.TextField(blank=True, null=True)
    uploaded_at = models.DateTimeField(auto_now_add=True)

    class Meta:
        ordering = ['-uploaded_at']

    def __str__(self):
        return f"{self.offense} - {self.document_type}"

class LifeEvent(models.Model):
    EVENT_TYPES = [
        ('MAR', 'Marriage'),
        ('CHD', 'Child Birth'),
        ('DEA', 'Death in Family'),
        ('OTH', 'Other'),
    ]

    employee = models.ForeignKey(Employee, on_delete=models.CASCADE, related_name='life_events')
    event_type = models.CharField(max_length=3, choices=EVENT_TYPES)
    date = models.DateField()
    description = models.TextField()
    documents = models.FileField(upload_to='life_event_documents/', blank=True)

    def __str__(self):
        return f"{self.get_event_type_display()} on {self.date}"

class SalaryDetail(models.Model):
    employee = models.ForeignKey(Employee, on_delete=models.CASCADE, related_name='salary_details')
    basic_salary = models.DecimalField(max_digits=10, decimal_places=3)
    housing_allowance = models.DecimalField(max_digits=10, decimal_places=3, default=0)
    transportation_allowance = models.DecimalField(max_digits=10, decimal_places=3, default=0)
    other_allowances = models.JSONField(default=dict, help_text="Store other allowances as key-value pairs")
    total_salary = models.DecimalField(max_digits=10, decimal_places=3)
    currency = models.CharField(max_length=3, default='BHD')
    effective_from = models.DateField()
    effective_to = models.DateField(null=True, blank=True)
    is_active = models.BooleanField(default=True)
    notes = models.TextField(blank=True, null=True)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    created_by = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.SET_NULL, null=True, related_name='created_salary_details')

    class Meta:
        ordering = ['-effective_from']
        verbose_name = "Salary Detail"
        verbose_name_plural = "Salary Details"

    def __str__(self):
        return f"{self.employee.get_full_name()} - {self.effective_from}"

    def save(self, *args, **kwargs):
        # Calculate total salary
        self.total_salary = (
            self.basic_salary +
            self.housing_allowance +
            self.transportation_allowance +
            sum(float(amount) for amount in self.other_allowances.values())
        )
        
        # If this is a new active salary detail, deactivate other active ones
        if self.is_active and not self.pk:
            SalaryDetail.objects.filter(
                employee=self.employee,
                is_active=True
            ).update(
                is_active=False,
                effective_to=self.effective_from
            )
            
        super().save(*args, **kwargs)

class SalaryRevision(models.Model):
    REVISION_TYPES = [
        ('INC', 'Increment'),
        ('PRO', 'Promotion'),
        ('ADJ', 'Adjustment'),
        ('DEM', 'Demotion'),
        ('PEN', 'Penalty'),
        ('OTH', 'Other'),
    ]

    employee = models.ForeignKey(Employee, on_delete=models.CASCADE, related_name='salary_revisions')
    revision_type = models.CharField(max_length=3, choices=REVISION_TYPES)
    previous_salary = models.ForeignKey(SalaryDetail, on_delete=models.PROTECT, related_name='revisions_from')
    new_salary = models.ForeignKey(SalaryDetail, on_delete=models.PROTECT, related_name='revisions_to')
    revision_date = models.DateField()
    reason = models.TextField()
    reference_number = models.CharField(max_length=50, blank=True, null=True)
    approved_by = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.SET_NULL, null=True)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    class Meta:
        ordering = ['-revision_date']
        verbose_name = "Salary Revision"
        verbose_name_plural = "Salary Revisions"

    def __str__(self):
        return f"{self.employee.get_full_name()} - {self.get_revision_type_display()} on {self.revision_date}"

    @property
    def difference(self):
        return self.new_salary.total_salary - self.previous_salary.total_salary

    @property
    def percentage_change(self):
        return (self.difference / self.previous_salary.total_salary) * 100

class SalaryCertificate(models.Model):
    employee = models.ForeignKey(Employee, on_delete=models.CASCADE, related_name='salary_certificates')
    certificate_number = models.CharField(max_length=50, unique=True)
    issued_date = models.DateField()
    purpose = models.CharField(max_length=200)
    salary_detail = models.ForeignKey(SalaryDetail, on_delete=models.PROTECT)
    issued_by = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.SET_NULL, null=True)
    is_valid = models.BooleanField(default=True)
    expiry_date = models.DateField(null=True, blank=True)
    additional_notes = models.TextField(blank=True, null=True)
    created_at = models.DateTimeField(auto_now_add=True)

    class Meta:
        ordering = ['-issued_date']
        verbose_name = "Salary Certificate"
        verbose_name_plural = "Salary Certificates"

    def __str__(self):
        return f"{self.employee.get_full_name()} - {self.certificate_number}"

```

### ðŸ“„ hrms_project\employees\serializers.py
```from rest_framework import serializers
from .models import EmployeeAsset, AssetType, EmployeeOffence, OffenseDocument, OffenseRule
from django.utils import timezone

class AssetTypeSerializer(serializers.ModelSerializer):
    class Meta:
        model = AssetType
        fields = '__all__'

class EmployeeAssetSerializer(serializers.ModelSerializer):
    asset_type_display = serializers.CharField(read_only=True)
    
    class Meta:
        model = EmployeeAsset
        fields = '__all__'
        read_only_fields = ['id', 'created_at', 'updated_at']

    def to_representation(self, instance):
        representation = super().to_representation(instance)
        representation['asset_type_display'] = instance.get_asset_type_display()
        return representation

class BulkEmployeeAssetSerializer(serializers.Serializer):
    employee_ids = serializers.ListField(
        child=serializers.IntegerField(),
        required=True
    )
    asset_type = serializers.PrimaryKeyRelatedField(
        queryset=AssetType.objects.all(),
        required=True
    )
    asset_number = serializers.CharField(required=True)
    description = serializers.CharField(required=False, allow_blank=True)
    issue_date = serializers.DateField(required=True)
    return_date = serializers.DateField(required=False, allow_null=True)
    
    def create(self, validated_data):
        employee_ids = validated_data.pop('employee_ids')
        assets = []
        
        for employee_id in employee_ids:
            asset = EmployeeAsset.objects.create(
                employee_id=employee_id,
                **validated_data
            )
            assets.append(asset)
        
        return assets

class OffenseDocumentSerializer(serializers.ModelSerializer):
    class Meta:
        model = OffenseDocument
        fields = '__all__'

class OffenseRuleSerializer(serializers.ModelSerializer):
    class Meta:
        model = OffenseRule
        fields = '__all__'

class EmployeeOffenceSerializer(serializers.ModelSerializer):
    class Meta:
        model = EmployeeOffence
        fields = '__all__'
        read_only_fields = ('created_by', 'modified_by', 'created_at', 'updated_at')

    def create(self, validated_data):
        # Set original_penalty to match applied_penalty if not provided
        if 'original_penalty' not in validated_data:
            validated_data['original_penalty'] = validated_data.get('applied_penalty')
        
        # Set details to empty string if not provided
        if 'details' not in validated_data:
            validated_data['details'] = ''
            
        return super().create(validated_data)

```

### ðŸ“„ hrms_project\employees\static\employees\js\assets.js
```document.addEventListener('DOMContentLoaded', function() {
    const employeeId = 1; // Make sure this is defined globally
    const API_BASE = '/employees/api'; // Base API path

    // Initialize modals
    const viewAssetModal = new bootstrap.Modal('#viewAssetModal');
    const assetsModal = new bootstrap.Modal(document.getElementById('addAssetsModal'));
    const assetTypeModal = new bootstrap.Modal(document.getElementById('addAssetTypeModal'));
    const manageTypesModal = new bootstrap.Modal(document.getElementById('manageAssetTypesModal'));
    const returnAssetModal = new bootstrap.Modal(document.getElementById('returnAssetModal'));

    // Function to properly clean up modal
    function cleanupModal() {
        const backdrop = document.querySelector('.modal-backdrop');
        if (backdrop) {
            backdrop.remove();
        }
        document.body.classList.remove('modal-open');
        document.body.style.overflow = '';
        document.body.style.paddingRight = '';
    }

    // Handle saving asset type
    document.getElementById('saveAssetTypeBtn').addEventListener('click', async function() {
        const formData = new FormData(document.getElementById('addAssetTypeForm'));
        const data = Object.fromEntries(formData.entries());

        try {
            const response = await fetch(`${API_BASE}/asset-types/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify(data)
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || 'Failed to add asset type');
            }

            const newType = await response.json();
            
            // Add new option to asset type select
            const select = document.querySelector('#addAssetsForm select[name="asset_type"]');
            const option = new Option(newType.name, newType.id);
            select.add(option);
            option.selected = true; // Select the new option

            // Add new row to asset types table if it exists
            const typeTable = document.querySelector('#assetTypesTable tbody');
            if (typeTable) {
                const newRow = typeTable.insertRow();
                newRow.dataset.typeId = newType.id;
                newRow.innerHTML = `
                    <td>${newType.name}</td>
                    <td>${newType.description || '-'}</td>
                    <td>
                        <button type="button" class="btn btn-sm btn-danger delete-type" data-type-id="${newType.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
            }

            // Reset and close the asset type modal
            document.getElementById('addAssetTypeForm').reset();
            assetTypeModal.hide();
            cleanupModal();

        } catch (error) {
            console.error('Error adding asset type:', error);
            alert(error.message || 'Failed to add asset type. Please try again.');
        }
    });

    // Handle assets form submission
    document.getElementById('saveAssetsBtn').addEventListener('click', async function() {
        const form = document.getElementById('addAssetsForm');
        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());
        const selectedTypes = Array.from(form.querySelector('select[name="asset_type"]').selectedOptions);

        if (selectedTypes.length === 0) {
            alert('Please select at least one asset type');
            return;
        }

        try {
            let currentNumber = data.asset_number;

            for (const option of selectedTypes) {
                const type = {
                    id: option.value,
                    name: option.text
                };
                const quantity = parseInt(data[`quantity_${type.id}`]) || 1;

                for (let i = 0; i < quantity; i++) {
                    const assetData = {
                        asset_name: `${type.name} ${currentNumber}`,
                        asset_type_id: type.id,
                        asset_number: currentNumber,
                        issue_date: data.issue_date || new Date().toISOString().split('T')[0],
                        condition: data.condition || 'New',
                        value: data.value || '0',
                        notes: data.notes || ''
                    };

                    console.log('Sending asset data:', assetData);
                    const response = await fetch(`/employees/${employeeId}/assets/add/`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': getCookie('csrftoken')
                        },
                        body: JSON.stringify(assetData)
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || `Failed to add ${type.name} asset ${i + 1}`);
                    }

                    currentNumber = incrementAssetNumber(currentNumber, 1);
                }
            }

            // Reset form and close modal
            form.reset();
            assetsModal.hide();
            cleanupModal();
            location.reload();
        } catch (error) {
            console.error('Error adding assets:', error);
            alert(error.message || 'Failed to add assets. Please try again.');
        }
    });

    // Handle deleting asset type
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('delete-type') || e.target.closest('.delete-type')) {
            const btn = e.target.classList.contains('delete-type') ? e.target : e.target.closest('.delete-type');
            const typeId = btn.dataset.typeId;
            const typeName = btn.closest('tr').cells[0].textContent;

            if (confirm(`Are you sure you want to delete the asset type "${typeName}"? This cannot be undone.`)) {
                deleteAssetType(typeId);
            }
        }
    });

    // Function to delete asset type
    async function deleteAssetType(typeId) {
        try {
            const response = await fetch(`${API_BASE}/asset-types/${typeId}/`, {
                method: 'DELETE',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken')
                }
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || 'Failed to delete asset type');
            }

            // Remove the row from the manage types table
            const row = document.querySelector(`#assetTypesTable tr[data-type-id="${typeId}"]`);
            if (row) {
                row.remove();
            }

            // Remove the option from the asset type select
            const select = document.querySelector('#addAssetsForm select[name="asset_type"]');
            const option = select.querySelector(`option[value="${typeId}"]`);
            if (option) {
                option.remove();
            }

        } catch (error) {
            console.error('Error deleting asset type:', error);
            alert(error.message || 'Failed to delete asset type. Please try again.');
        }
    }

    // Handle view asset button
    document.addEventListener('click', function(e) {
        const viewBtn = e.target.closest('.view-asset');
        if (viewBtn) {
            e.preventDefault();
            const assetId = viewBtn.dataset.assetId;
            viewAsset(assetId);
        }
    });

    // Function to view asset details
    async function viewAsset(assetId) {
        try {
            const response = await fetch(`/employees/${employeeId}/assets/${assetId}/`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                }
            });

            if (!response.ok) {
                throw new Error('Failed to fetch asset details');
            }

            const asset = await response.json();
            console.log('Asset details:', asset); // Debug log
            
            // Populate modal with asset details
            const elements = {
                viewAssetType: asset.asset_type?.name,
                viewAssetName: asset.asset_name,
                viewAssetNumber: asset.asset_number,
                viewIssueDate: asset.issue_date ? new Date(asset.issue_date).toLocaleDateString() : null,
                viewCondition: asset.condition,
                viewValue: asset.value ? `$${parseFloat(asset.value).toFixed(2)}` : null,
                viewNotes: asset.notes
            };

            // Update each element with fallback to '-' if value is null/undefined
            Object.entries(elements).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = value || '-';
                }
            });

            // Handle return details section
            const returnSection = document.getElementById('returnDetailsSection');
            if (returnSection) {
                if (asset.return_date) {
                    document.getElementById('viewReturnDate').textContent = new Date(asset.return_date).toLocaleDateString();
                    document.getElementById('viewReturnCondition').textContent = asset.return_condition || '-';
                    document.getElementById('viewReturnNotes').textContent = asset.return_notes || '-';
                    returnSection.style.display = 'block';
                } else {
                    returnSection.style.display = 'none';
                }
            }

            // Show the modal
            const modalElement = document.getElementById('viewAssetModal');
            if (modalElement) {
                const modal = new bootstrap.Modal(modalElement);
                modal.show();
            }
            
        } catch (error) {
            console.error('Error viewing asset:', error);
            alert(error.message || 'Failed to view asset details');
        }
    }

    // Handle return asset button
    document.addEventListener('click', function(e) {
        if (e.target.closest('.return-asset')) {
            const btn = e.target.closest('.return-asset');
            const assetId = btn.dataset.assetId;
            const row = btn.closest('tr');
            const assetName = row.cells[2].textContent;
            
            // Set current date as default
            const returnDateInput = document.getElementById('returnDate');
            returnDateInput.value = new Date().toISOString().split('T')[0];
            
            // Store asset ID in the modal
            document.getElementById('returnAssetIds').value = assetId;
            
            // Show return modal
            returnAssetModal.show();
        }
    });

    // Handle select all checkbox
    document.getElementById('selectAll').addEventListener('change', function(e) {
        const checkboxes = document.querySelectorAll('.asset-select:not(:disabled)');
        checkboxes.forEach(checkbox => checkbox.checked = e.target.checked);
        updateBulkReturnButton();
    });

    // Handle individual checkboxes
    document.addEventListener('change', function(e) {
        if (e.target.classList.contains('asset-select')) {
            updateBulkReturnButton();
        }
    });

    // Update bulk return button visibility
    function updateBulkReturnButton() {
        const checkedBoxes = document.querySelectorAll('.asset-select:checked').length;
        const bulkReturnBtn = document.getElementById('bulkReturnBtn');
        bulkReturnBtn.style.display = checkedBoxes > 0 ? 'inline-block' : 'none';
    }

    // Handle bulk return button
    document.getElementById('bulkReturnBtn').addEventListener('click', function() {
        const selectedAssets = Array.from(document.querySelectorAll('.asset-select:checked')).map(checkbox => {
            const row = checkbox.closest('tr');
            return {
                id: row.dataset.assetId,
                name: row.cells[2].textContent
            };
        });

        if (selectedAssets.length === 0) {
            alert('Please select at least one asset to return');
            return;
        }

        // Set current date as default
        const returnDateInput = document.getElementById('returnDate');
        returnDateInput.value = new Date().toISOString().split('T')[0];
        
        // Store asset IDs in the modal
        document.getElementById('returnAssetIds').value = selectedAssets.map(a => a.id).join(',');
        
        // Show return modal
        returnAssetModal.show();
    });

    // Handle confirm return button
    document.getElementById('confirmReturnAsset').addEventListener('click', async function() {
        const form = document.getElementById('returnAssetForm');
        if (!form.checkValidity()) {
            form.reportValidity();
            return;
        }

        const assetIds = document.getElementById('returnAssetIds').value.split(',');
        const returnDate = document.getElementById('returnDate').value;
        const returnCondition = document.getElementById('returnCondition').value;
        const returnNotes = document.getElementById('returnNotes').value;

        try {
            // Return each asset
            for (const assetId of assetIds) {
                const response = await fetch(`/employees/${employeeId}/assets/${assetId}/return/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: JSON.stringify({
                        return_date: returnDate,
                        return_condition: returnCondition,
                        return_notes: returnNotes
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Failed to return asset');
                }
            }

            // Close modal and refresh page
            returnAssetModal.hide();
            cleanupModal();
            location.reload();
            
        } catch (error) {
            console.error('Error returning assets:', error);
            alert(error.message || 'Failed to return assets');
        }
    });

    // Handle delete asset button
    document.addEventListener('click', function(e) {
        if (e.target.closest('.delete-asset')) {
            const btn = e.target.closest('.delete-asset');
            const assetId = btn.dataset.assetId;
            const row = btn.closest('tr');
            const assetName = row.cells[2].textContent;
            
            if (confirm(`Are you sure you want to delete "${assetName}"? This cannot be undone.`)) {
                deleteAsset(assetId);
            }
        }
    });

    // Function to delete an asset
    async function deleteAsset(assetId) {
        try {
            const response = await fetch(`/employees/${employeeId}/assets/${assetId}/delete/`, {
                method: 'DELETE',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken')
                }
            });

            if (!response.ok) {
                throw new Error('Failed to delete asset');
            }

            // Remove the row from the table
            const row = document.querySelector(`tr[data-asset-id="${assetId}"]`);
            if (row) {
                row.remove();
            }
            
        } catch (error) {
            console.error('Error deleting asset:', error);
            alert(error.message || 'Failed to delete asset');
        }
    }

    // Utility function to increment asset numbers
    function incrementAssetNumber(baseNumber, increment) {
        const matches = baseNumber.match(/^([A-Za-z]+)(\d+)$/);
        if (!matches) return baseNumber;
        
        const prefix = matches[1];
        const number = parseInt(matches[2]);
        const newNumber = (number + increment).toString().padStart(matches[2].length, '0');
        return prefix + newNumber;
    }

    // Utility function to get CSRF token
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    // Add event listeners for modal hidden events
    ['addAssetTypeModal', 'manageAssetTypesModal', 'addAssetsModal', 'viewAssetModal', 'returnAssetModal'].forEach(modalId => {
        const modalElement = document.getElementById(modalId);
        if (modalElement) {
            modalElement.addEventListener('hidden.bs.modal', cleanupModal);
        }
    });

    // Handle modal backdrop cleanup
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('modal')) {
            cleanupModal();
        }
    });
});

```

### ðŸ“„ hrms_project\employees\static\employees\js\employee_detail.js
```// Initialize all tooltips
document.addEventListener('DOMContentLoaded', function() {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
});

```

### ðŸ“„ hrms_project\employees\static\employees\js\offences.js
```// Global variables
let allRules = []; // Store all rules for searching

document.addEventListener('DOMContentLoaded', function() {
    // Initialize modals and tooltips
    const addOffenceModal = new bootstrap.Modal('#addOffenceModal');
    const viewOffenceModal = new bootstrap.Modal('#viewOffenceModal');
    const addDocumentModal = new bootstrap.Modal('#addDocumentModal');

    // Cache DOM elements
    const offenseSearch = document.getElementById('offenseSearch');
    const offenceGroup = document.getElementById('offenceGroup');
    const offenceRule = document.getElementById('offenceRule');
    const appliedPenalty = document.getElementById('appliedPenalty');
    const offenseDate = document.getElementById('offenseDate');
    const addOffenceForm = document.getElementById('addOffenceForm');
    const addDocumentForm = document.getElementById('addDocumentForm');
    const ruleDescription = document.getElementById('ruleDescription');
    const ruleDescriptionText = document.getElementById('ruleDescriptionText');
    const previousOffenses = document.getElementById('previousOffenses');
    const previousOffensesList = document.getElementById('previousOffensesList');
    const offenseYear = document.getElementById('offenseYear');
    const offenseCount = document.getElementById('offenseCount');
    const suggestedPenalty = document.getElementById('suggestedPenalty');
    const penaltyNote = document.getElementById('penaltyNote');
    const monetaryPenaltySection = document.getElementById('monetaryPenaltySection');

    let currentRule = null; // Store the currently selected rule

    // Get the employee ID from the URL
    const employeeId = window.location.pathname.split('/')[2];

    // Set default date to today
    const today = new Date().toISOString().split('T')[0];
    offenseDate.value = today;
    offenseYear.textContent = new Date().getFullYear();

    // Helper Functions
    function populateRules(filterGroup = null) {
        console.log('Populating rules with filter:', filterGroup);
        console.log('Available rules:', allRules);

        let filteredRules = allRules;
        if (filterGroup) {
            filteredRules = allRules.filter(rule => rule.group === filterGroup);
        }

        let options = '<option value="">Select Rule</option>';
        if (Array.isArray(filteredRules)) {
            filteredRules.forEach(rule => {
                const groupLabel = offenceGroup.querySelector(`option[value="${rule.group}"]`)?.textContent || '';
                options += `<option value="${rule.id}" data-group="${rule.group}" data-description="${rule.description}">${rule.rule_id} - ${rule.name}</option>`;
            });
        }
        offenceRule.innerHTML = options;
        console.log('Updated dropdown HTML:', offenceRule.innerHTML);

        // Update tooltips after populating options
        offenceRule.querySelectorAll('option').forEach(option => {
            if (option.dataset.description) {
                option.title = option.dataset.description;
            }
        });
    }

    function formatRule(rule) {
        if (!rule.id) return rule.text;

        const highlight = (text, term) => {
            if (!term) return text;
            return text.replace(new RegExp(escapeRegex(term), 'gi'), match => `<strong>${match}</strong>`);
        };

        const searchTerm = rule.element?.dataset?.searchTerm || '';
        const description = rule.rule?.description || '';
        const groupDisplay = rule.rule?.group_display || '';

        const $container = $(
            `<div class="rule-option p-2">
                <div class="rule-title fw-bold mb-1">${highlight(rule.text, searchTerm)}</div>
                <div class="rule-info small text-muted">
                    <div class="mb-1"><strong>Group:</strong> ${groupDisplay}</div>
                    <div class="text-wrap">${highlight(description, searchTerm)}</div>
                </div>
             </div>`
        );

        return $container;
    }

    function formatRuleSelection(rule) {
        if (!rule.id) return rule.text;
        return `${rule.rule?.rule_id} - ${rule.rule?.name}`;
    }

    // API Functions
    async function fetchAllRules() {
        try {
            console.log('Fetching rules...');
            const response = await fetch('/employees/api/offense-rules/');
            console.log('Response status:', response.status);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const data = await response.json();
            console.log('Raw API response:', data);

            allRules = Array.isArray(data) ? data : (data.results || []);
            console.log('Processed rules:', allRules);

            populateRules();
        } catch (error) {
            console.error('Error loading rules:', error);
            showAlert('Error loading rules. Please try again.', 'danger');
        }
    }

    async function updatePenalty(ruleId, year = new Date().getFullYear()) {
        try {
            const rule = allRules.find(r => r.id === parseInt(ruleId));
            if (!rule) return;

            currentRule = rule;

            // Get active offense count for the specified year
            const response = await fetch(`/employees/api/employee-offenses/${employeeId}/count/?rule=${ruleId}&year=${year}`);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const data = await response.json();

            // Set the suggested penalty
            appliedPenalty.value = data.suggested_penalty;
            suggestedPenalty.textContent = appliedPenalty.options[appliedPenalty.selectedIndex].text;
            suggestedPenalty.dataset.value = data.suggested_penalty;
            penaltyNote.style.display = 'none';

            // Show description
            if (rule.description) {
                ruleDescriptionText.textContent = rule.description;
                ruleDescription.style.display = 'block';
            } else {
                ruleDescription.style.display = 'none';
            }

            // Update offense count and list
            offenseCount.textContent = data.count + 1;

            if (data.offenses && data.offenses.length > 0) {
                let offenseHtml = '<ul class="mb-2">';
                data.offenses.forEach((offense, index) => {
                    const date = new Date(offense.date).toLocaleDateString();
                    offenseHtml += `<li>Offense #${index + 1}: ${date} - ${offense.penalty}</li>`;
                });
                offenseHtml += '</ul>';

                previousOffensesList.innerHTML = offenseHtml;
                previousOffenses.style.display = 'block';
            } else {
                previousOffensesList.innerHTML = '<p class="mb-2">No previous offenses this year.</p>';
                previousOffenses.style.display = 'block';
            }
        } catch (error) {
            console.error('Error loading rule details:', error);
            showAlert('Error loading rule details. Please try again.', 'danger');
        }
    }





    function escapeRegex(string) {
        return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    }

    // Initialize and destroy Select2 when modal is shown/hidden
    $('#addOffenceModal').on('shown.bs.modal', function() {
        console.log('Modal shown, initializing select2...');

        // Initialize select2 with a small delay
        setTimeout(function() {
            $('#offenseSearch').select2({
                width: '100%',
                placeholder: 'Search for offense rule...',
                minimumInputLength: 2,
                dropdownParent: $('#addOffenceModal'),
                ajax: {
                    url: '/employees/api/offense-rules/',
                    dataType: 'json',
                    delay: 250,
                    data: function(params) {
                        return {
                            search: params.term,
                            page: params.page || 1
                        };
                    },
                    processResults: function(data) {
                        return {
                            results: data.map(function(rule) {
                                return {
                                    id: rule.id,
                                    text: `${rule.rule_id} - ${rule.name}`,
                                    rule: {
                                        ...rule,
                                        group_display: rule.group_display || rule.group
                                    }
                                };
                            }),
                            pagination: {
                                more: false
                            }
                        };
                    },
                    cache: true
                },
                templateResult: formatRule,
                templateSelection: formatRuleSelection,
                escapeMarkup: function(markup) {
                    return markup;
                }
            });
        }, 50); // 50ms delay - you can adjust if needed

    }).on('hidden.bs.modal', function() {
        // Destroy select2 when modal is hidden
        try {
            $('#offenseSearch').select2('destroy');
        } catch (e) {
            console.log('No select2 instance to destroy');
        }
    });

    // Handle offense date change
    offenseDate.addEventListener('change', async function() {
        if (currentRule) {
            const year = new Date(this.value).getFullYear();
            offenseYear.textContent = year;
            await updatePenalty(currentRule.id, year);
        }
    });

    // Handle applied penalty change
    appliedPenalty.addEventListener('change', function() {
        const suggestedValue = suggestedPenalty.dataset.value;
        const monetaryPenaltySection = document.getElementById('monetaryPenaltySection');

        // Show/hide monetary penalty section based on penalty type
        if (this.value === 'MONETARY') {
            monetaryPenaltySection.style.display = 'block';
        } else {
            monetaryPenaltySection.style.display = 'none';
        }

        // Show warning if different from suggested penalty
        if (suggestedValue && this.value !== suggestedValue) {
            penaltyNote.style.display = 'block';
        } else {
            penaltyNote.style.display = 'none';
        }
    });

    // Handle offense status changes
    async function markOffenseStatus(offenseId, status) {
        try {
            const response = await fetch(`/employees/api/employee-offenses/${offenseId}/status/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({ status })
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            // Reload the page to show updated status
            location.reload();
        } catch (error) {
            console.error('Error updating offense status:', error);
            showAlert('Error updating offense status. Please try again.', 'danger');
        }
    }

    // Handle monetary penalty payments
    async function recordPayment(offenseId) {
        const amount = prompt('Enter payment amount (BHD):');
        if (!amount) return;

        try {
            const response = await fetch(`/employees/api/employee-offenses/${offenseId}/payment/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({ amount: parseFloat(amount) })
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            // Reload the page to show updated payment status
            location.reload();
        } catch (error) {
            console.error('Error recording payment:', error);
            showAlert('Error recording payment. Please try again.', 'danger');
        }
    }

    // Print offense
    async function printOffense(offenseId) {
        try {
            const response = await fetch(`/employees/api/employee-offenses/${offenseId}/print/`);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            // Create a blob from the PDF stream
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);

            // Open the PDF in a new window
            window.open(url);
        } catch (error) {
            console.error('Error generating offense print:', error);
            showAlert('Error generating offense print. Please try again.', 'danger');
        }
    }

    // Event Listeners
    $(offenseSearch).on('select2:select', async function(e) {
        const selectedRule = e.params.data.rule;
        if (selectedRule) {
            offenceGroup.value = selectedRule.group;
            await populateRules();
            offenceRule.value = selectedRule.id;
            await updatePenalty(selectedRule.id);
        }
    });

    offenceGroup.addEventListener('change', function() {
        const group = this.value;
        populateRules(group);
    });

    offenceRule.addEventListener('change', async function() {
        const ruleId = this.value;
        if (!ruleId) {
            ruleDescription.style.display = 'none';
            return;
        }

        const selectedOption = this.options[this.selectedIndex];
        const group = selectedOption.dataset.group;

        if (group && offenceGroup.value !== group) {
            offenceGroup.value = group;
        }

        await updatePenalty(ruleId);
    });

    // Handle offense date change
    offenseDate.addEventListener('change', async function() {
        if (currentRule) {
            const year = new Date(this.value).getFullYear();
            offenseYear.textContent = year;
            await updatePenalty(currentRule.id, year);
        }
    });

    // Handle applied penalty change
    appliedPenalty.addEventListener('change', function() {
        const suggestedValue = suggestedPenalty.dataset.value;
        const monetaryPenaltySection = document.getElementById('monetaryPenaltySection');

        // Show/hide monetary penalty section based on penalty type
        if (this.value === 'MONETARY') {
            monetaryPenaltySection.style.display = 'block';
        } else {
            monetaryPenaltySection.style.display = 'none';
        }

        // Show warning if different from suggested penalty
        if (suggestedValue && this.value !== suggestedValue) {
            penaltyNote.style.display = 'block';
        } else {
            penaltyNote.style.display = 'none';
        }
    });

    // Handle save offense
    document.getElementById('saveOffenceBtn').addEventListener('click', async function() {
        try {
            const formData = new FormData(addOffenceForm);

            // Add employee ID to form data
            formData.append('employee', employeeId);

            // Get the rule ID from the select element
            const selectedRule = $('#offenseSearch').select2('data')[0];
            if (!selectedRule || !selectedRule.id) {
                showAlert('Please select an offense rule.', 'danger');
                return;
            }

            // Add the rule ID with correct field name
            formData.append('rule', selectedRule.id);

            // If it's a monetary penalty, add the monetary fields
            if (appliedPenalty.value === 'MONETARY') {
                const monetaryAmount = document.getElementById('monetaryAmount').value;
                const monthlyDeduction = document.getElementById('monthlyDeduction').value;

                if (!monetaryAmount || monetaryAmount <= 0) {
                    showAlert('Please enter a valid monetary penalty amount.', 'danger');
                    return;
                }

                if (!monthlyDeduction || monthlyDeduction <= 0) {
                    showAlert('Please enter a valid monthly deduction amount.', 'danger');
                    return;
                }

                formData.append('monetary_amount', monetaryAmount);
                formData.append('monthly_deduction', monthlyDeduction);
            }

            const response = await fetch('/employees/api/employee-offenses/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: formData
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error || error.detail || 'Failed to save offense');
            }

            const offense = await response.json();

            // Clear form and close modal
            addOffenceForm.reset();
            monetaryPenaltySection.style.display = 'none';
            addOffenceModal.hide();

            // Show success message and reload page
            showAlert('Offense added successfully!', 'success');
            setTimeout(() => location.reload(), 1000);
        } catch (error) {
            console.error('Error saving offense:', error);
            showAlert(error.message || 'Error saving offense. Please try again.', 'danger');
        }
    });

    // Handle view offense
    document.addEventListener('click', function(e) {
        const viewBtn = e.target.closest('.view-offence');
        if (viewBtn) {
            e.preventDefault();
            viewOffence(viewBtn.dataset.offenceId);
        }
    });

    // Handle add document
    document.addEventListener('click', function(e) {
        const addDocBtn = e.target.closest('.add-document');
        if (addDocBtn) {
            e.preventDefault();
            document.getElementById('documentOffenseId').value = addDocBtn.dataset.offenceId;
            addDocumentModal.show();
        }
    });

    // Handle save document
    document.getElementById('saveDocumentBtn').addEventListener('click', async function() {
        if (!addDocumentForm.checkValidity()) {
            addDocumentForm.reportValidity();
            return;
        }

        const formData = new FormData(addDocumentForm);

        try {
            const response = await fetch('/employees/api/offense-documents/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: formData
            });

            if (!response.ok) throw new Error('Failed to save document');

            addDocumentModal.hide();
            addDocumentForm.reset();
            showAlert('Document added successfully!', 'success');

            // Refresh offense details if viewing
            const offenseId = formData.get('offense_id');
            if (viewOffenceModal._isShown) {
                viewOffence(offenseId);
            }
        } catch (error) {
            console.error('Error saving document:', error);
            showAlert('Error saving document. Please try again.', 'danger');
        }
    });

    // Initialize
    fetchAllRules();
});

// Utility Functions
function addOffenceToTable(offense) {
    const tbody = document.querySelector('#offencesTable tbody');
    const tr = document.createElement('tr');
    tr.dataset.offenceId = offense.id;

    if (!offense.is_active) {
        tr.classList.add('table-secondary');
    }

    const offenseDate = new Date(offense.offense_date);

    tr.innerHTML = `
        <td>${offense.rule.rule_id}</td>
        <td>${offenseDate.toLocaleDateString()}</td>
        <td>${offenseDate.getFullYear()}</td>
        <td>${offense.rule.group_display}</td>
        <td>${offense.rule.name}</td>
        <td>${offense.offense_count}</td>
        <td>${offense.original_penalty_display}</td>
        <td>${offense.applied_penalty_display}</td>
        <td>
            ${offense.is_active ?
                `<span class="badge ${offense.is_acknowledged ? 'bg-success' : 'bg-warning'}">
                    ${offense.is_acknowledged ? 'Acknowledged' : 'Pending'}
                </span>` :
                '<span class="badge bg-secondary">Inactive</span>'
            }
        </td>
        <td>
            <button type="button" class="btn btn-sm btn-info view-offence" data-offence-id="${offense.id}" title="View Details">
                <i class="fas fa-eye"></i>
            </button>
            ${offense.is_active ?
                `<button type="button" class="btn btn-sm btn-primary add-document" data-offence-id="${offense.id}" title="Add Document">
                    <i class="fas fa-file-upload"></i>
                </button>` : ''
            }
        </td>
    `;

    tbody.insertBefore(tr, tbody.firstChild);
}

async function viewOffence(offenseId) {
    try {
        // Get offense details
        const response = await fetch(`/employees/api/employee-offenses/${offenseId}/`);
        const offense = await response.json();

        // Update offense details
        document.getElementById('viewRuleId').textContent = offense.rule.rule_id;
        document.getElementById('viewRuleName').textContent = offense.rule.name;
        document.getElementById('viewGroup').textContent = offense.rule.group_display;
        document.getElementById('viewDescription').textContent = offense.rule.description;
        document.getElementById('viewDate').textContent = new Date(offense.offense_date).toLocaleDateString();
        document.getElementById('viewOriginalPenalty').textContent = offense.original_penalty_display;
        document.getElementById('viewAppliedPenalty').textContent = offense.applied_penalty_display;
        document.getElementById('viewStatus').innerHTML = offense.is_active ?
            `<span class="badge ${offense.is_acknowledged ? 'bg-success' : 'bg-warning'}">
                ${offense.is_acknowledged ? 'Acknowledged' : 'Pending'}
            </span>` :
            '<span class="badge bg-secondary">Inactive</span>';

        // Get offense count and history
        const year = new Date(offense.offense_date).getFullYear();
        const countResponse = await fetch(`/employees/api/employee-offenses/${offense.employee}/count/?rule=${offense.rule.id}&year=${year}`);
        if (!countResponse.ok) {
            throw new Error(`HTTP error! status: ${countResponse.status}`);
        }
        const countData = await countResponse.json();

        // Show previous offenses if any exist
        const viewPreviousOffenses = document.getElementById('viewPreviousOffenses');
        const viewPreviousOffensesList = document.getElementById('viewPreviousOffensesList');

        if (countData.offenses && countData.offenses.length > 0) {
            let offenseHtml = `<p class="mb-2">This is offense #${countData.count} for this rule in ${year}.</p>`;
            offenseHtml += '<ul class="mb-0">';
            countData.offenses.forEach((o, index) => {
                const date = new Date(o.date).toLocaleDateString();
                const isCurrent = o.date === offense.offense_date;
                offenseHtml += `<li${isCurrent ? ' class="fw-bold"' : ''}>${date} - ${o.penalty}${isCurrent ? ' (Current)' : ''}</li>`;
            });
            offenseHtml += '</ul>';

            viewPreviousOffensesList.innerHTML = offenseHtml;
            viewPreviousOffenses.style.display = 'block';
        } else {
            viewPreviousOffenses.style.display = 'none';
        }

        // Update documents list
        const documentsList = document.getElementById('viewDocumentsList');
        if (offense.documents && offense.documents.length > 0) {
            let docsHtml = '<ul class="list-unstyled mb-0">';
            offense.documents.forEach(doc => {
                docsHtml += `
                    <li class="mb-2">
                        <i class="fas fa-file me-2"></i>
                        <a href="${doc.file_url}" target="_blank">${doc.name || 'Document'}</a>
                        <small class="text-muted">(${doc.document_type_display})</small>
                    </li>`;
            });
            docsHtml += '</ul>';
            documentsList.innerHTML = docsHtml;
        } else {
            documentsList.innerHTML = '<p class="text-muted mb-0">No documents attached</p>';
        }

        // Show the modal
        const viewOffenceModal = new bootstrap.Modal('#viewOffenceModal');
        viewOffenceModal.show();
    } catch (error) {
        console.error('Error loading offense details:', error);
        showAlert('Error loading offense details. Please try again.', 'danger');
    }
}

function showAlert(message, type = 'info') {
    const alertsContainer = document.getElementById('alerts-container');
    const alert = document.createElement('div');
    alert.className = `alert alert-${type} alert-dismissible fade show`;
    alert.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    `;
    alertsContainer.appendChild(alert);
    setTimeout(() => alert.remove(), 5000);
}

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
```

### ðŸ“„ hrms_project\employees\templates\employees\base.html
```<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}HRM System{% endblock %}</title>
    
    <!-- jQuery first -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Select2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    
    {% block extra_css %}{% endblock %}
    <style>
        body {
            padding-top: 10px;
        }
        .navbar {
            position: fixed;
            top: 0;
            right: 0;
            left: 0;
            z-index: 1030;
        }
        .main-content {
            margin-top: 2rem;
        }
        .select2-container {
            width: 100% !important;
        }
        .select2-selection__rendered {
            line-height: 31px !important;
        }
        .select2-container .select2-selection--single {
            height: 35px !important;
        }
        .select2-selection__arrow {
            height: 34px !important;
        }
        .flag-icon {
            margin-right: 8px;
        }
        /* Toast styling */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1060;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <a class="navbar-brand" href="{% url 'core:dashboard' %}"><i class="fas fa-home"></i> HRM System</a>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'employees:employee_list' %}">Employees</a>
                    </li>
                </ul>
                <ul class="navbar-nav ms-auto">
                    {% if user.is_authenticated %}
                        <li class="nav-item">
                            <span class="nav-link">Welcome, {{ user.username }}</span>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'core:logout' %}">Logout</a>
                        </li>
                    {% else %}
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'core:login' %}">Login</a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <!-- Toast Container -->
    <div class="toast-container"></div>

    <!-- Main Content -->
    <div class="container-fluid main-content p-4">
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show mb-4">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        {% endif %}
        
        {% block content %}{% endblock %}
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Select2 and flag icons -->
    <link href="https://cdn.jsdelivr.net/npm/flag-icon-css@4.1.7/css/flag-icons.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Utility Functions -->
    <script>
    function showToast(title, message, type = 'info') {
        const toastContainer = document.querySelector('.toast-container');
        const toastId = 'toast-' + Date.now();
        const bgClass = type === 'success' ? 'bg-success' : 
                       type === 'error' ? 'bg-danger' : 
                       type === 'warning' ? 'bg-warning' : 'bg-info';
        const textClass = type === 'warning' ? 'text-dark' : 'text-white';
        
        const toastHtml = `
            <div id="${toastId}" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-header ${bgClass} ${textClass}">
                    <strong class="me-auto">${title}</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body">
                    ${message}
                </div>
            </div>
        `;
        
        toastContainer.insertAdjacentHTML('beforeend', toastHtml);
        const toastElement = document.getElementById(toastId);
        const toast = new bootstrap.Toast(toastElement, { delay: 5000 });
        toast.show();
        
        // Remove the toast element after it's hidden
        toastElement.addEventListener('hidden.bs.toast', function () {
            toastElement.remove();
        });
    }

    function showFormErrors(form, errors) {
        // Clear previous error messages
        form.find('.invalid-feedback').remove();
        form.find('.is-invalid').removeClass('is-invalid');
        
        // Add new error messages
        for (const field in errors) {
            const input = form.find(`[name="${field}"]`);
            input.addClass('is-invalid');
            
            const errorDiv = $('<div>')
                .addClass('invalid-feedback')
                .text(errors[field].join(' '));
            
            input.after(errorDiv);
        }
        
        // Show error toast
        showToast('Error', 'Please correct the errors in the form.', 'error');
    }
    </script>

    {% block extra_js %}{% endblock %}
</body>
</html>

```

### ðŸ“„ hrms_project\employees\templates\employees\certificate_form.html
```{% extends "employees/base.html" %}
{% load static %}

{% block title %}Request Salary Certificate - {{ employee.get_full_name }}{% endblock %}

{% block content %}
<div class="container-fluid p-4">
    <div class="card info-card">
        <div class="card-header">
            <h5 class="mb-0">Request Salary Certificate</h5>
        </div>
        <div class="card-body">
            <form method="post" class="needs-validation" novalidate>
                {% csrf_token %}
                
                {% if form.non_field_errors %}
                <div class="alert alert-danger">
                    {% for error in form.non_field_errors %}
                        {{ error }}
                    {% endfor %}
                </div>
                {% endif %}

                <div class="row mb-4">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label for="{{ form.purpose.id_for_label }}" class="form-label">Purpose *</label>
                            {{ form.purpose }}
                            {% if form.purpose.errors %}
                            <div class="invalid-feedback d-block">
                                {{ form.purpose.errors.0 }}
                            </div>
                            {% endif %}
                            <small class="form-text text-muted">Specify the purpose for requesting this certificate</small>
                        </div>
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="{{ form.expiry_date.id_for_label }}" class="form-label">Expiry Date</label>
                            {{ form.expiry_date }}
                            {% if form.expiry_date.errors %}
                            <div class="invalid-feedback d-block">
                                {{ form.expiry_date.errors.0 }}
                            </div>
                            {% endif %}
                            <small class="form-text text-muted">Optional. Leave blank if certificate should not expire.</small>
                        </div>
                    </div>
                </div>

                <!-- Current Salary Information (Read-only) -->
                {% if employee.salary_details.exists %}
                {% with current_salary=employee.salary_details.first %}
                <div class="alert alert-info mb-4">
                    <h6 class="alert-heading mb-2">Current Salary Information</h6>
                    <div class="row">
                        <div class="col-md-4">
                            <small class="d-block text-muted">Basic Salary:</small>
                            <strong>{{ current_salary.basic_salary }} {{ current_salary.currency }}</strong>
                        </div>
                        <div class="col-md-4">
                            <small class="d-block text-muted">Total Allowances:</small>
                            <strong>{{ current_salary.housing_allowance|add:current_salary.transportation_allowance }} {{ current_salary.currency }}</strong>
                        </div>
                        <div class="col-md-4">
                            <small class="d-block text-muted">Total Salary:</small>
                            <strong>{{ current_salary.total_salary }} {{ current_salary.currency }}</strong>
                        </div>
                    </div>
                </div>
                {% endwith %}
                {% else %}
                <div class="alert alert-warning mb-4">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    No active salary details found. Please add salary details before requesting a certificate.
                </div>
                {% endif %}

                <div class="d-flex justify-content-end">
                    <a href="{% url 'employees:employee_detail' employee.id %}" class="btn btn-secondary me-2">Cancel</a>
                    <button type="submit" class="btn btn-primary" {% if not employee.salary_details.exists %}disabled{% endif %}>
                        Request Certificate
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Initialize form validation
    (function() {
        'use strict';
        var forms = document.querySelectorAll('.needs-validation');
        Array.prototype.slice.call(forms).forEach(function(form) {
            form.addEventListener('submit', function(event) {
                if (!form.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            }, false);
        });
    })();
</script>
{% endblock %}
```

### ðŸ“„ hrms_project\employees\templates\employees\employee_confirm_delete.html
```{% extends "employees/base.html" %}

{% block title %}Delete Employee{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h5 class="card-title mb-0">Confirm Delete</h5>
    </div>
    <div class="card-body">
        <p>Are you sure you want to delete the employee "{{ employee.get_full_name }}"?</p>
        <p class="text-danger">This action cannot be undone.</p>
    </div>
    <div class="card-footer">
        <form method="post">
            {% csrf_token %}
            <a href="{% url 'employees:employee_detail' employee.pk %}" class="btn btn-secondary">Cancel</a>
            <button type="submit" class="btn btn-danger">Delete</button>
        </form>
    </div>
</div>
{% endblock %}

```

### ðŸ“„ hrms_project\employees\templates\employees\employee_detail.html
```{% extends "employees/base.html" %}
{% load static %}

{% block title %}{{ employee.get_full_name }} - Employee Details{% endblock %}

{% block extra_css %}
<style>
    /* Keep the CSS here as it's specific to this page */
    .profile-header {
        background: linear-gradient(135deg, #4e73df 0%, #224abe 100%);
        color: white;
        padding: 2rem;
        border-radius: 0.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .info-card {
        background: white;
        border-radius: 0.5rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        margin-bottom: 1.5rem;
        border: none;
    }

    .info-card .card-header {
        background: transparent;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        padding: 1rem 1.5rem;
    }

    .info-card .card-header h5 {
        margin: 0;
        color: #2c3e50;
        font-weight: 600;
    }

    .info-section {
        padding: 1rem;
        background: #f8f9fc;
        border-radius: 0.5rem;
    }

    .section-title {
        color: #4e73df;
        font-size: 0.9rem;
        font-weight: 600;
        margin-bottom: 1rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .info-group {
        display: grid;
        gap: 1rem;
    }

    .info-item {
        display: flex;
        flex-direction: column;
    }

    .info-item label {
        font-size: 0.8rem;
        color: #858796;
        margin-bottom: 0.25rem;
    }

    .info-item .value {
        color: #2c3e50;
        font-weight: 500;
    }

    .nav-pills .nav-link {
        color: #6c757d;
        padding: 0.75rem 1.25rem;
        border-radius: 0.25rem;
        margin-bottom: 0.5rem;
        transition: all 0.3s ease;
    }

    .nav-pills .nav-link.active {
        background-color: #4e73df;
        color: white;
    }

    .nav-pills .nav-link:hover:not(.active) {
        background-color: #f8f9fa;
    }

    .status-badge {
        padding: 0.5rem 1rem;
        border-radius: 2rem;
        font-size: 0.875rem;
        font-weight: 500;
        display: inline-block;
    }

    .status-active {
        background-color: #e3fcef;
        color: #00a854;
    }

    .status-inactive {
        background-color: #fff1f0;
        color: #f5222d;
    }

    .status-warning {
        background-color: #fff7e6;
        color: #fa8c16;
    }

    .status-success {
        background-color: #e3fcef;
        color: #00a854;
    }

    .table {
        --bs-table-hover-bg: rgba(78, 115, 223, 0.05);
    }

    .btn-group .btn {
        margin: 0 2px;
    }
</style>
{% endblock %}

{% block content %}
<!-- Profile Header -->
 <div class="container-fluid p-4">
<div class="profile-header">
    <div class="row align-items-center">
        <div class="col-auto">
            {% if employee.profile_picture %}
                <a href="#" data-bs-toggle="modal" data-bs-target="#profilePictureModal">
                    <img src="{{ employee.profile_picture.url }}" alt="Profile Picture" class="rounded-circle" style="width: 100px; height: 100px; object-fit: cover;">
                </a>
                <!-- Profile Picture Modal -->
                <div class="modal fade" id="profilePictureModal" tabindex="-1" aria-labelledby="profilePictureModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="profilePictureModalLabel">{{ employee.get_full_name }}'s Profile Picture</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body text-center">
                                <img src="{{ employee.profile_picture.url }}" alt="Profile Picture" class="img-fluid">
                            </div>
                        </div>
                    </div>
                </div>
            {% else %}
                <div class="rounded-circle bg-secondary d-flex align-items-center justify-content-center" style="width: 100px; height: 100px;">
                    <i class="fas fa-user fa-3x text-white"></i>
                </div>
            {% endif %}
        </div>
        <div class="col">
            <h2 class="mb-1">{{ employee.get_full_name }}</h2>
            <p class="mb-1">Employee #{{ employee.employee_number }}</p>
            <p class="mb-0">{{ employee.designation|default:"" }}</p>
        </div>
        <div class="col-auto">
            <span class="status-badge {% if employee.is_active %}status-active{% else %}status-inactive{% endif %}">
                {{ employee.is_active|yesno:"Active,Inactive" }}
            </span>
        </div>
        <div class="col-auto">
            <a href="{% url 'employees:employee_update' employee.pk %}" class="btn btn-light me-2">
                <i class="fas fa-edit"></i> Edit
            </a>
            <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal">
                <i class="fas fa-trash"></i> Delete
            </button>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-3">
        <div class="nav flex-column nav-pills" id="employeeTabs" role="tablist">
            <a class="nav-link active" data-bs-toggle="pill" href="#general" role="tab">
                <i class="fas fa-user me-2"></i>General
            </a>
            <a class="nav-link" data-bs-toggle="pill" href="#bank" role="tab">
                <i class="fas fa-university me-2"></i>Bank
            </a>
            <a class="nav-link" data-bs-toggle="pill" href="#documents" role="tab">
                <i class="fas fa-file-alt me-2"></i>Documents
            </a>
            <a class="nav-link" data-bs-toggle="pill" href="#dependents" role="tab">
                <i class="fas fa-users me-2"></i>Dependents
            </a>
            <a class="nav-link" data-bs-toggle="pill" href="#salary" role="tab">
                <i class="fas fa-money-bill-wave me-2"></i>Salary
            </a>
            <a class="nav-link" data-bs-toggle="pill" href="#attendance" role="tab">
                <i class="fas fa-calendar-check me-2"></i>Attendance
            </a>
            <a class="nav-link" data-bs-toggle="pill" href="#bond" role="tab">
                <i class="fas fa-handshake me-2"></i>Bond & Guarantee
            </a>
            <a class="nav-link" data-bs-toggle="pill" href="#assets" role="tab">
                <i class="fas fa-laptop me-2"></i>Assets In Hand
            </a>
            <a class="nav-link" data-bs-toggle="pill" href="#education" role="tab">
                <i class="fas fa-graduation-cap me-2"></i>Education
            </a>
            <a class="nav-link" data-bs-toggle="pill" href="#offences" role="tab">
                <i class="fas fa-exclamation-triangle me-2"></i>Offences
            </a>
            <a class="nav-link" data-bs-toggle="pill" href="#events" role="tab">
                <i class="fas fa-history me-2"></i>Life Events
            </a>
        </div>
    </div>

    <div class="col-md-9">
        <div class="tab-content" id="employeeTabContent">
            <!-- Include the content for each tab here -->
            {% include 'employees/preview/_employee_general_tab.html' %}
            {% include 'employees/preview/_employee_bank_tab.html' %}
            {% include 'employees/preview/_employee_documents_tab.html' %}
            {% include 'employees/preview/dependents/_employee_dependents_tab.html' %}
            {% include 'employees/preview/_employee_salary_tab.html' %}
            {% include 'employees/preview/_employee_attendance_tab.html' %}
            {% include 'employees/preview/_employee_bond_tab.html' %}
            {% include 'employees/preview/assets_in_hand/_employee_assets_tab.html' %}
            {% include 'employees/preview/_employee_education_tab.html' %}
            {% include 'employees/preview/_employee_offences_tab.html' %}
            {% include 'employees/preview/_employee_events_tab.html' %}
        </div>
    </div>
</div>
</div>

<!-- Delete Modal -->
{% include 'employees/preview/_employee_delete_modal.html' %}
{% endblock %}

{% block extra_js %}
<!-- Custom JS for employee details -->
<script src="{% static 'employees/js/employee_detail.js' %}"></script>
<script src="{% static 'employees/js/offences.js' %}"></script>
{% endblock %}
```

### ðŸ“„ hrms_project\employees\templates\employees\employee_form.html
```{% extends "employees/base.html" %}
{% load crispy_forms_tags %}

{% block title %}{% if form.instance.pk %}Edit{% else %}Create{% endif %} Employee{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <h2>{% if form.instance.pk %}Edit{% else %}Create{% endif %} Employee</h2>
    </div>
</div>

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="card">
        <div class="card-body">
            {% crispy form %}
        </div>
    </div>
</form>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize all tabs
        var triggerTabList = [].slice.call(document.querySelectorAll('.nav-tabs a'))
        triggerTabList.forEach(function(triggerEl) {
            new bootstrap.Tab(triggerEl)
        })
    });

    $(document).ready(function() {
        // Initialize Select2 for nationality field
        $('#id_nationality').select2({
            placeholder: 'Select nationality',
            allowClear: true,
            templateResult: formatNationality,
            templateSelection: formatNationality
        });

        // Format nationality options with flags
        function formatNationality(nationality) {
            if (!nationality.id) {
                return nationality.text;
            }

            // Map nationality values to their corresponding flag codes
            const flagMap = {
                'ALGERIAN': 'dz',
                'AMERICAN': 'us',
                'ARGENTINA': 'ar',
                'AUSTRALIAN': 'au',
                'BAHRAINI': 'bh',
                'BANGLADESHI': 'bd',
                'BELGIAN': 'be',
                'BRAZILIAN': 'br',
                'BRITISH': 'gb',
                'BULGARIAN': 'bg',
                'CAMEROONIAN': 'cm',
                'CANADIAN': 'ca',
                'CHILEAN': 'cl',
                'CHINESE': 'cn',
                'COLOMBIAN': 'co',
                'CROATIAN': 'hr',
                'CUBAN': 'cu',
                'CYPRIOT': 'cy',
                'CZECH': 'cz',
                'DANISH': 'dk',
                'DJIBOUTIAN': 'dj',
                'EGYPTIAN': 'eg',
                'FILIPINO': 'ph',
                'FRENCH': 'fr',
                'GERMAN': 'de',
                'GHANAIAN': 'gh',
                'GREEK': 'gr',
                'DUTCH': 'nl',
                'HONG_KONGER': 'hk',
                'INDIAN': 'in',
                'INDONESIAN': 'id',
                'IRANIAN': 'ir',
                'IRAQI': 'iq',
                'IRISH': 'ie',
                'ITALIAN': 'it',
                'JAMAICAN': 'jm',
                'JAPANESE': 'jp',
                'JORDANIAN': 'jo',
                'KENYAN': 'ke',
                'KUWAITI': 'kw',
                'LEBANESE': 'lb',
                'MALAWIAN': 'mw',
                'MALAYSIAN': 'my',
                'MEXICAN': 'mx',
                'MOROCCAN': 'ma',
                'NEPALI': 'np',
                'NEW_ZEALANDER': 'nz',
                'NIGERIAN': 'ng',
                'NORWEGIAN': 'no',
                'OMANI': 'om',
                'PAKISTANI': 'pk',
                'POLISH': 'pl',
                'PORTUGUESE': 'pt',
                'RUSSIAN': 'ru',
                'SAUDI': 'sa',
                'SCOTTISH': 'gb-sct',
                'SERBIAN': 'rs',
                'SEYCHELLOIS': 'sc',
                'SINGAPOREAN': 'sg',
                'SOUTH_AFRICAN': 'za',
                'SPANISH': 'es',
                'SRI_LANKAN': 'lk',
                'SUDANESE': 'sd',
                'SWEDISH': 'se',
                'SWISS': 'ch',
                'SYRIAN': 'sy',
                'TAIWANESE': 'tw',
                'TANZANIAN': 'tz',
                'THAI': 'th',
                'TUNISIAN': 'tn',
                'TURKISH': 'tr',
                'EMIRATI': 'ae',
                'UGANDAN': 'ug',
                'UKRAINIAN': 'ua',
                'VENEZUELAN': 've',
                'VIETNAMESE': 'vn',
                'YEMENI': 'ye',
                'ZIMBABWEAN': 'zw'
            };

            const flagCode = flagMap[nationality.id] || 'unknown';
            return $('<span><span class="flag-icon flag-icon-' + flagCode + '"></span> ' + nationality.text + '</span>');
        }
    });
</script>
{% endblock %}

```

### ðŸ“„ hrms_project\employees\templates\employees\employee_list.html
```{% extends "employees/base.html" %}
{% load static %}

{% block title %}Employee List{% endblock %}

{% block extra_css %}
<link href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css" rel="stylesheet">
<link href="https://cdn.datatables.net/buttons/2.2.2/css/buttons.bootstrap5.min.css" rel="stylesheet">
<link href="https://cdn.datatables.net/select/1.3.4/css/select.bootstrap5.min.css" rel="stylesheet">
<style>
    .container-fluid {
        padding: 1rem;
    }
    .selected {
        background-color: #e2e6ea !important;
    }
    .table tbody tr {
        cursor: pointer;
    }
    .card {
        border-radius: 0;
        border: none;
    }
    .card-body {
        padding: 0;
    }
    .table-responsive {
        margin: 0;
    }
    .header-section {
        padding: 1rem;
        background-color: #f8f9fa;
        border-bottom: 1px solid #dee2e6;
    }
    .table thead th {
        background-color: #f8f9fa;
        border-top: none;
    }
    .table td, .table th {
        padding: 0.75rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="header-section">
    <div class="row align-items-center">
        <div class="col">
            <h2 class="m-0">Employee List</h2>
        </div>
        <div class="col-auto">
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="includeInactive">
                <label class="form-check-label" for="includeInactive">
                    Include Inactive Employees
                </label>
            </div>
        </div>
        <div class="col-auto">
            <div class="btn-group">
                <button id="exportExcel" class="btn btn-success">
                    <i class="fas fa-file-excel"></i> Export to Excel
                </button>
                <button id="bulkActions" class="btn btn-secondary dropdown-toggle ms-2" data-bs-toggle="dropdown" disabled>
                    <i class="fas fa-cog"></i> Bulk Actions
                </button>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item bulk-status" data-status="active" href="#"><i class="fas fa-check-circle text-success"></i> Set Active</a></li>
                    <li><a class="dropdown-item bulk-status" data-status="inactive" href="#"><i class="fas fa-times-circle text-danger"></i> Set Inactive</a></li>
                </ul>
                <a href="{% url 'employees:employee_create' %}" class="btn btn-primary ms-2">
                    <i class="fas fa-plus"></i> Add Employee
                </a>
            </div>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <div class="table-responsive">
            <table id="employeeTable" class="table table-striped table-hover mb-0">
                <thead>
                    <tr>
                        <th>
                            <input type="checkbox" class="form-check-input" id="selectAll">
                        </th>
                        <th>Employee #</th>
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>CPR Number</th>
                        <th>PassNo</th>
                        <th>Division</th>
                        <th>Department</th>
                        <th>Designation</th>
                        <th>Joined Date</th>
                        <th>Re-joined Date</th>
                        <th>Status</th>
                        <th>CreatedOn</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for employee in employees %}
                    <tr data-employee-id="{{ employee.id }}">
                        <td>
                            <input type="checkbox" class="form-check-input row-checkbox">
                        </td>
                        <td>{{ employee.employee_number }}</td>
                        <td>{{ employee.first_name }}</td>
                        <td>{{ employee.last_name }}</td>
                        <td>{{ employee.cpr_number|default:'-' }}</td>
                        <td>{{ employee.passport_number|default:'-' }}</td>
                        <td>{{ employee.division.name|default:'-' }}</td>
                        <td>{{ employee.department.name|default:'-' }}</td>
                        <td>{{ employee.designation|default:'-' }}</td>
                        <td>{{ employee.joined_date|date:"d/m/Y"|default:'-' }}</td>
                        <td>{{ employee.rejoined_date|date:"d/m/Y"|default:'-' }}</td>
                        <td>
                            {% if employee.is_active %}
                                <span class="badge bg-success">Active</span>
                            {% else %}
                                <span class="badge bg-danger">Inactive</span>
                            {% endif %}
                        </td>
                        <td>{{ employee.created_at|date:"d/m/Y"|default:'-' }}</td>
                        <td>
                            <div class="btn-group">
                                <a href="{% url 'employees:employee_detail' employee.id %}" class="btn btn-sm btn-info">
                                    <i class="fas fa-eye"></i>
                                </a>
                                <a href="{% url 'employees:employee_update' employee.id %}" class="btn btn-sm btn-warning">
                                    <i class="fas fa-edit"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.bootstrap5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/select/1.3.4/js/dataTables.select.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>

<script>
$(document).ready(function() {
    // Initialize the checkbox state from localStorage
    var showInactive = localStorage.getItem('showInactiveEmployees') === 'true';
    $('#includeInactive').prop('checked', showInactive);

    // Custom filter for active/inactive employees
    $.fn.dataTable.ext.search.push(function(settings, data, dataIndex) {
        var showInactive = $('#includeInactive').is(':checked');
        var status = data[11]; // Status column index (adjusted for checkbox column)
        
        if (!showInactive && status.includes('Inactive')) {
            return false;
        }
        return true;
    });

    var table = $('#employeeTable').DataTable({
        dom: 'Bfrtip',
        select: false,
        buttons: [
            {
                extend: 'excel',
                text: '<i class="fas fa-file-excel"></i> Export Selected',
                exportOptions: {
                    columns: ':not(:last-child)',
                    rows: function(idx, data, node) {
                        return $(node).find('.row-checkbox').prop('checked');
                    }
                }
            }
        ],
        order: [[1, 'asc']],
        pageLength: 25,
        lengthMenu: [[10, 25, 50, -1], [10, 25, 50, "All"]]
    });

    // Apply initial filter
    table.draw();

    // Handle inactive employee toggle
    $('#includeInactive').change(function() {
        var showInactive = $(this).is(':checked');
        // Save state to localStorage
        localStorage.setItem('showInactiveEmployees', showInactive);
        table.draw();
    });

    // Handle "Select All" checkbox
    $('#selectAll').change(function() {
        var isChecked = $(this).prop('checked');
        $('.row-checkbox').prop('checked', isChecked);
        updateSelectedState();
    });

    // Handle individual row checkboxes
    $(document).on('change', '.row-checkbox', function() {
        updateSelectedState();
    });

    // Update selected state and bulk actions button
    function updateSelectedState() {
        var selectedCount = $('.row-checkbox:checked').length;
        var totalCount = $('.row-checkbox').length;
        
        // Update "Select All" checkbox
        $('#selectAll').prop('checked', selectedCount === totalCount && totalCount > 0);
        
        // Enable/disable bulk actions button
        $('#bulkActions').prop('disabled', selectedCount === 0);
        
        // Update row highlighting
        $('.row-checkbox').each(function() {
            $(this).closest('tr').toggleClass('selected', $(this).prop('checked'));
        });
    }

    // Handle bulk status change
    $('.bulk-status').click(function(e) {
        e.preventDefault();
        var status = $(this).data('status');
        var selectedIds = [];
        
        $('.row-checkbox:checked').each(function() {
            var employeeId = $(this).closest('tr').data('employee-id');
            if (employeeId) {
                selectedIds.push(employeeId);
            }
        });

        if (selectedIds.length === 0) {
            alert('Please select at least one employee');
            return;
        }

        if (confirm('Are you sure you want to change the status of ' + selectedIds.length + ' selected employee(s)?')) {
            var formData = new FormData();
            selectedIds.forEach(function(id) {
                formData.append('employee_ids[]', id);
            });
            formData.append('status', status);
            formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');

            $.ajax({
                url: '{% url "employees:bulk_status_change" %}',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    if (response.success) {
                        location.reload();
                    } else {
                        alert('Error: ' + response.error);
                    }
                },
                error: function() {
                    alert('An error occurred while updating employee status.');
                }
            });
        }
    });

    // Export to Excel button
    $('#exportExcel').click(function() {
        table.button('.buttons-excel').trigger();
    });
});
</script>
{% endblock %}

```

### ðŸ“„ hrms_project\employees\templates\employees\preview\_employee_attendance_tab.html
```<!-- Attendance information will be here -->

```

### ðŸ“„ hrms_project\employees\templates\employees\preview\_employee_bank_tab.html
```{% load static %}
<div class="tab-pane fade" id="bank" role="tabpanel">
    <div class="info-card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5><i class="fas fa-university me-2"></i>Bank Accounts</h5>
            <a href="{% url 'employees:add_bank_account' employee.pk %}" class="btn btn-primary btn-sm">
                <i class="fas fa-plus"></i> Add Bank Account
            </a>
        </div>
        <div class="card-body">
            {% if employee.bank_accounts.exists %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Bank</th>
                                <th>Account Number</th>
                                <th>IBAN</th>
                                <th>Transfer Amount</th>
                                <th>Primary</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for account in employee.bank_accounts.all %}
                            <tr>
                                <td>{{ account.bank }}</td>
                                <td>{{ account.account_number }}</td>
                                <td>{{ account.iban }}</td>
                                <td>{{ account.transfer_amount|default:"-" }}</td>
                                <td>
                                    {% if account.is_primary %}
                                        <span class="status-badge status-active">Primary</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="btn-group">
                                        <a href="{% url 'employees:edit_bank_account' employee.pk account.pk %}" class="btn btn-sm btn-info">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                        <a href="{% url 'employees:delete_bank_account' employee.pk account.pk %}" class="btn btn-sm btn-danger">
                                            <i class="fas fa-trash"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <p class="text-muted">No bank accounts added yet.</p>
            {% endif %}
        </div>
    </div>
</div>
```

### ðŸ“„ hrms_project\employees\templates\employees\preview\_employee_bond_tab.html
```<!-- Bond & Guarantee information will be here -->

```

### ðŸ“„ hrms_project\employees\templates\employees\preview\_employee_checklist_tab.html
```<!-- Checklist information will be here -->

```

### ðŸ“„ hrms_project\employees\templates\employees\preview\_employee_delete_modal.html
```<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirm Delete</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete {{ employee.get_full_name }}?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form action="{% url 'employees:employee_delete' employee.pk %}" method="post">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">Delete</button>
                </form>
            </div>
        </div>
    </div>
</div>
```

### ðŸ“„ hrms_project\employees\templates\employees\preview\_employee_documents_tab.html
```{% load static %}
<div class="tab-pane fade" id="documents" role="tabpanel">
    <div class="info-card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5><i class="fas fa-file-alt me-2"></i>Documents</h5>
            <a href="{% url 'employees:add_document' employee.id %}" class="btn btn-primary btn-sm">
                <i class="fas fa-plus"></i> Add Document
            </a>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Document Type</th>
                            <th>File</th>
                            <th>Upload Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if employee.documents.all %}
                            {% for document in employee.documents.all %}
                                <tr>
                                    <td>{{ document.get_document_type_display }}</td>
                                    <td>
                                        {% if document.document_file %}
                                            {% if document.is_image %}
                                                <img src="{{ document.document_file.url }}" alt="Document" style="height: 50px;">
                                            {% else %}
                                                <a href="{{ document.document_file.url }}" target="_blank">
                                                    <i class="fas fa-file"></i> View Document
                                                </a>
                                            {% endif %}
                                        {% else %}
                                            No file attached
                                        {% endif %}
                                    </td>
                                    <td>{{ document.created_at|date:"d/m/Y" }}</td>
                                    <td>
                                        <div class="btn-group">
                                            <a href="{% url 'employees:view_document' employee.id document.id %}"
                                               class="btn btn-sm btn-info" title="View">
                                                <i class="fas fa-eye"></i>
                                            </a>
                                            <a href="{% url 'employees:edit_document' employee.id document.id %}"
                                               class="btn btn-sm btn-warning" title="Edit">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            <a href="{% url 'employees:delete_document' employee.id document.id %}"
                                               class="btn btn-sm btn-danger" title="Delete">
                                                <i class="fas fa-trash"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="4" class="text-center">No documents found.</td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
```

### ðŸ“„ hrms_project\employees\templates\employees\preview\_employee_education_tab.html
```<!-- Education information will be here -->

```

### ðŸ“„ hrms_project\employees\templates\employees\preview\_employee_events_tab.html
```<!-- Life Events information will be here -->

```

### ðŸ“„ hrms_project\employees\templates\employees\preview\_employee_general_tab.html
```{% load static %}
<div class="tab-pane fade show active" id="general" role="tabpanel">
    <div class="info-card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0"><i class="fas fa-user me-2"></i>Employee Information</h5>
            <div class="status-badge {% if employee.is_active %}status-active{% else %}status-inactive{% endif %}">
                {{ employee.is_active|yesno:"Active,Inactive" }}
            </div>
        </div>
        <div class="card-body">
            <!-- Basic Information -->
            <div class="info-section mb-4">
                <div class="section-title">Basic Information</div>
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="info-item">
                            <label>Employee Number</label>
                            <div class="value">{{ employee.employee_number }}</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="info-item">
                            <label>Profile Picture</label>
                            <div class="value">
                                {% if employee.profile_picture %}
                                    <img src="{{ employee.profile_picture.url }}" alt="Profile Picture" class="img-thumbnail" style="max-width: 150px;">
                                {% else %}
                                    <span class="text-muted">No profile picture</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Personal Information (English) -->
            <div class="info-section mb-4">
                <div class="section-title">Personal Information (English)</div>
                <div class="row g-3">
                    <div class="col-md-4">
                        <div class="info-item">
                            <label>First Name</label>
                            <div class="value">{{ employee.first_name }}</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="info-item">
                            <label>Middle Name</label>
                            <div class="value">{{ employee.middle_name|default:"-" }}</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="info-item">
                            <label>Last Name</label>
                            <div class="value">{{ employee.last_name }}</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Personal Information (Arabic) -->
            <div class="info-section mb-4">
                <div class="section-title">Personal Information (Arabic)</div>
                <div class="row g-3">
                    <div class="col-md-4">
                        <div class="info-item">
                            <label>First Name (Arabic)</label>
                            <div class="value">{{ employee.first_name_ar|default:"-" }}</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="info-item">
                            <label>Middle Name (Arabic)</label>
                            <div class="value">{{ employee.middle_name_ar|default:"-" }}</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="info-item">
                            <label>Last Name (Arabic)</label>
                            <div class="value">{{ employee.last_name_ar|default:"-" }}</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Demographics -->
            <div class="info-section mb-4">
                <div class="section-title">Demographics</div>
                <div class="row g-3">
                    <div class="col-md-4">
                        <div class="info-item">
                            <label>Date of Birth</label>
                            <div class="value">{{ employee.date_of_birth|date:"d/m/Y"|default:"-" }}</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="info-item">
                            <label>Gender</label>
                            <div class="value">{{ employee.get_gender_display|default:"-" }}</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="info-item">
                            <label>Marital Status</label>
                            <div class="value">{{ employee.get_marital_status_display|default:"-" }}</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="info-item">
                            <label>Nationality</label>
                            <div class="value">{{ employee.get_nationality_display|default:"-" }}</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="info-item">
                            <label>Religion</label>
                            <div class="value">{{ employee.religion|default:"-" }}</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="info-item">
                            <label>Education Category</label>
                            <div class="value">{{ employee.education_category|default:"-" }}</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contact & Identification -->
            <div class="info-section mb-4">
                <div class="section-title">Contact & Identification</div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="info-item">
                            <label>Email:</label>
                            <span>{{ employee.email|default:'-' }}</span>
                        </div>
                        <div class="info-item">
                            <label>Primary Number:</label>
                            <span>{{ employee.primary_phone|default:'-' }}</span>
                        </div>
                        <div class="info-item">
                            <label>Secondary Number:</label>
                            <span>{{ employee.secondary_phone|default:'-' }}</span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="info-item">
                            <label>CPR Number:</label>
                            <span>{{ employee.cpr_number|default:'-' }}</span>
                        </div>
                        <div class="info-item">
                            <label>Address:</label>
                            <span>{{ employee.address|default:'-' }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <h5 class="mb-0"><i class="fas fa-user me-2"></i>Employment Information</h5>

            <!-- Employment Information -->
            <div class="info-section mb-4">
                <div class="section-title">Position Details</div>
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="info-item">
                            <label>Designation</label>
                            <div class="value">{{ employee.designation|default:"-" }}</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="info-item">
                            <label>Employee Category</label>
                            <div class="value">{{ employee.get_employee_category_display|default:"-" }}</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Department & Location -->
            <div class="info-section mb-4">
                <div class="section-title">Department & Location</div>
                <div class="row g-3">
                    <div class="col-md-4">
                        <div class="info-item">
                            <label>Division</label>
                            <div class="value">{{ employee.division|default:"-" }}</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="info-item">
                            <label>Department</label>
                            <div class="value">{{ employee.department|default:"-" }}</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="info-item">
                            <label>Location</label>
                            <div class="value">{{ employee.location|default:"-" }}</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contract Information -->
            <div class="info-section mb-4">
                <div class="section-title">Contract Information</div>
                <div class="row g-3">
                    <div class="col-md-4">
                        <div class="info-item">
                            <label>Contract Type</label>
                            <div class="value">{{ employee.get_contract_type_display|default:"-" }}</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="info-item">
                            <label>Joined Date</label>
                            <div class="value">{{ employee.joined_date|date:"d/m/Y"|default:"-" }}</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="info-item">
                            <label>Probation Status</label>
                            <div class="value">{{ employee.in_probation|yesno:"Yes,No" }}</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Financial Centers -->
            <div class="info-section">
                <div class="section-title">Financial Centers</div>
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="info-item">
                            <label>Cost Center</label>
                            <div class="value">{{ employee.cost_center|default:"-" }}</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="info-item">
                            <label>Profit Center</label>
                            <div class="value">{{ employee.profit_center|default:"-" }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
```

### ðŸ“„ hrms_project\employees\templates\employees\preview\_employee_offences_tab.html
```{% load static %}

<link rel="stylesheet" href="{% static 'employees/css/offences.css' %}">

<!-- Add this style to fix z-index issues -->
<style>
    .select2-container--open {
        z-index: 9999 !important; /* Increased z-index and !important */
    }

    .select2-dropdown {
        z-index: 9999 !important; /* Increased z-index and !important for dropdown itself */
    }
</style>

<!-- Offences information will be here -->
<div class="tab-pane fade" id="offences" role="tabpanel">
    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Employee Offences</h5>
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addOffenceModal">
                <i class="fas fa-plus"></i> Add Offence
            </button>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover" id="offencesTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Rule</th>
                            <th>Penalty</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for offence in employee.employee_offence_records.all %}
                        <tr data-offence-id="{{ offence.id }}" class="{% if not offence.is_active %}table-secondary{% endif %}">
                            <td>{{ offence.offense_date|date:"d/m/Y" }}</td>
                            <td>{{ offence.rule.name }}</td>
                            <td>
                                {{ offence.get_applied_penalty_display }}
                                {% if offence.monetary_amount %}
                                <br>
                                <small class="text-muted">
                                    Amount: {{ offence.monetary_amount }} BHD
                                    {% if offence.is_active %}
                                    (Remaining: {{ offence.remaining_amount }} BHD)
                                    {% endif %}
                                </small>
                                {% endif %}
                            </td>
                            <td>
                                {% if offence.is_active %}
                                    {% if offence.is_acknowledged %}
                                    <span class="badge bg-success">Acknowledged</span>
                                    {% else %}
                                    <span class="badge bg-warning">Pending</span>
                                    {% endif %}
                                {% else %}
                                    <span class="badge bg-secondary">Inactive</span>
                                {% endif %}
                            </td>
                            <td>
                                <button type="button" class="btn btn-sm btn-info view-offence" data-offence-id="{{ offence.id }}" title="View Details">
                                    <i class="fas fa-eye"></i>
                                </button>
                                {% if offence.is_active %}
                                <button type="button" class="btn btn-sm btn-primary add-document" data-offence-id="{{ offence.id }}" title="Add Document">
                                    <i class="fas fa-file-upload"></i>
                                </button>
                                {% endif %}
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="text-center">No offences found</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Add Offence Modal -->
    <div class="modal fade" id="addOffenceModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Offence</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="alerts-container"></div>
                    <form id="addOffenceForm">
                        {% csrf_token %}
                        <div class="row mb-3">
                            <div class="col-12 mb-3">
                                <label class="form-label">Search Offense Rule</label>
                                <select class="form-select" id="offenseSearch" style="width: 100%">
                                    <option value="">Search for offense rule...</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Offense Group</label>
                                <select class="form-select" id="offenceGroup" name="group" required>
                                    <option value="">Select Group</option>
                                    {% for group, label in offense_groups %}
                                    <option value="{{ group }}">{{ label }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Offense Rule</label>
                                <select class="form-select" id="offenceRule" name="rule" required>
                                    <option value="">Select Rule</option>
                                </select>
                            </div>
                            <div class="col-12" id="ruleDescription" style="display: none;">
                                <div class="alert alert-info">
                                    <strong>Description:</strong>
                                    <span id="ruleDescriptionText"></span>
                                </div>
                            </div>
                            <div class="col-12" id="previousOffenses" style="display: none;">
                                <div class="alert alert-warning">
                                    <strong>Offense History for <span id="offenseYear">2025</span>:</strong>
                                    <div id="previousOffensesList" class="mt-2"></div>
                                    <div class="mt-2">
                                        <strong>Suggested Penalty:</strong>
                                        <span id="suggestedPenalty" class="text-danger"></span>
                                        <small class="d-block text-muted mt-1">
                                            This will be offense #<span id="offenseCount">0</span> for this rule this year.
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Offense Date</label>
                                <input type="date" class="form-control" id="offenseDate" name="offense_date" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Applied Penalty</label>
                                <select class="form-select" id="appliedPenalty" name="applied_penalty" required>
                                    <option value="">Select Penalty</option>
                                    {% for code, label in penalty_choices %}
                                    <option value="{{ code }}">{{ label }}</option>
                                    {% endfor %}
                                </select>
                                <small class="form-text text-muted" id="penaltyNote" style="display: none;">
                                    This penalty differs from the suggested penalty based on the offense count.
                                </small>
                            </div>
                        </div>
                        <div id="monetaryPenaltySection" class="mb-3" style="display: none;">
                            <div class="row">
                                <div class="col-md-6">
                                    <label class="form-label">Monetary Penalty Amount</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="monetaryAmount" name="monetary_amount" step="0.01" min="0">
                                        <span class="input-group-text">BHD</span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Monthly Deduction Amount</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="monthlyDeduction" name="monthly_deduction" step="0.01" min="0">
                                        <span class="input-group-text">BHD</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Details</label>
                            <textarea class="form-control" name="details" rows="3" required></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveOffenceBtn">Save Offence</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Offence Modal -->
        <div class="modal fade" id="viewOffenceModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Offense Details</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <strong>Rule ID:</strong>
                            <span id="viewRuleId"></span>
                        </div>
                        <div class="mb-3">
                            <strong>Rule Name:</strong>
                            <span id="viewRuleName"></span>
                        </div>
                        <div class="mb-3">
                            <strong>Group:</strong>
                            <span id="viewGroup"></span>
                        </div>
                        <div class="mb-3">
                            <strong>Description:</strong>
                            <span id="viewDescription"></span>
                        </div>
                        <div class="mb-3">
                            <strong>Date:</strong>
                            <span id="viewDate"></span>
                        </div>
                        <div class="mb-3">
                            <strong>Original Penalty:</strong>
                            <span id="viewOriginalPenalty"></span>
                        </div>
                        <div class="mb-3">
                            <strong>Applied Penalty:</strong>
                            <span id="viewAppliedPenalty"></span>
                        </div>
                        <div class="mb-3">
                            <strong>Status:</strong>
                            <span id="viewStatus"></span>
                        </div>
                        <div class="mb-3" id="viewPreviousOffenses" style="display: none;">
                            <div class="alert alert-info">
                                <strong>Offense History:</strong>
                                <div id="viewPreviousOffensesList"></div>
                            </div>
                        </div>
                        <div class="mb-3" id="viewDocuments">
                            <strong>Documents:</strong>
                            <div id="viewDocumentsList"></div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-danger" id="cancelOffenceBtn">Cancel Offense</button>
                    </div>
                </div>
            </div>
        </div>

    <!-- Add Document Modal -->
    <div class="modal fade" id="addDocumentModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Document</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addDocumentForm">
                        {% csrf_token %}
                        <input type="hidden" name="offense_id" id="documentOffenseId">
                        <div class="mb-3">
                            <label class="form-label">Document Type</label>
                            <input type="text" class="form-control" name="document_type" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Document</label>
                            <input type="file" class="form-control" name="document" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Notes</label>
                            <textarea class="form-control" name="notes" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveDocumentBtn">Save Document</button>
                </div>
            </div>
        </div>
    </div>
</div>

```

### ðŸ“„ hrms_project\employees\templates\employees\preview\_employee_salary_tab.html
```<div class="tab-pane fade" id="salary" role="tabpanel">
    <div class="card info-card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Current Salary Details</h5>
            {% if perms.employees.add_salarydetail %}
            <a href="{% url 'employees:add_salary' employee.id %}" class="btn btn-primary btn-sm">
                <i class="fas fa-plus me-1"></i>Add New
            </a>
            {% endif %}
        </div>
        <div class="card-body">
            {% if employee.salary_details.exists %}
                {% with current_salary=employee.salary_details.filter.first %}
                <div class="row">
                    <div class="col-md-6">
                        <div class="info-item mb-3">
                            <label>Basic Salary</label>
                            <div class="value">{{ current_salary.basic_salary }} {{ current_salary.currency }}</div>
                        </div>
                        <div class="info-item mb-3">
                            <label>Housing Allowance</label>
                            <div class="value">{{ current_salary.housing_allowance }} {{ current_salary.currency }}</div>
                        </div>
                        <div class="info-item mb-3">
                            <label>Transportation Allowance</label>
                            <div class="value">{{ current_salary.transportation_allowance }} {{ current_salary.currency }}</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        {% if current_salary.other_allowances %}
                        <div class="info-item mb-3">
                            <label>Other Allowances</label>
                            <div class="value">
                                {% for name, amount in current_salary.other_allowances.items %}
                                <div>{{ name }}: {{ amount }} {{ current_salary.currency }}</div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                        <div class="info-item mb-3">
                            <label>Total Salary</label>
                            <div class="value fw-bold text-primary">{{ current_salary.total_salary }} {{ current_salary.currency }}</div>
                        </div>
                        <div class="info-item mb-3">
                            <label>Effective From</label>
                            <div class="value">{{ current_salary.effective_from|date:"d M Y" }}</div>
                        </div>
                    </div>
                </div>
                {% if current_salary.notes %}
                <div class="mt-3">
                    <label class="text-muted">Notes:</label>
                    <p class="mb-0">{{ current_salary.notes }}</p>
                </div>
                {% endif %}
                {% endwith %}
            {% else %}
                <div class="text-center text-muted py-4">
                    <i class="fas fa-info-circle fa-2x mb-2"></i>
                    <p class="mb-0">No salary details available.</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Salary History -->
    <div class="card info-card mb-4">
        <div class="card-header">
            <h5 class="mb-0">Salary Revision History</h5>
        </div>
        <div class="card-body">
            {% if employee.salary_revisions.exists %}
            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Type</th>
                            <th>Previous</th>
                            <th>New</th>
                            <th>Change</th>
                            <th>Reference</th>
                            {% if perms.employees.view_salaryrevision %}
                            <th>Actions</th>
                            {% endif %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for revision in employee.salary_revisions.all %}
                        <tr>
                            <td>{{ revision.revision_date|date:"d M Y" }}</td>
                            <td>{{ revision.get_revision_type_display }}</td>
                            <td>{{ revision.previous_salary.total_salary }} {{ revision.previous_salary.currency }}</td>
                            <td>{{ revision.new_salary.total_salary }} {{ revision.new_salary.currency }}</td>
                            <td>
                                <span class="{% if revision.difference > 0 %}text-success{% else %}text-danger{% endif %}">
                                    {{ revision.difference|floatformat:3 }} ({{ revision.percentage_change|floatformat:1 }}%)
                                </span>
                            </td>
                            <td>{{ revision.reference_number|default:"-" }}</td>
                            {% if perms.employees.view_salaryrevision %}
                            <td>
                                <button class="btn btn-sm btn-outline-primary" title="View Details"
                                    data-bs-toggle="modal" data-bs-target="#revisionModal{{ revision.id }}">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </td>
                            {% endif %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center text-muted py-4">
                <i class="fas fa-history fa-2x mb-2"></i>
                <p class="mb-0">No salary revisions found.</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Certificates -->
    <div class="card info-card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Salary Certificates</h5>
            {% if perms.employees.add_salarycertificate %}
            <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#newCertificateModal">
                <i class="fas fa-plus me-1"></i>Request New
            </button>
            {% endif %}
        </div>
        <div class="card-body">
            {% if employee.salary_certificates.exists %}
            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead>
                        <tr>
                            <th>Certificate No.</th>
                            <th>Issued Date</th>
                            <th>Purpose</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for cert in employee.salary_certificates.all %}
                        <tr>
                            <td>{{ cert.certificate_number }}</td>
                            <td>{{ cert.issued_date|date:"d M Y" }}</td>
                            <td>{{ cert.purpose }}</td>
                            <td>
                                <span class="badge {% if cert.is_valid %}bg-success{% else %}bg-danger{% endif %}">
                                    {{ cert.is_valid|yesno:"Valid,Invalid" }}
                                </span>
                            </td>
                            <td>
                                <div class="btn-group">
                                    <button class="btn btn-sm btn-outline-primary" title="Download">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    {% if perms.employees.change_salarycertificate %}
                                    <button class="btn btn-sm btn-outline-secondary" title="Edit">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center text-muted py-4">
                <i class="fas fa-certificate fa-2x mb-2"></i>
                <p class="mb-0">No certificates issued yet.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- New Certificate Modal -->
<div class="modal fade" id="newCertificateModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Request Salary Certificate</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form id="newCertificateForm" method="post" action="{% url 'employees:request_certificate' employee.id %}">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="form-group mb-3">
                        <label class="form-label">Purpose *</label>
                        <input type="text" name="purpose" class="form-control" required
                               placeholder="e.g., Bank Loan, Visa Application">
                    </div>
                    <div class="form-group mb-3">
                        <label class="form-label">Expiry Date</label>
                        <input type="date" name="expiry_date" class="form-control">
                        <small class="form-text text-muted">Optional. Leave blank if certificate should not expire.</small>
                    </div>
                    
                    <!-- Current Salary Information (Read-only) -->
                    {% if employee.salary_details.exists %}
                    {% with current_salary=employee.salary_details.first %}
                    <div class="alert alert-info mb-0">
                        <h6 class="alert-heading mb-2">Current Salary Information</h6>
                        <div class="row">
                            <div class="col-md-4">
                                <small class="d-block text-muted">Basic Salary:</small>
                                <strong>{{ current_salary.basic_salary }} {{ current_salary.currency }}</strong>
                            </div>
                            <div class="col-md-4">
                                <small class="d-block text-muted">Total Allowances:</small>
                                <strong>{{ current_salary.housing_allowance|add:current_salary.transportation_allowance }} {{ current_salary.currency }}</strong>
                            </div>
                            <div class="col-md-4">
                                <small class="d-block text-muted">Total Salary:</small>
                                <strong>{{ current_salary.total_salary }} {{ current_salary.currency }}</strong>
                            </div>
                        </div>
                    </div>
                    {% endwith %}
                    {% else %}
                    <div class="alert alert-warning mb-0">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        No active salary details found. Please add salary details before requesting a certificate.
                    </div>
                    {% endif %}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Request</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Revision Detail Modals -->
{% for revision in employee.salary_revisions.all %}
<div class="modal fade" id="revisionModal{{ revision.id }}" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Salary Revision Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="mb-3">Previous Salary</h6>
                        <div class="info-item mb-2">
                            <label>Basic Salary</label>
                            <div class="value">{{ revision.previous_salary.basic_salary }}</div>
                        </div>
                        <div class="info-item mb-2">
                            <label>Total Allowances</label>
                            <div class="value">
                                {{ revision.previous_salary.housing_allowance|add:revision.previous_salary.transportation_allowance }}
                            </div>
                        </div>
                        <div class="info-item mb-2">
                            <label>Total Salary</label>
                            <div class="value">{{ revision.previous_salary.total_salary }}</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h6 class="mb-3">New Salary</h6>
                        <div class="info-item mb-2">
                            <label>Basic Salary</label>
                            <div class="value">{{ revision.new_salary.basic_salary }}</div>
                        <div class="info-item mb-2">
                            <label>Total Allowances</label>
                            <div class="value">
                                {{ revision.new_salary.housing_allowance|add:revision.new_salary.transportation_allowance }}
                            </div>
                        </div>
                        <div class="info-item mb-2">
                            <label>Total Salary</label>
                            <div class="value">{{ revision.new_salary.total_salary }}</div>
                        </div>
                    </div>
                </div>
                <hr>
                <div class="info-item mb-2">
                    <label>Reason for Revision</label>
                    <div class="value">{{ revision.reason }}</div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="info-item mb-2">
                            <label>Approved By</label>
                            <div class="value">{{ revision.approved_by.get_full_name }}</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="info-item mb-2">
                            <label>Reference Number</label>
                            <div class="value">{{ revision.reference_number|default:"-" }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endfor %}

```

### ðŸ“„ hrms_project\employees\templates\employees\preview\assets_in_hand\_employee_assets_tab.html
```{% load static %}

{% block content %}
<div class="tab-pane fade" id="assets" role="tabpanel">
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">{{ employee.get_full_name }}'s Assets</h3>
            <div class="card-tools">
                <div class="btn-group me-2">
                    <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addAssetTypeModal">
                        <i class="fas fa-plus-circle"></i> Add Asset Type
                    </button>
                    <button type="button" class="btn btn-info" data-bs-toggle="modal" data-bs-target="#manageAssetTypesModal">
                        <i class="fas fa-cog"></i> Manage Types
                    </button>
                </div>
                <button type="button" class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#addAssetsModal">
                    <i class="fas fa-plus"></i> Add Assets
                </button>
                <button type="button" class="btn btn-warning" id="bulkReturnBtn" style="display: none;">
                    <i class="fas fa-undo"></i> Return Selected
                </button>
            </div>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered table-hover" id="assetsTable">
                    <thead>
                        <tr>
                            <th>
                                <input type="checkbox" id="selectAll" class="form-check-input">
                            </th>
                            <th>Asset Type</th>
                            <th>Asset Name</th>
                            <th>Asset Number</th>
                            <th>Issue Date</th>
                            <th>Return Date</th>
                            <th>Condition</th>
                            <th>Value</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for asset in employee.assets.all %}
                        <tr data-asset-id="{{ asset.id }}">
                            <td>
                                <input type="checkbox" class="form-check-input asset-select" {% if asset.return_date %}disabled{% endif %}>
                            </td>
                            <td>{{ asset.asset_type.name }}</td>
                            <td>{{ asset.asset_name }}</td>
                            <td>{{ asset.asset_number }}</td>
                            <td>{{ asset.issue_date|date:"Y-m-d" }}</td>
                            <td>{{ asset.return_date|date:"Y-m-d"|default:"-" }}</td>
                            <td>{{ asset.condition }}</td>
                            <td>{{ asset.value }}</td>
                            <td>
                                <span class="badge {% if asset.return_date %}bg-success{% else %}bg-warning{% endif %}">
                                    {% if asset.return_date %}Returned{% else %}In Hand{% endif %}
                                </span>
                            </td>
                            <td>
                                <button type="button" class="btn btn-sm btn-info view-asset" data-asset-id="{{ asset.id }}">
                                    <i class="fas fa-eye"></i>
                                </button>
                                {% if not asset.return_date %}
                                <button type="button" class="btn btn-sm btn-success return-asset" data-asset-id="{{ asset.id }}">
                                    <i class="fas fa-undo"></i>
                                </button>
                                {% endif %}
                                <button type="button" class="btn btn-sm btn-danger delete-asset" data-asset-id="{{ asset.id }}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="10" class="text-center">No assets found</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- View Asset Details Modal -->
<div class="modal fade" id="viewAssetModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Asset Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row mb-3">
                    <div class="col-sm-4"><strong>Asset Type:</strong></div>
                    <div class="col-sm-8" id="viewAssetType"></div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-4"><strong>Asset Name:</strong></div>
                    <div class="col-sm-8" id="viewAssetName"></div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-4"><strong>Asset Number:</strong></div>
                    <div class="col-sm-8" id="viewAssetNumber"></div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-4"><strong>Issue Date:</strong></div>
                    <div class="col-sm-8" id="viewIssueDate"></div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-4"><strong>Condition:</strong></div>
                    <div class="col-sm-8" id="viewCondition"></div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-4"><strong>Value:</strong></div>
                    <div class="col-sm-8" id="viewValue"></div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-4"><strong>Notes:</strong></div>
                    <div class="col-sm-8" id="viewNotes"></div>
                </div>
                <div id="returnDetailsSection" style="display: none;">
                    <hr>
                    <h6 class="mb-3">Return Details</h6>
                    <div class="row mb-3">
                        <div class="col-sm-4"><strong>Return Date:</strong></div>
                        <div class="col-sm-8" id="viewReturnDate"></div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-sm-4"><strong>Return Condition:</strong></div>
                        <div class="col-sm-8" id="viewReturnCondition"></div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-sm-4"><strong>Return Notes:</strong></div>
                        <div class="col-sm-8" id="viewReturnNotes"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<!-- Add Assets Modal -->
<div class="modal fade" id="addAssetsModal" tabindex="-1" aria-labelledby="addAssetsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addAssetsModalLabel">Add Assets</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addAssetsForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Asset Types</label>
                                <select class="form-select" name="asset_type" multiple size="5" required>
                                    {% for type in asset_types %}
                                    <option value="{{ type.id }}">{{ type.name }}</option>
                                    {% endfor %}
                                </select>
                                <small class="text-muted">Hold Ctrl/Cmd to select multiple types</small>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Starting Asset Number</label>
                                <input type="text" class="form-control" name="asset_number" required>
                                <small class="text-muted">Numbers will be auto-incremented (e.g., LAP001, LAP002)</small>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Quantity per Type</label>
                                <input type="number" class="form-control" name="quantity" min="1" value="1" required>
                                <small class="text-muted">This quantity will be applied to each selected type</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Issue Date</label>
                                <input type="date" class="form-control" name="issue_date" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Condition</label>
                                <textarea class="form-control" name="condition" required></textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Value</label>
                                <input type="number" step="0.01" class="form-control" name="value" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Notes</label>
                                <textarea class="form-control" name="notes"></textarea>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="saveAssetsBtn">Save Assets</button>
            </div>
        </div>
    </div>
</div>

<!-- Add Asset Type Modal -->
<div class="modal fade" id="addAssetTypeModal" tabindex="-1" aria-labelledby="addAssetTypeModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addAssetTypeModalLabel">Add New Asset Type</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addAssetTypeForm">
                    <div class="mb-3">
                        <label class="form-label">Type Name</label>
                        <input type="text" class="form-control" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Description</label>
                        <textarea class="form-control" name="description"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="saveAssetTypeBtn">Save Type</button>
            </div>
        </div>
    </div>
</div>

<!-- Manage Asset Types Modal -->
<div class="modal fade" id="manageAssetTypesModal" tabindex="-1" aria-labelledby="manageAssetTypesModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="manageAssetTypesModalLabel">Manage Asset Types</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="table-responsive">
                    <table class="table table-bordered table-hover" id="assetTypesTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Description</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for type in asset_types %}
                            <tr data-type-id="{{ type.id }}">
                                <td>{{ type.name }}</td>
                                <td>{{ type.description|default:"-" }}</td>
                                <td>
                                    <button type="button" class="btn btn-sm btn-danger delete-type" data-type-id="{{ type.id }}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- View/Edit Asset Modal -->
<div class="modal fade" id="viewAssetModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Asset Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <!-- Asset details will be loaded dynamically -->
            </div>
        </div>
    </div>
</div>

<!-- Return Asset Modal -->
<div class="modal fade" id="returnAssetModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Return Asset(s)</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="returnAssetForm">
                    <input type="hidden" name="asset_ids" id="returnAssetIds">
                    <div class="mb-3">
                        <label for="returnDate" class="form-label">Return Date</label>
                        <input type="date" class="form-control" id="returnDate" name="return_date" required>
                    </div>
                    <div class="mb-3">
                        <label for="returnCondition" class="form-label">Return Condition</label>
                        <select class="form-select" id="returnCondition" name="return_condition" required>
                            <option value="">Select condition...</option>
                            <option value="Excellent">Excellent</option>
                            <option value="Good">Good</option>
                            <option value="Fair">Fair</option>
                            <option value="Poor">Poor</option>
                            <option value="Damaged">Damaged</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="returnNotes" class="form-label">Return Notes</label>
                        <textarea class="form-control" id="returnNotes" name="return_notes" rows="3" 
                            placeholder="Add any notes about the condition or return of the asset(s)"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="confirmReturnAsset">Return Asset(s)</button>
            </div>
        </div>
    </div>
</div>





{% endblock %}

{% block extra_js %}
<script src="{% static 'employees/js/assets.js' %}"></script>
{% endblock %}

```

### ðŸ“„ hrms_project\employees\templates\employees\preview\bank\bank_account_confirm_delete.html
```{% extends "employees/base.html" %}

{% block title %}Delete Bank Account - {{ employee.get_full_name }}{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row mb-4">
        <div class="col">
            <h2>Delete Bank Account - {{ employee.get_full_name }}</h2>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="card">
                <div class="card-body">
                    <p>Are you sure you want to delete the following bank account?</p>
                    <ul class="list-unstyled">
                        <li><strong>Bank:</strong> {{ bank_account.bank }}</li>
                        <li><strong>Account Number:</strong> {{ bank_account.account_number }}</li>
                        <li><strong>IBAN:</strong> {{ bank_account.iban }}</li>
                        <li><strong>Transfer Amount:</strong> {{ bank_account.transfer_amount }}</li>
                        {% if bank_account.is_primary %}
                            <li><strong>Primary Account:</strong> Yes</li>
                        {% endif %}
                    </ul>
                    <form method="post">
                        {% csrf_token %}
                        <div class="mt-3">
                            <a href="{% url 'employees:employee_detail' employee.pk %}" class="btn btn-secondary">Cancel</a>
                            <button type="submit" class="btn btn-danger">Delete Bank Account</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

```

### ðŸ“„ hrms_project\employees\templates\employees\preview\bank\bank_account_form.html
```{% extends "employees/base.html" %}
{% load crispy_forms_tags %}

{% block title %}{{ title }} - {{ employee.get_full_name }}{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row mb-4">
        <div class="col">
            <h2>{{ title }} - {{ employee.get_full_name }}</h2>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="card">
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        {{ form|crispy }}
                        <div class="mt-3">
                            <a href="{% url 'employees:employee_detail' employee.pk %}" class="btn btn-secondary">Cancel</a>
                            <button type="submit" class="btn btn-primary">Save Bank Account</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

```

### ðŸ“„ hrms_project\employees\templates\employees\preview\dependents\_employee_dependents_tab.html
```<!-- Dependents Tab Content -->
<div class="tab-pane fade" id="dependents" role="tabpanel">
    <div class="info-card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5><i class="fas fa-users me-2"></i>Dependents</h5>
            <a href="{% url 'employees:add_dependent' employee.id %}" class="btn btn-primary btn-sm">
                <i class="fas fa-plus"></i> Add Dependent
            </a>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover" id="dependentsTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Relation</th>
                            <th>Date of Birth</th>
                            <th>Passport Number</th>
                            <th>Passport Expiry</th>
                            <th>CPR Number</th>
                            <th>CPR Expiry</th>
                            <th>Valid Passage</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for dependent in employee.dependents.all %}
                        <tr>
                            <td>{{ dependent.name }}</td>
                            <td>{{ dependent.get_relation_display }}</td>
                            <td>{{ dependent.date_of_birth|date:"Y-m-d" }}</td>
                            <td>{{ dependent.passport_number|default:"-" }}</td>
                            <td>{{ dependent.passport_expiry|date:"Y-m-d"|default:"-" }}</td>
                            <td>{{ dependent.cpr_number|default:"-" }}</td>
                            <td>{{ dependent.cpr_expiry|date:"Y-m-d"|default:"-" }}</td>
                            <td>{% if dependent.valid_passage %}Yes{% else %}No{% endif %}</td>
                            <td>
                                <div class="btn-group">
                                    <a href="{% url 'employees:dependent_documents' employee.id dependent.id %}" class="btn btn-info btn-sm">
                                        <i class="fas fa-file"></i>
                                    </a>
                                    <a href="{% url 'employees:edit_dependent' employee.id dependent.id %}" class="btn btn-warning btn-sm">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <button type="button" class="btn btn-danger btn-sm" onclick="deleteDependent({{ dependent.id }})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="9" class="text-center">No dependents found</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Document Modal -->
<div class="modal fade" id="documentModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div id="documentModalContent"></div>
    </div>
</div>

{% block extra_js %}
<script>
let currentDependentId = null;

// Function to generate document filename
function generateDocumentFilename() {
    const employeeNumber = "{{ employee.employee_number }}";
    const fullName = "{{ employee.get_full_name }}".replace(/\s+/g, '_');
    const documentType = document.getElementById('id_document_type').options[document.getElementById('id_document_type').selectedIndex].text;
    const documentNumber = document.getElementById('id_document_number').value;
    
    return `${employeeNumber}_${fullName}_${documentType}_${documentNumber}.pdf`;
}

function deleteDependent(dependentId) {
    if (confirm('Are you sure you want to delete this dependent?')) {
        $.post(`{% url 'employees:delete_dependent' employee.id 0 %}`.replace('0', dependentId), {
            csrfmiddlewaretoken: '{{ csrf_token }}'
        }, function(response) {
            if (response.status === 'success') {
                location.reload();
                showToast('Success', response.message, 'success');
            } else {
                showToast('Error', response.message, 'error');
            }
        });
    }
}
</script>
{% endblock %}
```

### ðŸ“„ hrms_project\employees\templates\employees\preview\dependents\dependent_document_form.html
```{% extends "employees/base.html" %}

{% load static %}
{% load crispy_forms_tags %}

{% block extra_css %}
<style>
    .method-button {
        padding: 10px 20px;
        margin: 5px;
        border: 1px solid #ddd;
        cursor: pointer;
    }
    .method-button.active {
        background-color: #007bff;
        color: white;
    }
    .upload-content, .scan-content, .scan-preview {
        margin-top: 20px;
    }
    .preview-images {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 10px;
    }
    .preview-image-container {
        position: relative;
        max-width: 150px;
    }
    .preview-image-container img {
        width: 100%;
        height: auto;
        cursor: pointer;
    }
    .page-number {
        position: absolute;
        top: 5px;
        left: 5px;
        background: rgba(0,0,0,0.7);
        color: white;
        padding: 2px 5px;
        font-size: 12px;
    }
    .document-field {
        display: none;
    }
    .document-field.show {
        display: block;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">{% if document %}Edit{% else %}Add{% endif %} Document for {{ dependent.name }}</h3>
                    <div class="card-tools">
                        <a href="{% url 'employees:dependent_documents' employee.id dependent.id %}" class="btn btn-secondary btn-sm">
                            <i class="fas fa-arrow-left"></i> Back to Documents
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <form method="post" enctype="multipart/form-data" id="documentForm">
                        {% csrf_token %}
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="document_type">Document Type</label>
                                    <select class="form-control" id="document_type" name="document_type" required onchange="toggleDocumentFields()">
                                        <option value="">Select Document Type</option>
                                        <option value="PASSPORT">Passport</option>
                                        <option value="CPR">CPR</option>
                                        <option value="BIRTH_CERTIFICATE">Birth Certificate</option>
                                        <option value="MARRIAGE_CERTIFICATE">Marriage Certificate</option>
                                        <option value="OTHER">Other</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="name">Document Name</label>
                                    <input type="text" class="form-control" id="name" name="name" required>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="document_number">Document Number</label>
                                    <input type="text" class="form-control" id="document_number" name="document_number">
                                </div>
                            </div>
                        </div>

                        <!-- Dynamic fields based on document type -->
                        <div class="row mb-3">
                            <!-- Issue Date - for Passport -->
                            <div class="col-md-6 document-field" data-document-types="PASSPORT">
                                <div class="form-group">
                                    <label for="issue_date">Issue Date</label>
                                    <input type="date" class="form-control" id="issue_date" name="issue_date">
                                </div>
                            </div>

                            <!-- Expiry Date - for Passport and CPR -->
                            <div class="col-md-6 document-field" data-document-types="PASSPORT,CPR">
                                <div class="form-group">
                                    <label for="expiry_date">Expiry Date</label>
                                    <input type="date" class="form-control" id="expiry_date" name="expiry_date">
                                </div>
                            </div>

                            <!-- Nationality - for Passport and CPR -->
                            <div class="col-md-6 document-field" data-document-types="PASSPORT,CPR">
                                <div class="form-group">
                                    <label for="nationality">Nationality</label>
                                    <select class="form-control" id="nationality" name="nationality">
                                        <option value="">Select Nationality</option>
                                        {% for code, name in nationality_choices %}
                                            <option value="{{ code }}">{{ name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Method Selection -->
                        <div class="btn-group mb-4" role="group" aria-label="Document upload method">
                            <button type="button" class="btn btn-outline-primary method-button active" onclick="selectMethod('upload')">
                                <i class="fas fa-upload"></i> Upload File
                            </button>
                            <button type="button" class="btn btn-outline-primary method-button" onclick="selectMethod('scan')">
                                <i class="fas fa-scanner"></i> Scan Document
                            </button>
                        </div>

                        <!-- Upload Content -->
                        <div class="upload-content">
                            <div class="form-group">
                                <label for="document_file">Upload Document</label>
                                <input type="file" class="form-control-file" id="document_file" name="document_file" accept=".pdf,.jpg,.jpeg,.png">
                            </div>
                        </div>

                        <!-- Scan Content -->
                        <div class="scan-content" style="display: none;">
                            <div class="form-group">
                                <label>Scan Mode</label>
                                <div class="form-check">
                                    <input type="radio" id="singleSide" name="scanMode" value="single" class="form-check-input" checked>
                                    <label class="form-check-label" for="singleSide">Single Side</label>
                                </div>
                                <div class="form-check">
                                    <input type="radio" id="doubleSide" name="scanMode" value="double" class="form-check-input">
                                    <label class="form-check-label" for="doubleSide">Double Side</label>
                                </div>
                                <div class="form-check">
                                    <input type="radio" id="feeder" name="scanMode" value="feeder" class="form-check-input">
                                    <label class="form-check-label" for="feeder">Document Feeder</label>
                                </div>
                            </div>
                            
                            <div id="scanInstructions" class="alert alert-info mb-3">
                                Place your document on the scanner and click 'Start Scanning'
                            </div>
                            
                            <button type="button" class="btn btn-primary" onclick="startScanning()">
                                Start Scanning <span class="spinner" style="display: none;"><i class="fas fa-spinner fa-spin"></i></span>
                            </button>
                        </div>

                        <!-- Scan Preview -->
                        <div class="scan-preview" style="display: none;">
                            <h4 class="mt-4">Preview</h4>
                            <div class="preview-images"></div>
                        </div>

                        <div class="mt-4">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Save Document
                            </button>
                            <a href="{% url 'employees:dependent_documents' employee.id dependent.id %}" class="btn btn-secondary">
                                Cancel
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Image Preview Modal -->
<div id="imageModal" class="modal fade" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Image Preview</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <img id="modalImage" class="img-fluid" src="" alt="Preview">
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="{% static 'employees/utilities/scanning.js' %}"></script>
<script>
    function toggleDocumentFields() {
        const documentType = document.getElementById('document_type').value;
        const fields = document.querySelectorAll('.document-field');
        
        fields.forEach(field => {
            const documentTypes = field.getAttribute('data-document-types').split(',');
            if (documentTypes.includes(documentType)) {
                field.classList.add('show');
                const inputs = field.querySelectorAll('input, select');
                inputs.forEach(input => {
                    if (documentType === 'PASSPORT') {
                        input.required = true;
                    } else if (documentType === 'CPR') {
                        input.required = documentType === 'CPR' && input.name === 'expiry_date';
                    } else {
                        input.required = false;
                    }
                });
            } else {
                field.classList.remove('show');
                const inputs = field.querySelectorAll('input, select');
                inputs.forEach(input => input.required = false);
            }
        });
    }

    // Handle upload/scan method selection
    function selectMethod(method) {
        // Update buttons
        document.querySelectorAll('.method-button').forEach(btn => {
            btn.classList.remove('active');
        });
        const selectedBtn = document.querySelector(`.method-button[onclick="selectMethod('${method}')"]`);
        if (selectedBtn) {
            selectedBtn.classList.add('active');
        }
        
        // Show/hide content
        const uploadContent = document.querySelector('.upload-content');
        const scanContent = document.querySelector('.scan-content');
        
        if (method === 'upload') {
            uploadContent.style.display = 'block';
            scanContent.style.display = 'none';
        } else {
            uploadContent.style.display = 'none';
            scanContent.style.display = 'block';
        }
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
        selectMethod('upload');
        toggleDocumentFields();
        
        // Set scan endpoint and CSRF token for scanning.js
        window.scanEndpoint = '{% url "employees:scan_dependent_document" employee.id dependent.id %}';
        window.csrfToken = '{{ csrf_token }}';
        
        // Check if we're on Windows
        fetch('{% url "employees:system_info" %}')
            .then(response => response.json())
            .then(data => {
                const isWindows = data.platform === 'Windows';
                if (!isWindows) {
                    const scanButton = document.querySelector('[onclick="selectMethod(\'scan\')"]');
                    if (scanButton) {
                        scanButton.style.display = 'none';
                    }
                }
            })
            .catch(error => {
                console.error('Error checking system:', error);
            });
    });

    // Handle image preview modal
    document.addEventListener('click', function(e) {
        if (e.target.matches('.preview-image-container img')) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            const originalSrc = e.target.getAttribute('data-original') || e.target.src;
            
            modalImg.src = originalSrc;
            new bootstrap.Modal(modal).show();
        }
    });

    // Handle form submission
    document.getElementById('documentForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        
        fetch(this.action, {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': window.csrfToken
            },
            credentials: 'same-origin'
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                window.location.href = '{% url "employees:dependent_documents" employee.id dependent.id %}';
            } else {
                alert('Error: ' + data.error);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while saving the document');
        });
    });
</script>
{% endblock %}

```

### ðŸ“„ hrms_project\employees\templates\employees\preview\dependents\dependent_documents_list.html
```{% extends "employees/base.html" %}
{% load static %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">{{ dependent.name }}'s Documents</h3>
                    <div class="card-tools">
                        <a href="{% url 'employees:employee_detail' employee.id %}" class="btn btn-secondary btn-sm">
                            <i class="fas fa-arrow-left"></i> Back to Employee
                        </a>
                        <a href="{% url 'employees:add_dependent_document' employee.id dependent.id %}" class="btn btn-primary btn-sm">
                            <i class="fas fa-plus"></i> Add Document
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover" id="documentsTable">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th>Number</th>
                                    <th>Issue Date</th>
                                    <th>Expiry Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for document in documents %}
                                <tr>
                                    <td>{{ document.name }}</td>
                                    <td>{{ document.get_document_type_display }}</td>
                                    <td>{{ document.document_number|default:'-' }}</td>
                                    <td>{{ document.issue_date|date:"Y-m-d" }}</td>
                                    <td>{{ document.expiry_date|date:"Y-m-d"|default:'-' }}</td>
                                    <td>{{ document.status }}</td>
                                    <td>
                                        <div class="btn-group">
                                            <a href="{% url 'employees:view_dependent_document' employee.id dependent.id document.id %}" 
                                               class="btn btn-info btn-sm" target="_blank">
                                                <i class="fas fa-eye"></i>
                                            </a>
                                            <a href="{% url 'employees:edit_dependent_document' employee.id dependent.id document.id %}" 
                                               class="btn btn-warning btn-sm">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            <button type="button" class="btn btn-danger btn-sm" 
                                                    onclick="deleteDocument({{ document.id }})">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="7" class="text-center">No documents found.</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function deleteDocument(documentId) {
    if (confirm('Are you sure you want to delete this document?')) {
        $.post(`{% url 'employees:delete_dependent_document' employee.id dependent.id 0 %}`.replace('0', documentId), {
            csrfmiddlewaretoken: '{{ csrf_token }}'
        }, function(response) {
            if (response.status === 'success') {
                location.reload();
                showToast('Success', response.message, 'success');
            } else {
                showToast('Error', response.message, 'error');
            }
        });
    }
}
</script>
{% endblock %}

```

### ðŸ“„ hrms_project\employees\templates\employees\preview\dependents\dependent_form.html
```{% extends "employees/base.html" %}
{% load crispy_forms_tags %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">{% if dependent %}Edit{% else %}Add{% endif %} Dependent</h5>
                </div>
                <div class="card-body">
                    <form method="post" id="dependentForm">
                        {% csrf_token %}
                        <div class="row">
                            <div class="col-md-8 offset-md-2">
                                {{ form|crispy }}
                                <div class="mt-3">
                                    <a href="{% url 'employees:employee_detail' employee.id %}" class="btn btn-secondary">Cancel</a>
                                    <button type="submit" class="btn btn-primary">{% if dependent %}Update{% else %}Add{% endif %} Dependent</button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
<script>
$(document).ready(function() {
    $('#dependentForm').on('submit', function(e) {
        e.preventDefault();
        var form = $(this);
        var url = "{% if dependent %}{% url 'employees:edit_dependent' employee.id dependent.id %}{% else %}{% url 'employees:add_dependent' employee.id %}{% endif %}";
        
        $.ajax({
            url: url,
            type: 'POST',
            data: form.serialize(),
            success: function(response) {
                if (response.status === 'success') {
                    // Show success message
                    showToast('Success', response.message, 'success');
                    // Redirect back to employee detail page
                    window.location.href = "{% url 'employees:employee_detail' employee.id %}";
                } else {
                    // Show error message
                    showFormErrors(form, response.errors);
                }
            },
            error: function(xhr, errmsg, err) {
                showToast('Error', 'An error occurred while processing your request.', 'error');
            }
        });
    });
});
</script>
{% endblock %}
{% endblock %}

```

### ðŸ“„ hrms_project\employees\templates\employees\preview\dependents\scanning_js.html
```<script>
const { jsPDF } = window.jspdf;
let isWindows = false;

// Get system information when page loads
fetch('/employees/system-info/')
    .then(response => response.json())
    .then(data => {
        isWindows = data.platform === 'Windows';
        if (!isWindows) {
            document.querySelector('[onclick="selectMethod(\'scan\')"]').style.display = 'none';
        }
    });

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    selectMethod('upload');
    updateScanInstructions();
});

function selectMethod(method) {
    // Update buttons
    document.querySelectorAll('.method-button').forEach(btn => {
        btn.classList.remove('active');
    });
    const selectedBtn = method === 'upload' ? 
        document.querySelector('.method-button:first-child') :
        document.querySelector('.method-button:last-child');
    selectedBtn.classList.add('active');
    
    // Show/hide content
    const uploadContent = document.querySelector('.upload-content');
    const scanContent = document.querySelector('.scan-content');
    const scanPreview = document.querySelector('.scan-preview');
    
    if (method === 'upload') {
        uploadContent.style.display = 'block';
        scanContent.style.display = 'none';
        scanPreview.style.display = 'none';
    } else if (method === 'scan' && isWindows) {
        uploadContent.style.display = 'none';
        scanContent.style.display = 'block';
    }
}

let currentSide = 'front';
let frontImage = null;
let backImage = null;

function updateScanInstructions() {
    const mode = document.querySelector('input[name="scanMode"]:checked').value;
    const instructions = document.getElementById('twoSideInstructions');
    
    if (mode === 'double') {
        instructions.classList.add('active');
        instructions.querySelector('p').innerHTML = `
            <span class="scan-side-indicator">${currentSide === 'front' ? 'Front' : 'Back'} Side:</span> 
            Place the document with the ${currentSide} side facing down on the scanner.
        `;
    } else {
        instructions.classList.remove('active');
    }
}

// Add event listeners for scan mode changes
document.querySelectorAll('input[name="scanMode"]').forEach(radio => {
    radio.addEventListener('change', () => {
        currentSide = 'front';
        frontImage = null;
        backImage = null;
        updateScanInstructions();
        
        // Clear previews when changing modes
        const previewImages = document.querySelector('.preview-images');
        if (previewImages) {
            previewImages.innerHTML = '';
        }
    });
});

// Function to create thumbnail from image data
function createThumbnail(imageData, maxWidth = 150, maxHeight = 150) {
    return new Promise((resolve) => {
        const img = new Image();
        img.onload = function() {
            const canvas = document.createElement('canvas');
            let width = img.width;
            let height = img.height;
            
            // Calculate new dimensions
            if (width > height) {
                if (width > maxWidth) {
                    height = Math.round(height * maxWidth / width);
                    width = maxWidth;
                }
            } else {
                if (height > maxHeight) {
                    width = Math.round(width * maxHeight / height);
                    height = maxHeight;
                }
            }
            
            canvas.width = width;
            canvas.height = height;
            
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, width, height);
            
            resolve(canvas.toDataURL('image/jpeg', 0.7));
        };
        img.src = imageData;
    });
}

async function startScanning() {
    if (!isWindows) {
        alert('Scanner functionality is only available on Windows systems.');
        return;
    }

    const scanBtn = document.querySelector('.scan-content button');
    const spinner = document.querySelector('.scan-content .spinner');  
    const previewContainer = document.querySelector('.scan-preview');
    const previewImages = document.querySelector('.preview-images');
    const scanMode = document.querySelector('input[name="scanMode"]:checked').value;
    
    try {
        // Show loading state
        scanBtn.disabled = true;
        if (spinner) {  
            spinner.style.display = 'inline-block';
        }
        
        // Clear previews if starting fresh scan
        if (scanMode !== 'double' || currentSide === 'front') {
            previewImages.innerHTML = '';
        }
        
        // Call our scanning endpoint
        const response = await fetch('{% url "employees:scan_document" employee.id %}', {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                useFeeder: scanMode === 'feeder',
                currentSide: currentSide
            })
        });
        
        if (!response.ok) {
            const data = await response.json();
            throw new Error(data.error || 'Failed to scan document');
        }
        
        const data = await response.json();
        
        if (scanMode === 'double') {
            // Handle two-sided scanning
            if (currentSide === 'front') {
                frontImage = data.images[0];
                
                // Create thumbnail
                const thumbnailData = await createThumbnail(frontImage.data);
                
                // Show front preview
                const previewContainer = document.createElement('div');
                previewContainer.className = 'preview-image-container';
                
                const pageNumber = document.createElement('div');
                pageNumber.className = 'page-number';
                pageNumber.textContent = 'Front Side';
                previewContainer.appendChild(pageNumber);
                
                const img = document.createElement('img');
                img.src = thumbnailData;
                img.alt = 'Front Side';
                img.setAttribute('data-original', frontImage.data);
                previewContainer.appendChild(img);
                
                previewImages.appendChild(previewContainer);
                
                // Update instructions for back side
                currentSide = 'back';
                updateScanInstructions();
                
                // Update button text and add spinner
                scanBtn.innerHTML = 'Scan Back Side <span class="spinner"><i class="fas fa-spinner fa-spin"></i></span>';
                
            } else {
                backImage = data.images[0];
                
                // Create thumbnail
                const thumbnailData = await createThumbnail(backImage.data);
                
                // Show back preview
                const previewContainer = document.createElement('div');
                previewContainer.className = 'preview-image-container';
                
                const pageNumber = document.createElement('div');
                pageNumber.className = 'page-number';
                pageNumber.textContent = 'Back Side';
                previewContainer.appendChild(pageNumber);
                
                const img = document.createElement('img');
                img.src = thumbnailData;
                img.alt = 'Back Side';
                img.setAttribute('data-original', backImage.data);
                previewContainer.appendChild(img);
                
                previewImages.appendChild(previewContainer);
                
                try {
                    // Create PDF with both sides
                    const doc = new jsPDF();
                    
                    // Add front side
                    doc.addImage(frontImage.data, 'JPEG', 0, 0, 210, 297);
                    
                    // Add back side
                    doc.addPage();
                    doc.addImage(backImage.data, 'JPEG', 0, 0, 210, 297);
                    
                    // Convert to blob and create file
                    const pdfBlob = doc.output('blob');
                    const file = new File([pdfBlob], "scanned_document.pdf", { type: "application/pdf" });
                    
                    // Update file input
                    const fileInput = document.querySelector('input[type="file"]');
                    const dataTransfer = new DataTransfer();
                    dataTransfer.items.add(file);
                    fileInput.files = dataTransfer.files;
                    
                    // Reset for next scan
                    currentSide = 'front';
                    scanBtn.innerHTML = 'Start Scanning <span class="spinner"><i class="fas fa-spinner fa-spin"></i></span>';
                    updateScanInstructions();
                } catch (pdfError) {
                    console.error('PDF Creation Error:', pdfError);
                    throw new Error('Failed to create PDF: ' + pdfError.message);
                }
            }
            
        } else {
            // Handle single-side or feeder scanning
            try {
                const doc = new jsPDF();
                let firstPage = true;
                
                for (const image of data.images) {
                    if (!firstPage) {
                        doc.addPage();
                    }
                    doc.addImage(image.data, 'JPEG', 0, 0, 210, 297);
                    firstPage = false;
                    
                    // Create thumbnail
                    const thumbnailData = await createThumbnail(image.data);
                    
                    // Add preview
                    const container = document.createElement('div');
                    container.className = 'preview-image-container';
                    
                    const pageNumber = document.createElement('div');
                    pageNumber.className = 'page-number';
                    pageNumber.textContent = 'Page ' + (data.images.indexOf(image) + 1);
                    container.appendChild(pageNumber);
                    
                    const img = document.createElement('img');
                    img.src = thumbnailData;
                    img.alt = 'Page ' + (data.images.indexOf(image) + 1);
                    img.setAttribute('data-original', image.data);
                    container.appendChild(img);
                    
                    previewImages.appendChild(container);
                }
                
                // Create file from PDF
                const pdfBlob = doc.output('blob');
                const file = new File([pdfBlob], "scanned_document.pdf", { type: "application/pdf" });
                
                // Update file input
                const fileInput = document.querySelector('input[type="file"]');
                const dataTransfer = new DataTransfer();
                dataTransfer.items.add(file);
                fileInput.files = dataTransfer.files;
            } catch (pdfError) {
                console.error('PDF Creation Error:', pdfError);
                throw new Error('Failed to create PDF: ' + pdfError.message);
            }
        }
        
        // Show preview section
        previewContainer.style.display = 'block';
        
    } catch (error) {
        alert('Error while scanning: ' + error.message);
        console.error(error);
    } finally {
        // Reset loading state
        scanBtn.disabled = false;
        if (spinner) {  
            spinner.style.display = 'none';
        }
    }
}

// Form submission handling
$('#documentForm').on('submit', function(e) {
    e.preventDefault();
    var form = $(this);
    var formData = new FormData(this);
    
    $.ajax({
        url: form.attr('action'),
        type: 'POST',
        data: formData,
        processData: false,
        contentType: false,
        success: function(response) {
            if (response.status === 'success') {
                showToast('Success', response.message, 'success');
                window.location.href = "{% url 'employees:dependent_documents' employee.id dependent.id %}";
            } else {
                showToast('Error', 'Please correct the errors below.', 'error');
                // Display form errors
                for (var field in response.errors) {
                    var errorField = $('#id_' + field);
                    errorField.addClass('is-invalid');
                    errorField.siblings('.invalid-feedback').remove();
                    errorField.after('<div class="invalid-feedback">' + response.errors[field].join(', ') + '</div>');
                }
            }
        },
        error: function() {
            showToast('Error', 'An error occurred while saving the document.', 'error');
        }
    });
});

// Image modal functionality
document.querySelectorAll('.preview-image-container img').forEach(img => {
    img.onclick = function() {
        const modal = document.getElementById('imageModal');
        const modalImg = document.getElementById('modalImage');
        modal.style.display = 'block';
        modalImg.src = this.getAttribute('data-original') || this.src;
    }
});

document.querySelector('.close-modal').onclick = function() {
    document.getElementById('imageModal').style.display = 'none';
}

window.onclick = function(event) {
    const modal = document.getElementById('imageModal');
    if (event.target == modal) {
        modal.style.display = 'none';
    }
}
</script>

```

### ðŸ“„ hrms_project\employees\templates\employees\preview\document\document_confirm_delete.html
```{% extends "employees/base.html" %}

{% block title %}Delete Document - {{ employee.get_full_name }}{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row mb-4">
        <div class="col">
            <h2>Delete Document - {{ employee.get_full_name }}</h2>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="card">
                <div class="card-body">
                    <p>Are you sure you want to delete the following document?</p>
                    <ul class="list-unstyled">
                        <li><strong>Document Type:</strong> {{ document.get_document_type_display }}</li>
                        <li><strong>Document Number:</strong> {{ document.document_number }}</li>
                        <li><strong>Issue Date:</strong> {{ document.issue_date|date:"d/m/Y" }}</li>
                        <li><strong>Expiry Date:</strong> {{ document.expiry_date|date:"d/m/Y" }}</li>
                    </ul>
                    <form method="post">
                        {% csrf_token %}
                        <div class="mt-3">
                            <a href="{% url 'employees:employee_detail' employee.pk %}" class="btn btn-secondary">Cancel</a>
                            <button type="submit" class="btn btn-danger">Delete Document</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

```

### ðŸ“„ hrms_project\employees\templates\employees\preview\document\document_form.html
```{% extends "employees/base.html" %}

{% load static %}
{% load crispy_forms_tags %}

{% block extra_css %}
<style>
    .method-button {
        padding: 10px 20px;
        margin: 5px;
        border: 1px solid #ddd;
        cursor: pointer;
    }
    .method-button.active {
        background-color: #007bff;
        color: white;
    }
    .upload-content, .scan-content, .scan-preview {
        margin-top: 20px;
    }
    .preview-images {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 10px;
    }
    .preview-image-container {
        position: relative;
        max-width: 150px;
    }
    .preview-image-container img {
        width: 100%;
        height: auto;
        cursor: pointer;
    }
    .page-number {
        position: absolute;
        top: 5px;
        left: 5px;
        background: rgba(0,0,0,0.7);
        color: white;
        padding: 2px 5px;
        font-size: 12px;
    }
    #twoSideInstructions {
        display: none;
        padding: 10px;
        margin: 10px 0;
        background-color: #f8f9fa;
        border: 1px solid #ddd;
    }
    #twoSideInstructions.active {
        display: block;
    }
    .scan-side-indicator {
        font-weight: bold;
        color: #007bff;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">{% if document %}Edit{% else %}Add{% endif %} Document for {{ employee.name }}</h3>
                    <div class="card-tools">
                        <a href="{% url 'employees:employee_detail' employee.id %}" class="btn btn-secondary btn-sm">
                            <i class="fas fa-arrow-left"></i> Back to Employee
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <form method="post" enctype="multipart/form-data" id="documentForm">
                        {% csrf_token %}
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                {{ form.document_type|as_crispy_field }}
                            </div>
                            <div class="col-md-6">
                                {{ form.document_number|as_crispy_field }}
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                {{ form.profession_title|as_crispy_field }}
                            </div>
                            <div class="col-md-6">
                                {{ form.issue_place|as_crispy_field }}
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                {{ form.issue_date|as_crispy_field }}
                            </div>
                            <div class="col-md-6">
                                {{ form.expiry_date|as_crispy_field }}
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-12">
                                {{ form.other_info|as_crispy_field }}
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-12">
                                <label class="form-label">Document Upload Method</label>
                                <div class="d-flex">
                                    <button type="button" class="method-button active" onclick="selectMethod('upload')">
                                        <i class="fas fa-upload"></i> Upload File
                                    </button>
                                    <button type="button" class="method-button" onclick="selectMethod('scan')">
                                        <i class="fas fa-scanner"></i> Scan Document
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="upload-content">
                            {{ form.document_file|as_crispy_field }}
                        </div>

                        <div class="scan-content" style="display: none;">
                            <div class="form-group">
                                <label>Scan Mode</label>
                                <div class="form-check">
                                    <input type="radio" id="singleSide" name="scanMode" value="single" class="form-check-input" checked>
                                    <label class="form-check-label" for="singleSide">Single Side</label>
                                </div>
                                <div class="form-check">
                                    <input type="radio" id="doubleSide" name="scanMode" value="double" class="form-check-input">
                                    <label class="form-check-label" for="doubleSide">Double Side</label>
                                </div>
                                <div class="form-check">
                                    <input type="radio" id="feeder" name="scanMode" value="feeder" class="form-check-input">
                                    <label class="form-check-label" for="feeder">Document Feeder</label>
                                </div>
                            </div>

                            <div id="twoSideInstructions" class="alert alert-info">
                                <p></p>
                            </div>

                            <button type="button" class="btn btn-primary" onclick="startScanning()">
                                Start Scanning <span class="spinner" style="display: none;"><i class="fas fa-spinner fa-spin"></i></span>
                            </button>
                        </div>

                        <div class="scan-preview" style="display: none;">
                            <h5>Scanned Pages</h5>
                            <div class="preview-images"></div>
                        </div>

                        <div class="mt-3">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Save Document
                            </button>
                            <a href="{% url 'employees:employee_detail' employee.id %}" class="btn btn-secondary">
                                Cancel
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Image Preview Modal -->
<div id="imageModal" class="modal fade" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Image Preview</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <img id="modalImage" class="img-fluid" src="" alt="Preview">
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
{% load static %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="{% static 'employees/utilities/scanning.js' %}"></script>
<script>
    // Handle upload/scan method selection
    function selectMethod(method) {
        // Update buttons
        document.querySelectorAll('.method-button').forEach(btn => {
            btn.classList.remove('active');
        });
        const selectedBtn = document.querySelector(`.method-button[onclick*="${method}"]`);
        if (selectedBtn) {
            selectedBtn.classList.add('active');
        }

        // Show/hide content sections
        const uploadContent = document.querySelector('.upload-content');
        const scanContent = document.querySelector('.scan-content');
        const scanPreview = document.querySelector('.scan-preview');

        if (method === 'upload') {
            uploadContent.style.display = 'block';
            scanContent.style.display = 'none';
            scanPreview.style.display = 'none';
        } else {
            uploadContent.style.display = 'none';
            scanContent.style.display = 'block';
        }
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
        selectMethod('upload');
        
        // Set scan endpoint for the scanning.js
        window.scanEndpoint = '{% url "employees:scan_document" employee.id %}';
        
        // Check if we're on Windows
        fetch('{% url "employees:system_info" %}')
            .then(response => response.json())
            .then(data => {
                const isWindows = data.platform === 'Windows';
                if (!isWindows) {
                    const scanButton = document.querySelector('[onclick="selectMethod(\'scan\')"]');
                    if (scanButton) {
                        scanButton.style.display = 'none';
                    }
                }
            })
            .catch(error => {
                console.error('Error checking system:', error);
            });
    });

    // Handle image preview modal
    document.addEventListener('click', function(e) {
        if (e.target.matches('.preview-image-container img')) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            const originalSrc = e.target.getAttribute('data-original') || e.target.src;
            
            modalImg.src = originalSrc;
            new bootstrap.Modal(modal).show();
        }
    });
</script>
{% endblock %}

```

### ðŸ“„ hrms_project\employees\templates\employees\preview\document\document_view.html
```{% extends "employees/base.html" %}

{% block title %}View Document - {{ employee.get_full_name }}{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row mb-4">
        <div class="col">
            <h2>View Document - {{ employee.get_full_name }}</h2>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="card">
                <div class="card-body">
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <p><strong>Document Type:</strong> {{ document.get_document_type_display }}</p>
                            <p><strong>Document Number:</strong> {{ document.document_number }}</p>
                            <p><strong>Profession/Title:</strong> {{ document.profession_title|default:"-" }}</p>
                            <p><strong>Issue Date:</strong> {{ document.issue_date|date:"d/m/Y" }}</p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Issue Place:</strong> {{ document.issue_place }}</p>
                            <p><strong>Expiry Date:</strong> {{ document.expiry_date|date:"d/m/Y" }}</p>
                            <p><strong>Status:</strong> 
                                {% if document.is_expired %}
                                    <span class="badge bg-danger">Expired</span>
                                {% else %}
                                    <span class="badge bg-success">Valid</span>
                                {% endif %}
                            </p>
                        </div>
                    </div>

                    {% if document.other_info %}
                    <div class="row mb-4">
                        <div class="col">
                            <h5>Additional Information</h5>
                            <p>{{ document.other_info|linebreaks }}</p>
                        </div>
                    </div>
                    {% endif %}

                    <div class="row">
                        <div class="col">
                            <h5>Document File</h5>
                            {% if document.is_image %}
                                <img src="{{ document.document_file.url }}" alt="Document" class="img-fluid">
                            {% else %}
                                <div class="d-grid gap-2">
                                    <a href="{{ document.document_file.url }}" class="btn btn-primary" target="_blank">
                                        <i class="fas fa-download"></i> Download Document
                                    </a>
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="mt-4">
                        <a href="{% url 'employees:employee_detail' employee.pk %}" class="btn btn-secondary">Back</a>
                        <a href="{% url 'employees:edit_document' employee.pk document.pk %}" class="btn btn-warning">
                            <i class="fas fa-edit"></i> Edit
                        </a>
                        <a href="{% url 'employees:delete_document' employee.pk document.pk %}" class="btn btn-danger">
                            <i class="fas fa-trash"></i> Delete
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

```

### ðŸ“„ hrms_project\employees\templates\employees\revision_form.html
```{% extends "employees/base.html" %}
{% load static %}

{% block title %}Add Salary Revision - {{ employee.get_full_name }}{% endblock %}

{% block content %}
<div class="container-fluid p-4">
    <div class="card info-card">
        <div class="card-header">
            <h5 class="mb-0">Add Salary Revision</h5>
        </div>
        <div class="card-body">
            <form method="post" class="needs-validation" novalidate>
                {% csrf_token %}
                
                {% if form.non_field_errors %}
                <div class="alert alert-danger">
                    {% for error in form.non_field_errors %}
                        {{ error }}
                    {% endfor %}
                </div>
                {% endif %}

                <!-- Current Salary Information (Read-only) -->
                {% if employee.salary_details.exists %}
                {% with current_salary=employee.salary_details.first %}
                <div class="alert alert-info mb-4">
                    <h6 class="alert-heading mb-2">Current Salary Information</h6>
                    <div class="row">
                        <div class="col-md-3">
                            <small class="d-block text-muted">Basic Salary:</small>
                            <strong>{{ current_salary.basic_salary }} {{ current_salary.currency }}</strong>
                        </div>
                        <div class="col-md-3">
                            <small class="d-block text-muted">Housing Allowance:</small>
                            <strong>{{ current_salary.housing_allowance }} {{ current_salary.currency }}</strong>
                        </div>
                        <div class="col-md-3">
                            <small class="d-block text-muted">Transportation:</small>
                            <strong>{{ current_salary.transportation_allowance }} {{ current_salary.currency }}</strong>
                        </div>
                        <div class="col-md-3">
                            <small class="d-block text-muted">Total Salary:</small>
                            <strong>{{ current_salary.total_salary }} {{ current_salary.currency }}</strong>
                        </div>
                    </div>
                    <div class="mt-2">
                        <small class="text-muted">Effective since: {{ current_salary.effective_from|date:"d M Y" }}</small>
                    </div>
                </div>
                {% endwith %}
                {% else %}
                <div class="alert alert-warning mb-4">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    No active salary details found. Please add salary details before creating a revision.
                </div>
                {% endif %}

                <div class="row mb-3">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="{{ form.revision_type.id_for_label }}" class="form-label">Revision Type *</label>
                            {{ form.revision_type }}
                            {% if form.revision_type.errors %}
                            <div class="invalid-feedback d-block">
                                {{ form.revision_type.errors.0 }}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="{{ form.revision_date.id_for_label }}" class="form-label">Effective Date *</label>
                            {{ form.revision_date }}
                            {% if form.revision_date.errors %}
                            <div class="invalid-feedback d-block">
                                {{ form.revision_date.errors.0 }}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="form-group mb-3">
                    <label for="{{ form.reason.id_for_label }}" class="form-label">Reason for Revision *</label>
                    {{ form.reason }}
                    {% if form.reason.errors %}
                    <div class="invalid-feedback d-block">
                        {{ form.reason.errors.0 }}
                    </div>
                    {% endif %}
                </div>

                <div class="form-group mb-4">
                    <label for="{{ form.reference_number.id_for_label }}" class="form-label">Reference Number</label>
                    {{ form.reference_number }}
                    {% if form.reference_number.errors %}
                    <div class="invalid-feedback d-block">
                        {{ form.reference_number.errors.0 }}
                    </div>
                    {% endif %}
                    <small class="form-text text-muted">Optional. Enter any reference number or document ID related to this revision.</small>
                </div>

                <div class="d-flex justify-content-end">
                    <a href="{% url 'employees:employee_detail' employee.id %}" class="btn btn-secondary me-2">Cancel</a>
                    <button type="submit" class="btn btn-primary" {% if not employee.salary_details.exists %}disabled{% endif %}>
                        Save Revision
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Initialize form validation
    (function() {
        'use strict';
        var forms = document.querySelectorAll('.needs-validation');
        Array.prototype.slice.call(forms).forEach(function(form) {
            form.addEventListener('submit', function(event) {
                if (!form.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            }, false);
        });
    })();
</script>
{% endblock %}
```

### ðŸ“„ hrms_project\employees\templates\employees\salary_form.html
```{% extends "employees/base.html" %}
{% load static %}

{% block title %}{{ is_edit|yesno:"Edit,Add" }} Salary Details - {{ employee.get_full_name }}{% endblock %}

{% block content %}
<div class="container-fluid p-4">
    <div class="card info-card">
        <div class="card-header">
            <h5 class="mb-0">{{ is_edit|yesno:"Edit,Add" }} Salary Details</h5>
        </div>
        <div class="card-body">
            <form method="post" class="needs-validation" novalidate>
                {% csrf_token %}
                
                {% if form.non_field_errors %}
                <div class="alert alert-danger">
                    {% for error in form.non_field_errors %}
                        {{ error }}
                    {% endfor %}
                </div>
                {% endif %}

                <div class="row mb-3">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="{{ form.basic_salary.id_for_label }}" class="form-label">Basic Salary *</label>
                            {{ form.basic_salary }}
                            {% if form.basic_salary.errors %}
                            <div class="invalid-feedback d-block">
                                {{ form.basic_salary.errors.0 }}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="{{ form.currency.id_for_label }}" class="form-label">Currency *</label>
                            {{ form.currency }}
                            {% if form.currency.errors %}
                            <div class="invalid-feedback d-block">
                                {{ form.currency.errors.0 }}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="{{ form.housing_allowance.id_for_label }}" class="form-label">Housing Allowance</label>
                            {{ form.housing_allowance }}
                            {% if form.housing_allowance.errors %}
                            <div class="invalid-feedback d-block">
                                {{ form.housing_allowance.errors.0 }}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="{{ form.transportation_allowance.id_for_label }}" class="form-label">Transportation Allowance</label>
                            {{ form.transportation_allowance }}
                            {% if form.transportation_allowance.errors %}
                            <div class="invalid-feedback d-block">
                                {{ form.transportation_allowance.errors.0 }}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="{{ form.effective_from.id_for_label }}" class="form-label">Effective From *</label>
                            {{ form.effective_from }}
                            {% if form.effective_from.errors %}
                            <div class="invalid-feedback d-block">
                                {{ form.effective_from.errors.0 }}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="{{ form.other_allowances.id_for_label }}" class="form-label">Other Allowances (JSON)</label>
                            {{ form.other_allowances }}
                            <small class="form-text text-muted">Format: {"allowance_name": amount}</small>
                            {% if form.other_allowances.errors %}
                            <div class="invalid-feedback d-block">
                                {{ form.other_allowances.errors.0 }}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="form-group mb-3">
                    <label for="{{ form.notes.id_for_label }}" class="form-label">Notes</label>
                    {{ form.notes }}
                    {% if form.notes.errors %}
                    <div class="invalid-feedback d-block">
                        {{ form.notes.errors.0 }}
                    </div>
                    {% endif %}
                </div>

                <div class="d-flex justify-content-end">
                    <a href="{% url 'employees:employee_detail' employee.id %}" class="btn btn-secondary me-2">Cancel</a>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Initialize form validation
    (function() {
        'use strict';
        var forms = document.querySelectorAll('.needs-validation');
        Array.prototype.slice.call(forms).forEach(function(form) {
            form.addEventListener('submit', function(event) {
                if (!form.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            }, false);
        });
    })();
</script>
{% endblock %}
```

### ðŸ“„ hrms_project\employees\urls.py
```from django.urls import path, include
from rest_framework.routers import DefaultRouter
from . import views, api_views

app_name = 'employees'

# Create a router for API views
router = DefaultRouter()
router.register(r'asset-types', api_views.AssetTypeViewSet, basename='asset-type')
router.register(r'employee-assets', api_views.EmployeeAssetViewSet, basename='employee-asset')
router.register(r'offense-rules', api_views.OffenseRuleViewSet, basename='offense-rule')
router.register(r'employee-offenses', api_views.EmployeeOffenseViewSet, basename='employee-offense')

urlpatterns = [
    # Include API URLs under /api/ namespace
    path('api/', include(router.urls)),

    # Class-based views
    path('', views.EmployeeListView.as_view(), name='employee_list'),
    path('<int:pk>/', views.EmployeeDetailView.as_view(), name='employee_detail'),
    path('create/', views.EmployeeCreateView.as_view(), name='employee_create'),
    path('<int:pk>/update/', views.EmployeeUpdateView.as_view(), name='employee_update'),
    path('<int:pk>/delete/', views.EmployeeDeleteView.as_view(), name='employee_delete'),

    # Bank Account Management
    path('<int:employee_id>/bank-accounts/add/', views.add_bank_account, name='add_bank_account'),
    path('<int:employee_id>/bank-accounts/<int:account_id>/edit/', views.edit_bank_account, name='edit_bank_account'),
    path('<int:employee_id>/bank-accounts/<int:account_id>/delete/', views.delete_bank_account, name='delete_bank_account'),

    # Employee Assets
    path('<int:employee_id>/assets/add/', api_views.add_employee_asset, name='add_employee_asset'),
    path('<int:employee_id>/assets/<int:asset_id>/', api_views.get_employee_asset, name='get_employee_asset'),
    path('<int:employee_id>/assets/<int:asset_id>/edit/', api_views.edit_employee_asset, name='edit_employee_asset'),
    path('<int:employee_id>/assets/<int:asset_id>/return/', api_views.return_employee_asset, name='return_employee_asset'),
    path('<int:employee_id>/assets/<int:asset_id>/delete/', api_views.delete_employee_asset, name='delete_employee_asset'),

    # Document Management
    path('<int:employee_id>/documents/', views.employee_documents, name='employee_documents'),
    path('<int:employee_id>/documents/add/', views.add_document, name='add_document'),
    path('<int:employee_id>/documents/<int:document_id>/edit/', views.edit_document, name='edit_document'),
    path('<int:employee_id>/documents/<int:document_id>/delete/', views.delete_document, name='delete_document'),
    path('<int:employee_id>/documents/<int:document_id>/view/', views.view_document, name='view_document'),

    # Salary Management
    path('<int:employee_id>/salary/add/', views.add_salary, name='add_salary'),
    path('salary/<int:salary_id>/edit/', views.edit_salary, name='edit_salary'),
    path('<int:employee_id>/salary/revision/add/', views.add_salary_revision, name='add_salary_revision'),
    path('<int:employee_id>/salary/certificate/request/', views.request_certificate, name='request_certificate'),

    # Scanner functionality
    path('scan-document/', views.scan_document, name='scan_document_universal'),  # Universal scanner endpoint
    path('<int:employee_id>/scan-document/', views.scan_document, name='scan_document'),  # For backward compatibility
    path('<int:employee_id>/dependents/<int:dependent_id>/scan-document/', views.scan_document, name='scan_dependent_document'),  # For dependent documents

    # Dependent Management
    path('<int:employee_id>/dependents/add/', views.add_dependent, name='add_dependent'),
    path('<int:employee_id>/dependents/<int:dependent_id>/edit/', views.edit_dependent, name='edit_dependent'),
    path('<int:employee_id>/dependents/<int:dependent_id>/delete/', views.delete_dependent, name='delete_dependent'),
    path('<int:employee_id>/dependents/<int:dependent_id>/documents/', views.dependent_documents, name='dependent_documents'),
    path('<int:employee_id>/dependents/<int:dependent_id>/documents/list/', views.get_dependent_documents, name='get_dependent_documents'),
    path('<int:employee_id>/dependents/<int:dependent_id>/documents/add/', views.add_dependent_document, name='add_dependent_document'),
    path('<int:employee_id>/dependents/<int:dependent_id>/documents/<int:document_id>/edit/', views.edit_dependent_document, name='edit_dependent_document'),
    path('<int:employee_id>/dependents/<int:dependent_id>/documents/<int:document_id>/delete/', views.delete_dependent_document, name='delete_dependent_document'),
    path('<int:employee_id>/dependents/<int:dependent_id>/documents/<int:document_id>/view/', views.view_dependent_document, name='view_dependent_document'),

    # Offence Management URLs
    path('api/offenses/', api_views.EmployeeOffenseViewSet.as_view({
        'get': 'list',
        'post': 'create'
    }), name='offense_list_create'),
    
    path('api/offenses/<int:pk>/', api_views.EmployeeOffenseViewSet.as_view({
        'get': 'retrieve',
        'put': 'update',
        'patch': 'partial_update',
        'delete': 'destroy'
    }), name='offense_detail'),

    # employee-specific offense URLs
    path('api/employees/<int:employee_id>/offenses/', api_views.employee_offenses, name='employee_offenses'),
    path('api/employees/<int:employee_id>/offenses/<int:offense_id>/', api_views.employee_offense_detail, name='employee_offense_detail'),
    # count offenses
    path('api/employee-offenses/<int:employee_id>/count/', api_views.get_employee_offense_count, name='get_employee_offense_count'),
    
    # Offense Actions
    path('api/offenses/<int:pk>/status/', api_views.update_offense_status, name='offense_status_update'),
    path('api/offenses/<int:pk>/payment/', api_views.record_offense_payment, name='offense_payment'),
    path('api/offenses/<int:pk>/print/', api_views.print_offense, name='offense_print'),
    
    # Employee-specific Offense URLs
    path('api/employees/<int:employee_id>/offenses/', api_views.employee_offenses, name='employee_offenses'),
    path('api/employees/<int:employee_id>/offenses/count/', api_views.get_employee_offense_count, name='employee_offense_count'),
    
    # Offense Rules
    path('api/offense-rules/', api_views.OffenseRuleViewSet.as_view({
        'get': 'list',
        'post': 'create'
    }), name='offense_rule_list'),
    
    path('api/offense-rules/<int:pk>/', api_views.OffenseRuleViewSet.as_view({
        'get': 'retrieve',
        'put': 'update',
        'patch': 'partial_update',
        'delete': 'destroy'
    }), name='offense_rule_detail'),

    # Bulk Status Change
    path('bulk-status-change/', views.bulk_status_change, name='bulk_status_change'),
    path('bulk-status-change/<str:status>/', views.bulk_status_change, name='bulk_status_change_with_status'),

    # System Info
    path('system-info/', views.system_info, name='system_info'),

    # Function-based views (alternative)
    # path('', views.employee_list, name='employee_list'),
    # path('<int:pk>/', views.employee_detail, name='employee_detail'),
    # path('create/', views.employee_create, name='employee_create'),
    # path('<int:pk>/update/', views.employee_update, name='employee_update'),
    # path('<int:pk>/delete/', views.employee_delete, name='employee_delete'),
]

```

### ðŸ“„ hrms_project\employees\views.py
```from django.shortcuts import render, get_object_or_404, redirect
from django.contrib.auth.decorators import login_required, permission_required
from django.contrib import messages
from django.core.paginator import Paginator
from django.urls import reverse_lazy
from django.views.generic import ListView, DetailView, CreateView, UpdateView, DeleteView
from django.contrib.auth.mixins import LoginRequiredMixin, PermissionRequiredMixin
from django.db import transaction
from django.db.models import Q
from .models import (
    Employee, Department, Division, EmployeeBankAccount, EmployeeDocument,
    EmployeeDependent, DependentDocument, AssetType, OffenseRule , SalaryDetail, SalaryRevision, SalaryCertificate
)
from .forms import (
    EmployeeForm, EmployeeBankAccountForm, EmployeeDocumentForm,
    EmployeeDependentForm, DependentDocumentForm,  SalaryDetailForm, SalaryCertificateForm, SalaryRevisionForm
)
from django.http import JsonResponse, HttpResponse
from django.utils import timezone
import os
import tempfile
import base64
import io
from PIL import Image
import json
import platform
from django.views.decorators.csrf import csrf_exempt
from django.template.loader import render_to_string
import uuid
import time
from django.http import Http404

# Only import Windows-specific modules if on Windows
if platform.system() == 'Windows':
    try:
        import win32com.client
        import pythoncom
    except ImportError:
        pass

class EmployeeListView(LoginRequiredMixin, ListView):
    model = Employee
    template_name = 'employees/employee_list.html'
    context_object_name = 'employees'
    paginate_by = 10
    ordering = ['employee_number']

    def get_queryset(self):
        queryset = super().get_queryset()
        search_query = self.request.GET.get('search')
        department = self.request.GET.get('department')
        division = self.request.GET.get('division')
        status = self.request.GET.get('status')

        if search_query:
            queryset = queryset.filter(
                Q(employee_number__icontains=search_query) |
                Q(first_name__icontains=search_query) |
                Q(last_name__icontains=search_query) |
                Q(email__icontains=search_query)
            )
        
        if department:
            queryset = queryset.filter(department_id=department)
        
        if division:
            queryset = queryset.filter(division_id=division)
        
        if status:
            is_active = status == 'active'
            queryset = queryset.filter(is_active=is_active)

        return queryset.select_related('department', 'division', 'location', 'cost_center', 'profit_center')

    def get_context_data(self, **kwargs):
        context = super().get_context_data(**kwargs)
        context['departments'] = Department.objects.all()
        context['divisions'] = Division.objects.all()
        return context

class EmployeeDetailView(LoginRequiredMixin, DetailView):
    model = Employee
    template_name = 'employees/employee_detail.html'
    context_object_name = 'employee'

    def get_context_data(self, **kwargs):
        context = super().get_context_data(**kwargs)
        employee = self.get_object()
        context.update({
            'dependents': employee.dependents.all(),
            'emergency_contacts': employee.emergency_contacts.all(),
            'documents': employee.documents.all(),
            'assets': employee.assets.all(),
            'education': employee.education.all(),
            'offences': employee.employee_offence_records.all(),
            'life_events': employee.life_events.all(),
            'bank_accounts': employee.bank_accounts.all(),
            'asset_types': AssetType.objects.all(),
            'offense_groups': OffenseRule.GROUP_CHOICES,
            'penalty_choices': OffenseRule.PENALTY_CHOICES
        })
        return context

class EmployeeCreateView(LoginRequiredMixin, PermissionRequiredMixin, CreateView):
    model = Employee
    form_class = EmployeeForm
    template_name = 'employees/employee_form.html'
    success_url = reverse_lazy('employees:employee_list')
    permission_required = 'employees.add_employee'

    def get_form_kwargs(self):
        kwargs = super().get_form_kwargs()
        kwargs['initial'] = {'employee_number': self.get_next_employee_number()}
        return kwargs

    @transaction.atomic
    def form_valid(self, form):
        response = super().form_valid(form)
        messages.success(self.request, 'Employee created successfully.')
        return response

    def get_next_employee_number(self):
        last_employee = Employee.objects.order_by('-employee_number').first()
        if not last_employee or not last_employee.employee_number.startswith('EMP'):
            return 'EMP0001'
        
        try:
            last_number = int(last_employee.employee_number[3:])
            return f'EMP{str(last_number + 1).zfill(4)}'
        except ValueError:
            return 'EMP0001'

class EmployeeUpdateView(LoginRequiredMixin, PermissionRequiredMixin, UpdateView):
    model = Employee
    form_class = EmployeeForm
    template_name = 'employees/employee_form.html'
    success_url = reverse_lazy('employees:employee_list')
    permission_required = 'employees.change_employee'

    @transaction.atomic
    def form_valid(self, form):
        response = super().form_valid(form)
        messages.success(self.request, 'Employee updated successfully.')
        return response

class EmployeeDeleteView(LoginRequiredMixin, PermissionRequiredMixin, DeleteView):
    model = Employee
    success_url = reverse_lazy('employees:employee_list')
    permission_required = 'employees.delete_employee'
    template_name = 'employees/employee_confirm_delete.html'

    @transaction.atomic
    def delete(self, request, *args, **kwargs):
        messages.success(request, 'Employee deleted successfully.')
        return super().delete(request, *args, **kwargs)

# Function-based views for those who prefer them
@login_required
def employee_list(request):
    employees = Employee.objects.all().select_related('department', 'division', 'location', 'cost_center', 'profit_center').order_by('employee_number')
    paginator = Paginator(employees, 10)
    page = request.GET.get('page')
    employees = paginator.get_page(page)
    return render(request, 'employees/employee_list.html', {'employees': employees})

@login_required
def employee_detail(request, pk):
    employee = get_object_or_404(Employee, pk=pk)
    return render(request, 'employees/employee_detail.html', {'employee': employee})

@login_required
@transaction.atomic
def employee_create(request):
    if request.method == 'POST':
        form = EmployeeForm(request.POST)
        if form.is_valid():
            form.save()
            messages.success(request, 'Employee created successfully.')
            return redirect('employees:employee_list')
    else:
        form = EmployeeForm()
    return render(request, 'employees/employee_form.html', {'form': form})

@login_required
@transaction.atomic
def employee_update(request, pk):
    employee = get_object_or_404(Employee, pk=pk)
    if request.method == 'POST':
        form = EmployeeForm(request.POST, instance=employee)
        if form.is_valid():
            form.save()
            messages.success(request, 'Employee updated successfully.')
            return redirect('employees:employee_list')
    else:
        form = EmployeeForm(instance=employee)
    return render(request, 'employees/employee_form.html', {'form': form})

@login_required
@transaction.atomic
def employee_delete(request, pk):
    employee = get_object_or_404(Employee, pk=pk)
    if request.method == 'POST':
        employee.delete()
        messages.success(request, 'Employee deleted successfully.')
        return redirect('employees:employee_list')
    return render(request, 'employees/employee_confirm_delete.html', {'employee': employee})

@login_required
@transaction.atomic
def add_bank_account(request, employee_id):
    employee = get_object_or_404(Employee, pk=employee_id)
    if request.method == 'POST':
        form = EmployeeBankAccountForm(request.POST)
        if form.is_valid():
            bank_account = form.save(commit=False)
            bank_account.employee = employee
            bank_account.save()
            messages.success(request, 'Bank account added successfully.')
            return redirect('employees:employee_detail', pk=employee_id)
    else:
        form = EmployeeBankAccountForm()
    
    return render(request, 'employees/preview/bank/bank_account_form.html', {
        'form': form,
        'employee': employee,
        'title': 'Add Bank Account'
    })

@login_required
@transaction.atomic
def edit_bank_account(request, employee_id, account_id):
    employee = get_object_or_404(Employee, pk=employee_id)
    bank_account = get_object_or_404(EmployeeBankAccount, pk=account_id, employee=employee)
    
    if request.method == 'POST':
        form = EmployeeBankAccountForm(request.POST, instance=bank_account)
        if form.is_valid():
            form.save()
            messages.success(request, 'Bank account updated successfully.')
            return redirect('employees:employee_detail', pk=employee_id)
    else:
        form = EmployeeBankAccountForm(instance=bank_account)
    
    return render(request, 'employees/preview/bank/bank_account_form.html', {
        'form': form,
        'employee': employee,
        'bank_account': bank_account,
        'title': 'Edit Bank Account'
    })

@login_required
@transaction.atomic
def delete_bank_account(request, employee_id, account_id):
    employee = get_object_or_404(Employee, pk=employee_id)
    bank_account = get_object_or_404(EmployeeBankAccount, pk=account_id, employee=employee)
    
    if request.method == 'POST':
        bank_account.delete()
        messages.success(request, 'Bank account deleted successfully.')
        return redirect('employees:employee_detail', pk=employee_id)
    
    return render(request, 'employees/preview/bank/bank_account_confirm_delete.html', {
        'employee': employee,
        'bank_account': bank_account
    })

@login_required
@transaction.atomic
def add_document(request, employee_id):
    employee = get_object_or_404(Employee, pk=employee_id)
    if request.method == 'POST':
        form = EmployeeDocumentForm(request.POST, request.FILES)
        if form.is_valid():
            document = form.save(commit=False)
            document.employee = employee
            document.save()
            messages.success(request, 'Document added successfully.')
            return redirect('employees:employee_detail', pk=employee_id)
    else:
        form = EmployeeDocumentForm()
    
    return render(request, 'employees/preview/document/document_form.html', {
        'form': form,
        'employee': employee,
        'title': 'Add Document'
    })

@login_required
@transaction.atomic
def edit_document(request, employee_id, document_id):
    employee = get_object_or_404(Employee, pk=employee_id)
    document = get_object_or_404(EmployeeDocument, pk=document_id, employee=employee)
    
    if request.method == 'POST':
        form = EmployeeDocumentForm(request.POST, request.FILES, instance=document)
        if form.is_valid():
            form.save()
            messages.success(request, 'Document updated successfully.')
            return redirect('employees:employee_detail', pk=employee_id)
    else:
        form = EmployeeDocumentForm(instance=document)
    
    return render(request, 'employees/preview/document/document_form.html', {
        'form': form,
        'employee': employee,
        'document': document,
        'title': 'Edit Document'
    })

@login_required
@transaction.atomic
def delete_document(request, employee_id, document_id):
    employee = get_object_or_404(Employee, pk=employee_id)
    document = get_object_or_404(EmployeeDocument, pk=document_id, employee=employee)
    
    if request.method == 'POST':
        document.delete()
        messages.success(request, 'Document deleted successfully.')
        return redirect('employees:employee_detail', pk=employee_id)
    
    return render(request, 'employees/preview/document/document_confirm_delete.html', {
        'employee': employee,
        'document': document
    })

@login_required
def view_document(request, employee_id, document_id):
    employee = get_object_or_404(Employee, pk=employee_id)
    document = get_object_or_404(EmployeeDocument, pk=document_id, employee=employee)
    
    return render(request, 'employees/preview/document/document_view.html', {
        'employee': employee,
        'document': document
    })

@login_required
def bulk_status_change(request):
    if request.method == 'POST':
        try:
            employee_ids = request.POST.getlist('employee_ids[]')
            status = request.POST.get('status')
            
            if not employee_ids or status not in ['active', 'inactive']:
                return JsonResponse({'success': False, 'error': 'Invalid parameters'})
            
            # Update employee status
            Employee.objects.filter(id__in=employee_ids).update(
                is_active=(status == 'active')
            )
            
            return JsonResponse({'success': True})
        except Exception as e:
            return JsonResponse({'success': False, 'error': str(e)})
    
    return JsonResponse({'success': False, 'error': 'Invalid request method'})

@login_required
def system_info(request):
    """Return system information for the client."""
    return JsonResponse({
        'platform': platform.system()
    })

@csrf_exempt
@login_required
def scan_document(request, employee_id=None, dependent_id=None):
    """Universal document scanning view that can be used for any document type."""
    if request.method != 'POST':
        return JsonResponse({'error': 'Invalid request method'}, status=400)
    
    # Check permissions
    if employee_id:
        try:
            employee = Employee.objects.get(id=employee_id)
            if not request.user.has_perm('employees.view_employee', employee):
                return JsonResponse({'error': 'Permission denied'}, status=403)
            
            if dependent_id:
                try:
                    dependent = EmployeeDependent.objects.get(id=dependent_id, employee=employee)
                except EmployeeDependent.DoesNotExist:
                    return JsonResponse({'error': 'Dependent not found'}, status=404)
        except Employee.DoesNotExist:
            return JsonResponse({'error': 'Employee not found'}, status=404)
    
    if platform.system() != 'Windows':
        return JsonResponse({'error': 'Scanner functionality is only available on Windows'}, status=400)

    try:
        # Ensure COM is uninitialized before starting
        try:
            pythoncom.CoUninitialize()
        except:
            pass
        
        # Initialize COM in the current thread
        pythoncom.CoInitialize()
        
        try:
            data = json.loads(request.body)
            use_feeder = data.get('useFeeder', False)
            
            # Create WIA device manager with retry logic
            max_retries = 3
            device_manager = None
            
            for attempt in range(max_retries):
                try:
                    device_manager = win32com.client.Dispatch("WIA.DeviceManager")
                    break
                except Exception as e:
                    if attempt == max_retries - 1:
                        raise Exception(f"Failed to initialize scanner after {max_retries} attempts: {str(e)}")
                    time.sleep(1)  # Wait before retry
            
            devices = device_manager.DeviceInfos
            
            # Find first available scanner
            scanner = None
            scanner_info = None
            
            for i in range(1, devices.Count + 1):
                try:
                    device = devices.Item(i)
                    if device.Type == 1:  # 1 = Scanner
                        scanner_info = device
                        scanner = device.Connect()
                        print(f"Found scanner: {device.Properties('Name').Value}")
                        break
                except Exception as e:
                    print(f"Failed to connect to device {i}: {str(e)}")
                    continue
            
            if not scanner:
                return JsonResponse({'error': 'No scanner found or scanner is not ready'}, status=404)
            
            # Store scanned images
            scanned_images = []
            
            # Get default scanner item
            try:
                item = scanner.Items[1]
            except Exception as e:
                raise Exception(f"Failed to get scanner item: {str(e)}")
            
            # Get available properties
            try:
                properties = {}
                for i in range(1, item.Properties.Count + 1):
                    prop = item.Properties.Item(i)
                    properties[prop.Name] = {
                        'id': prop.PropertyID,
                        'value': prop.Value,
                        'type': prop.Type
                    }
                print("Available properties:", properties)
            except Exception as e:
                print(f"Failed to get properties: {str(e)}")
            
            # Common scan settings with fallbacks
            scan_settings = {
                'Color Mode': {'id': 6146, 'value': 2},  # Color
                'Resolution': {'id': 6147, 'value': 300},  # DPI
                'Brightness': {'id': 6148, 'value': 0},
                'Contrast': {'id': 6149, 'value': 0}
            }
            
            # Apply scan settings with error handling
            for setting_name, setting_info in scan_settings.items():
                try:
                    prop_id = str(setting_info['id'])
                    item.Properties(prop_id).Value = setting_info['value']
                except Exception as e:
                    print(f"Warning: Failed to set {setting_name} ({prop_id}): {str(e)}")
                    # Continue even if a setting fails
            
            if use_feeder:
                try:
                    # Configure feeder settings if available
                    try:
                        scanner.Properties("Document Handling Select").Value = 2
                    except:
                        print("Warning: Feeder settings not available")
                    
                    try:
                        scanner.Properties("Pages").Value = 1
                    except:
                        print("Warning: Pages setting not available")
                    
                    while True:
                        try:
                            # Perform the scan
                            image = item.Transfer()
                            
                            # Process the scanned image
                            temp_filename = f'scan_{uuid.uuid4()}.jpg'
                            temp_path = os.path.join(tempfile.gettempdir(), temp_filename)
                            image.SaveFile(temp_path)
                            
                            with open(temp_path, 'rb') as img_file:
                                img_data = base64.b64encode(img_file.read()).decode('utf-8')
                            
                            scanned_images.append({
                                'data': f'data:image/jpeg;base64,{img_data}',
                                'filename': f'page_{len(scanned_images) + 1}.jpg'
                            })
                            
                            os.remove(temp_path)
                            
                        except Exception as e:
                            if "paper empty" in str(e).lower():
                                break
                            raise Exception(f"Error during feeder scan: {str(e)}")
                            
                except Exception as e:
                    raise Exception(f"Error with document feeder: {str(e)}")
            else:
                try:
                    # Perform single page scan
                    image = item.Transfer()
                    
                    # Process the scanned image
                    temp_filename = f'scan_{uuid.uuid4()}.jpg'
                    temp_path = os.path.join(tempfile.gettempdir(), temp_filename)
                    image.SaveFile(temp_path)
                    
                    with open(temp_path, 'rb') as img_file:
                        img_data = base64.b64encode(img_file.read()).decode('utf-8')
                    
                    scanned_images.append({
                        'data': f'data:image/jpeg;base64,{img_data}',
                        'filename': 'page_1.jpg'
                    })
                    
                    os.remove(temp_path)
                    
                except Exception as e:
                    raise Exception(f"Error during single page scan: {str(e)}")
            
            if not scanned_images:
                raise Exception("No images were scanned")
            
            return JsonResponse({
                'status': 'success',
                'images': scanned_images
            })
            
        finally:
            pythoncom.CoUninitialize()
            
    except Exception as e:
        error_message = str(e)
        # Try to ensure COM is properly uninitialized
        try:
            pythoncom.CoUninitialize()
        except:
            pass
            
        return JsonResponse({
            'status': 'error',
            'error': error_message
        }, status=500)

@login_required
def add_dependent(request, employee_id):
    employee = get_object_or_404(Employee, id=employee_id)
    if request.method == 'POST':
        form = EmployeeDependentForm(request.POST)
        if form.is_valid():
            dependent = form.save(commit=False)
            dependent.employee = employee
            dependent.save()
            return JsonResponse({'status': 'success', 'message': 'Dependent added successfully'})
        return JsonResponse({'status': 'error', 'errors': form.errors})
    else:
        form = EmployeeDependentForm()
    return render(request, 'employees/preview/dependents/dependent_form.html', {
        'form': form,
        'employee': employee,
    })

@login_required
def edit_dependent(request, employee_id, dependent_id):
    employee = get_object_or_404(Employee, id=employee_id)
    dependent = get_object_or_404(EmployeeDependent, id=dependent_id, employee=employee)
    if request.method == 'POST':
        form = EmployeeDependentForm(request.POST, instance=dependent)
        if form.is_valid():
            form.save()
            return JsonResponse({'status': 'success', 'message': 'Dependent updated successfully'})
        return JsonResponse({'status': 'error', 'errors': form.errors})
    else:
        form = EmployeeDependentForm(instance=dependent)
    return render(request, 'employees/preview/dependents/dependent_form.html', {
        'form': form,
        'employee': employee,
        'dependent': dependent,
    })

@login_required
def delete_dependent(request, employee_id, dependent_id):
    if request.method == 'POST':
        employee = get_object_or_404(Employee, id=employee_id)
        dependent = get_object_or_404(EmployeeDependent, id=dependent_id, employee=employee)
        dependent.delete()
        return JsonResponse({'status': 'success', 'message': 'Dependent deleted successfully'})
    return JsonResponse({'status': 'error', 'message': 'Invalid request method'})

@login_required
def add_dependent_document(request, employee_id, dependent_id):
    try:
        employee = Employee.objects.get(id=employee_id)
        dependent = EmployeeDependent.objects.get(id=dependent_id, employee=employee)
    except (Employee.DoesNotExist, EmployeeDependent.DoesNotExist):
        raise Http404("Employee or dependent not found")
    
    if request.method == 'POST':
        try:
            # Get form data
            document_type = request.POST.get('document_type')
            name = request.POST.get('name')
            document_number = request.POST.get('document_number')
            issue_date = request.POST.get('issue_date') or None
            expiry_date = request.POST.get('expiry_date') or None
            nationality = request.POST.get('nationality')
            
            # Create document
            document = DependentDocument.objects.create(
                dependent=dependent,
                document_type=document_type,
                name=name,
                document_number=document_number,
                issue_date=issue_date,
                expiry_date=expiry_date,
                nationality=nationality
            )
            
            # Handle file upload
            if request.FILES.get('document_file'):
                document.document_file = request.FILES['document_file']
                document.save()
            
            return JsonResponse({
                'status': 'success',
                'message': 'Document added successfully',
                'document': {
                    'id': document.id,
                    'name': document.name,
                    'document_type': document.get_document_type_display(),
                    'document_number': document.document_number or '',
                    'issue_date': document.issue_date.strftime('%Y-%m-%d') if document.issue_date else '',
                    'expiry_date': document.expiry_date.strftime('%Y-%m-%d') if document.expiry_date else '',
                    'status': document.status
                }
            })
            
        except Exception as e:
            return JsonResponse({
                'status': 'error',
                'error': str(e)
            }, status=400)
    
    context = {
        'employee': employee,
        'dependent': dependent,
        'nationality_choices': Employee.NATIONALITY_CHOICES
    }
    
    return render(request, 'employees/preview/dependents/dependent_document_form.html', context)

@login_required
def edit_dependent_document(request, employee_id, dependent_id, document_id):
    employee = get_object_or_404(Employee, id=employee_id)
    dependent = get_object_or_404(EmployeeDependent, id=dependent_id, employee=employee)
    document = get_object_or_404(DependentDocument, id=document_id, dependent=dependent)
    
    if request.method == 'POST':
        form = DependentDocumentForm(request.POST, request.FILES, instance=document)
        if form.is_valid():
            document = form.save()
            
            # Handle file upload
            if 'document_file' in request.FILES:
                document.document_file = request.FILES['document_file']
                document.save()
            
            return JsonResponse({
                'status': 'success',
                'message': 'Document updated successfully',
                'document': {
                    'id': document.id,
                    'name': document.name,
                    'document_type': document.get_document_type_display(),
                    'document_number': document.document_number or '',
                    'issue_date': document.issue_date.strftime('%Y-%m-%d') if document.issue_date else '',
                    'expiry_date': document.expiry_date.strftime('%Y-%m-%d') if document.expiry_date else '',
                    'status': document.status
                }
            })
        return JsonResponse({'status': 'error', 'errors': form.errors})
    else:
        form = DependentDocumentForm(instance=document)
        
    scanning_js = render_to_string('employees/preview/dependents/scanning_js.html', {
        'employee': employee,
        'dependent': dependent
    })
    
    return render(request, 'employees/preview/dependents/dependent_document_form.html', {
        'form': form,
        'employee': employee,
        'dependent': dependent,
        'document': document,
        'scanning_js': scanning_js
    })

@login_required
def delete_dependent_document(request, employee_id, dependent_id, document_id):
    if request.method == 'POST':
        employee = get_object_or_404(Employee, id=employee_id)
        dependent = get_object_or_404(EmployeeDependent, id=dependent_id, employee=employee)
        document = get_object_or_404(DependentDocument, id=document_id, dependent=dependent)
        document.delete()
        return JsonResponse({'status': 'success', 'message': 'Document deleted successfully'})
    return JsonResponse({'status': 'error', 'message': 'Invalid request method'})

@login_required
def view_dependent_document(request, employee_id, dependent_id, document_id):
    employee = get_object_or_404(Employee, id=employee_id)
    dependent = get_object_or_404(EmployeeDependent, id=dependent_id, employee=employee)
    document = get_object_or_404(DependentDocument, id=document_id, dependent=dependent)
    
    if document.document_file:
        # Get the file extension
        file_extension = os.path.splitext(document.document_file.name)[1].lower()
        
        # Set the content type based on file extension
        content_type = 'application/pdf' if file_extension == '.pdf' else 'image/jpeg' if file_extension in ['.jpg', '.jpeg'] else 'image/png' if file_extension == '.png' else 'application/octet-stream'
        
        # Set response headers for inline display
        response = HttpResponse(document.document_file.read(), content_type=content_type)
        response['Content-Disposition'] = f'inline; filename="{os.path.basename(document.document_file.name)}"'
        return response
        
    return JsonResponse({'status': 'error', 'message': 'Document file not found'})

@login_required
def get_dependent_documents(request, employee_id, dependent_id):
    employee = get_object_or_404(Employee, id=employee_id)
    dependent = get_object_or_404(EmployeeDependent, id=dependent_id, employee=employee)
    documents = dependent.documents.all().order_by('-created_at')
    
    documents_data = [{
        'id': doc.id,
        'name': doc.name,
        'document_type': doc.get_document_type_display(),
        'document_number': doc.document_number or '',
        'issue_date': doc.issue_date.strftime('%Y-%m-%d') if doc.issue_date else '',
        'expiry_date': doc.expiry_date.strftime('%Y-%m-%d') if doc.expiry_date else '',
        'status': doc.status
    } for doc in documents]
    
    return JsonResponse({
        'status': 'success',
        'documents': documents_data
    })

@login_required
def dependent_documents(request, employee_id, dependent_id):
    employee = get_object_or_404(Employee, id=employee_id)
    dependent = get_object_or_404(EmployeeDependent, id=dependent_id, employee=employee)
    documents = dependent.documents.all().order_by('-created_at')
    
    return render(request, 'employees/preview/dependents/dependent_documents_list.html', {
        'employee': employee,
        'dependent': dependent,
        'documents': documents
    })

@login_required
def employee_documents(request, employee_id):
    """View to list all documents for an employee."""
    employee = get_object_or_404(Employee, pk=employee_id)
    documents = EmployeeDocument.objects.filter(employee=employee)
    
    context = {
        'employee': employee,
        'documents': documents,
    }
    
    return render(request, 'employees/preview/document/document_list.html', context)


@login_required
@permission_required('employees.add_salarydetail')
def add_salary(request, employee_id):
    employee = get_object_or_404(Employee, pk=employee_id)
    
    if request.method == 'POST':
        form = SalaryDetailForm(request.POST)
        if form.is_valid():
            salary_detail = form.save(commit=False)
            salary_detail.employee = employee
            salary_detail.created_by = request.user
            
            try:
                with transaction.atomic():
                    # Save the new salary detail
                    salary_detail.save()
                    
                    # If there's a previous active salary, create a revision
                    previous_salary = SalaryDetail.objects.filter(
                        employee=employee,
                        is_active=False
                    ).order_by('-effective_from').first()
                    
                    if previous_salary:
                        SalaryRevision.objects.create(
                            employee=employee,
                            revision_type='OTH',  # Other
                            previous_salary=previous_salary,
                            new_salary=salary_detail,
                            revision_date=salary_detail.effective_from,
                            reason="New salary details added",
                            approved_by=request.user
                        )
                    
                messages.success(request, 'Salary details added successfully.')
                return redirect('employees:employee_detail', pk=employee_id)
            except Exception as e:
                messages.error(request, f'Error saving salary details: {str(e)}')
    else:
        form = SalaryDetailForm()
    
    return render(request, 'employees/salary_form.html', {
        'form': form,
        'employee': employee
    })

@login_required
@permission_required('employees.add_salarycertificate')
def request_certificate(request, employee_id):
    employee = get_object_or_404(Employee, pk=employee_id)
    
    if request.method == 'POST':
        form = SalaryCertificateForm(request.POST)
        if form.is_valid():
            try:
                with transaction.atomic():
                    # Get the current active salary detail
                    current_salary = SalaryDetail.objects.filter(
                        employee=employee,
                        is_active=True
                    ).first()
                    
                    if not current_salary:
                        raise ValueError("No active salary details found")
                    
                    certificate = form.save(commit=False)
                    certificate.employee = employee
                    certificate.salary_detail = current_salary
                    certificate.issued_by = request.user
                    certificate.issued_date = timezone.now().date()
                    
                    # Generate a unique certificate number
                    prefix = timezone.now().strftime('%Y%m')
                    count = SalaryCertificate.objects.filter(
                        certificate_number__startswith=prefix
                    ).count()
                    certificate.certificate_number = f"{prefix}-{count+1:04d}"
                    
                    certificate.save()
                    
                    messages.success(request, 'Certificate request submitted successfully.')
                    return redirect('employees:employee_detail', pk=employee_id)
                    
            except ValueError as e:
                messages.error(request, str(e))
            except Exception as e:
                messages.error(request, f'Error requesting certificate: {str(e)}')
    else:
        form = SalaryCertificateForm()
    
    return render(request, 'employees/certificate_form.html', {
        'form': form,
        'employee': employee
    })

@login_required
@permission_required('employees.change_salarydetail')
def edit_salary(request, salary_id):
    salary_detail = get_object_or_404(SalaryDetail, pk=salary_id)
    employee = salary_detail.employee
    
    if request.method == 'POST':
        form = SalaryDetailForm(request.POST, instance=salary_detail)
        if form.is_valid():
            try:
                with transaction.atomic():
                    # Save the updated salary detail
                    updated_salary = form.save()
                    
                    # Create a revision record
                    SalaryRevision.objects.create(
                        employee=employee,
                        revision_type='ADJ',  # Adjustment
                        previous_salary=salary_detail,
                        new_salary=updated_salary,
                        revision_date=timezone.now().date(),
                        reason="Salary details updated",
                        approved_by=request.user
                    )
                    
                messages.success(request, 'Salary details updated successfully.')
                return redirect('employees:employee_detail', pk=employee.id)
            except Exception as e:
                messages.error(request, f'Error updating salary details: {str(e)}')
    else:
        form = SalaryDetailForm(instance=salary_detail)
    
    return render(request, 'employees/salary_form.html', {
        'form': form,
        'employee': employee,
        'is_edit': True
    })

@login_required
@permission_required('employees.add_salaryrevision')
def add_salary_revision(request, employee_id):
    employee = get_object_or_404(Employee, pk=employee_id)
    
    if request.method == 'POST':
        form = SalaryRevisionForm(request.POST)
        if form.is_valid():
            try:
                with transaction.atomic():
                    revision = form.save(commit=False)
                    revision.employee = employee
                    revision.approved_by = request.user
                    
                    # Get the current active salary
                    current_salary = SalaryDetail.objects.filter(
                        employee=employee,
                        is_active=True
                    ).first()
                    
                    if not current_salary:
                        raise ValueError("No active salary details found")
                    
                    # Create a new salary detail based on the current one
                    new_salary = SalaryDetail.objects.create(
                        employee=employee,
                        basic_salary=current_salary.basic_salary,
                        housing_allowance=current_salary.housing_allowance,
                        transportation_allowance=current_salary.transportation_allowance,
                        other_allowances=current_salary.other_allowances,
                        currency=current_salary.currency,
                        effective_from=revision.revision_date,
                        created_by=request.user
                    )
                    
                    revision.previous_salary = current_salary
                    revision.new_salary = new_salary
                    revision.save()
                    
                messages.success(request, 'Salary revision added successfully.')
                return redirect('employees:employee_detail', pk=employee_id)
            except ValueError as e:
                messages.error(request, str(e))
            except Exception as e:
                messages.error(request, f'Error adding salary revision: {str(e)}')
    else:
        form = SalaryRevisionForm()
    
    return render(request, 'employees/revision_form.html', {
        'form': form,
        'employee': employee
    })
```

